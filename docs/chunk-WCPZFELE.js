import{A as Et,B as No,C as me,E as Or,F as yi,G as un,H as wi,K as Dt,L as vp,N as Bo,P as Es,R as Q,T as qt,a as At,b as Xt,d as Tt,e as nu,f as fp,g as Hn,h as mi,i as Le,j as vs,l as Zt,m as Qt,n as dp,o as vt,p as Ct,q as Ro,t as Ue,u as Ce,v as He,x as hr}from"./chunk-AJGGPJRP.js";import{b as Se,e as Ie,i as zn,k as hp}from"./chunk-3MOYO27G.js";import{a as bp}from"./chunk-CG2EMPLA.js";import{b as wp}from"./chunk-CTLUDKZB.js";import{va as yp}from"./chunk-YVA7YSBN.js";import{H as gp,K as mp,t as pp}from"./chunk-3WGOZNFF.js";import{a as M,b as pe,f as lp,g as Te,h as ze,i as Mt,j as Be,k as gi}from"./chunk-QGXACWGO.js";var qr=Te((H4,ou)=>{"use strict";var xs=typeof Reflect=="object"?Reflect:null,Ep=xs&&typeof xs.apply=="function"?xs.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},Uo;xs&&typeof xs.ownKeys=="function"?Uo=xs.ownKeys:Object.getOwnPropertySymbols?Uo=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Uo=function(e){return Object.getOwnPropertyNames(e)};function Gv(t){console&&console.warn&&console.warn(t)}var Sp=Number.isNaN||function(e){return e!==e};function ye(){ye.init.call(this)}ou.exports=ye;ou.exports.once=Zv;ye.EventEmitter=ye;ye.prototype._events=void 0;ye.prototype._eventsCount=0;ye.prototype._maxListeners=void 0;var xp=10;function ko(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(ye,"defaultMaxListeners",{enumerable:!0,get:function(){return xp},set:function(t){if(typeof t!="number"||t<0||Sp(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");xp=t}});ye.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ye.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Sp(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Ip(t){return t._maxListeners===void 0?ye.defaultMaxListeners:t._maxListeners}ye.prototype.getMaxListeners=function(){return Ip(this)};ye.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var s=e==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=i[e];if(c===void 0)return!1;if(typeof c=="function")Ep(c,this,r);else for(var u=c.length,l=Dp(c,u),n=0;n<u;++n)Ep(l[n],this,r);return!0};function _p(t,e,r,n){var s,i,o;if(ko(r),i=t._events,i===void 0?(i=t._events=Object.create(null),t._eventsCount=0):(i.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),i=t._events),o=i[e]),o===void 0)o=i[e]=r,++t._eventsCount;else if(typeof o=="function"?o=i[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),s=Ip(t),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,Gv(a)}return t}ye.prototype.addListener=function(e,r){return _p(this,e,r,!1)};ye.prototype.on=ye.prototype.addListener;ye.prototype.prependListener=function(e,r){return _p(this,e,r,!0)};function Yv(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ap(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},s=Yv.bind(n);return s.listener=r,n.wrapFn=s,s}ye.prototype.once=function(e,r){return ko(r),this.on(e,Ap(this,e,r)),this};ye.prototype.prependOnceListener=function(e,r){return ko(r),this.prependListener(e,Ap(this,e,r)),this};ye.prototype.removeListener=function(e,r){var n,s,i,o,a;if(ko(r),s=this._events,s===void 0)return this;if(n=s[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===r||n[o].listener===r){a=n[o].listener,i=o;break}if(i<0)return this;i===0?n.shift():Jv(n,i),n.length===1&&(s[e]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this};ye.prototype.off=ye.prototype.removeListener;ye.prototype.removeAllListeners=function(e){var r,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var i=Object.keys(n),o;for(s=0;s<i.length;++s)o=i[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(s=r.length-1;s>=0;s--)this.removeListener(e,r[s]);return this};function Tp(t,e,r){var n=t._events;if(n===void 0)return[];var s=n[e];return s===void 0?[]:typeof s=="function"?r?[s.listener||s]:[s]:r?Xv(s):Dp(s,s.length)}ye.prototype.listeners=function(e){return Tp(this,e,!0)};ye.prototype.rawListeners=function(e){return Tp(this,e,!1)};ye.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Cp.call(t,e)};ye.prototype.listenerCount=Cp;function Cp(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}ye.prototype.eventNames=function(){return this._eventsCount>0?Uo(this._events):[]};function Dp(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function Jv(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Xv(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Zv(t,e){return new Promise(function(r,n){function s(o){t.removeListener(e,i),n(o)}function i(){typeof t.removeListener=="function"&&t.removeListener("error",s),r([].slice.call(arguments))}Op(t,e,i,{once:!0}),e!=="error"&&Qv(t,s,{once:!0})})}function Qv(t,e,r){typeof t.on=="function"&&Op(t,"error",e,r)}function Op(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(i){n.once&&t.removeEventListener(e,s),r(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}});var Ei={};ze(Ei,{__assign:()=>cu,__asyncDelegator:()=>fE,__asyncGenerator:()=>hE,__asyncValues:()=>dE,__await:()=>vi,__awaiter:()=>iE,__classPrivateFieldGet:()=>yE,__classPrivateFieldSet:()=>wE,__createBinding:()=>aE,__decorate:()=>rE,__exportStar:()=>cE,__extends:()=>eE,__generator:()=>oE,__importDefault:()=>mE,__importStar:()=>gE,__makeTemplateObject:()=>pE,__metadata:()=>sE,__param:()=>nE,__read:()=>Pp,__rest:()=>tE,__spread:()=>uE,__spreadArrays:()=>lE,__values:()=>uu});function eE(t,e){au(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function tE(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r}function rE(t,e,r,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(i=(s<3?o(i):s>3?o(e,r,i):o(e,r))||i);return s>3&&i&&Object.defineProperty(e,r,i),i}function nE(t,e){return function(r,n){e(r,n,t)}}function sE(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function iE(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):s(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function oE(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,s=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],s=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function aE(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function cE(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function uu(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Pp(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function uE(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Pp(arguments[e]));return t}function lE(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),s=0,e=0;e<r;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)n[s]=i[o];return n}function vi(t){return this instanceof vi?(this.v=t,this):new vi(t)}function hE(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){n[f]&&(s[f]=function(d){return new Promise(function(p,g){i.push([f,d,p,g])>1||a(f,d)})})}function a(f,d){try{c(n[f](d))}catch(p){h(i[0][3],p)}}function c(f){f.value instanceof vi?Promise.resolve(f.value.v).then(u,l):h(i[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,d){f(d),i.shift(),i.length&&a(i[0][0],i[0][1])}}function fE(t){var e,r;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,i){e[s]=t[s]?function(o){return(r=!r)?{value:vi(t[s](o)),done:s==="return"}:i?i(o):o}:i}}function dE(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof uu=="function"?uu(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(o){return new Promise(function(a,c){o=t[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},o)}}function pE(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function gE(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function mE(t){return t&&t.__esModule?t:{default:t}}function yE(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function wE(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var au,cu,xi=lp(()=>{"use strict";au=function(t,e){return au=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)n.hasOwnProperty(s)&&(r[s]=n[s])},au(t,e)};cu=function(){return cu=Object.assign||function(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},cu.apply(this,arguments)}});var Rp=Te(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});Fo.delay=void 0;function bE(t){return new Promise(e=>{setTimeout(()=>{e(!0)},t)})}Fo.delay=bE});var Np=Te(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});Ss.ONE_THOUSAND=Ss.ONE_HUNDRED=void 0;Ss.ONE_HUNDRED=100;Ss.ONE_THOUSAND=1e3});var Bp=Te(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.ONE_YEAR=W.FOUR_WEEKS=W.THREE_WEEKS=W.TWO_WEEKS=W.ONE_WEEK=W.THIRTY_DAYS=W.SEVEN_DAYS=W.FIVE_DAYS=W.THREE_DAYS=W.ONE_DAY=W.TWENTY_FOUR_HOURS=W.TWELVE_HOURS=W.SIX_HOURS=W.THREE_HOURS=W.ONE_HOUR=W.SIXTY_MINUTES=W.THIRTY_MINUTES=W.TEN_MINUTES=W.FIVE_MINUTES=W.ONE_MINUTE=W.SIXTY_SECONDS=W.THIRTY_SECONDS=W.TEN_SECONDS=W.FIVE_SECONDS=W.ONE_SECOND=void 0;W.ONE_SECOND=1;W.FIVE_SECONDS=5;W.TEN_SECONDS=10;W.THIRTY_SECONDS=30;W.SIXTY_SECONDS=60;W.ONE_MINUTE=W.SIXTY_SECONDS;W.FIVE_MINUTES=W.ONE_MINUTE*5;W.TEN_MINUTES=W.ONE_MINUTE*10;W.THIRTY_MINUTES=W.ONE_MINUTE*30;W.SIXTY_MINUTES=W.ONE_MINUTE*60;W.ONE_HOUR=W.SIXTY_MINUTES;W.THREE_HOURS=W.ONE_HOUR*3;W.SIX_HOURS=W.ONE_HOUR*6;W.TWELVE_HOURS=W.ONE_HOUR*12;W.TWENTY_FOUR_HOURS=W.ONE_HOUR*24;W.ONE_DAY=W.TWENTY_FOUR_HOURS;W.THREE_DAYS=W.ONE_DAY*3;W.FIVE_DAYS=W.ONE_DAY*5;W.SEVEN_DAYS=W.ONE_DAY*7;W.THIRTY_DAYS=W.ONE_DAY*30;W.ONE_WEEK=W.SEVEN_DAYS;W.TWO_WEEKS=W.ONE_WEEK*2;W.THREE_WEEKS=W.ONE_WEEK*3;W.FOUR_WEEKS=W.ONE_WEEK*4;W.ONE_YEAR=W.ONE_DAY*365});var lu=Te(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});var Up=(xi(),gi(Ei));Up.__exportStar(Np(),Lo);Up.__exportStar(Bp(),Lo)});var Fp=Te(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});Is.fromMiliseconds=Is.toMiliseconds=void 0;var kp=lu();function vE(t){return t*kp.ONE_THOUSAND}Is.toMiliseconds=vE;function EE(t){return Math.floor(t/kp.ONE_THOUSAND)}Is.fromMiliseconds=EE});var Mp=Te(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});var Lp=(xi(),gi(Ei));Lp.__exportStar(Rp(),Mo);Lp.__exportStar(Fp(),Mo)});var qp=Te(Si=>{"use strict";Object.defineProperty(Si,"__esModule",{value:!0});Si.Watch=void 0;var qo=class{constructor(){this.timestamps=new Map}start(e){if(this.timestamps.has(e))throw new Error(`Watch already started for label: ${e}`);this.timestamps.set(e,{started:Date.now()})}stop(e){let r=this.get(e);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${e}`);let n=Date.now()-r.started;this.timestamps.set(e,{started:r.started,elapsed:n})}get(e){let r=this.timestamps.get(e);if(typeof r>"u")throw new Error(`No timestamp found for label: ${e}`);return r}elapsed(e){let r=this.get(e);return r.elapsed||Date.now()-r.started}};Si.Watch=qo;Si.default=qo});var jp=Te(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});jo.IWatch=void 0;var hu=class{};jo.IWatch=hu});var $p=Te(fu=>{"use strict";Object.defineProperty(fu,"__esModule",{value:!0});var xE=(xi(),gi(Ei));xE.__exportStar(jp(),fu)});var As=Te(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});var $o=(xi(),gi(Ei));$o.__exportStar(Mp(),_s);$o.__exportStar(qp(),_s);$o.__exportStar($p(),_s);$o.__exportStar(lu(),_s)});var ga=Te(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.getLocalStorage=ve.getLocalStorageOrThrow=ve.getCrypto=ve.getCryptoOrThrow=ve.getLocation=ve.getLocationOrThrow=ve.getNavigator=ve.getNavigatorOrThrow=ve.getDocument=ve.getDocumentOrThrow=ve.getFromWindowOrThrow=ve.getFromWindow=void 0;function Wn(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}ve.getFromWindow=Wn;function Ds(t){let e=Wn(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}ve.getFromWindowOrThrow=Ds;function VS(){return Ds("document")}ve.getDocumentOrThrow=VS;function KS(){return Wn("document")}ve.getDocument=KS;function WS(){return Ds("navigator")}ve.getNavigatorOrThrow=WS;function GS(){return Wn("navigator")}ve.getNavigator=GS;function YS(){return Ds("location")}ve.getLocationOrThrow=YS;function JS(){return Wn("location")}ve.getLocation=JS;function XS(){return Ds("crypto")}ve.getCryptoOrThrow=XS;function ZS(){return Wn("crypto")}ve.getCrypto=ZS;function QS(){return Ds("localStorage")}ve.getLocalStorageOrThrow=QS;function eI(){return Wn("localStorage")}ve.getLocalStorage=eI});var am=Te(ma=>{"use strict";Object.defineProperty(ma,"__esModule",{value:!0});ma.getWindowMetadata=void 0;var om=ga();function tI(){let t,e;try{t=om.getDocumentOrThrow(),e=om.getLocationOrThrow()}catch{return null}function r(){let h=t.getElementsByTagName("link"),f=[];for(let d=0;d<h.length;d++){let p=h[d],g=p.getAttribute("rel");if(g&&g.toLowerCase().indexOf("icon")>-1){let w=p.getAttribute("href");if(w)if(w.toLowerCase().indexOf("https:")===-1&&w.toLowerCase().indexOf("http:")===-1&&w.indexOf("//")!==0){let P=e.protocol+"//"+e.host;if(w.indexOf("/")===0)P+=w;else{let R=e.pathname.split("/");R.pop();let x=R.join("/");P+=x+"/"+w}f.push(P)}else if(w.indexOf("//")===0){let P=e.protocol+w;f.push(P)}else f.push(w)}}return f}function n(...h){let f=t.getElementsByTagName("meta");for(let d=0;d<f.length;d++){let p=f[d],g=["itemprop","property","name"].map(w=>p.getAttribute(w)).filter(w=>w?h.includes(w):!1);if(g.length&&g){let w=p.getAttribute("content");if(w)return w}}return""}function s(){let h=n("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function i(){return n("description","og:description","twitter:description","keywords")}let o=s(),a=i(),c=e.origin,u=r();return{description:a,url:c,icons:u,name:o}}ma.getWindowMetadata=tI});var yh=Te((QF,Hy)=>{"use strict";var LA="Input must be an string, Buffer or Uint8Array";function MA(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(LA);return e}function qA(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function ec(t){return(4294967296+t).toString(16).substring(1)}function jA(t,e,r){let n=`
`+t+" = ";for(let s=0;s<e.length;s+=2){if(r===32)n+=ec(e[s]).toUpperCase(),n+=" ",n+=ec(e[s+1]).toUpperCase();else if(r===64)n+=ec(e[s+1]).toUpperCase(),n+=ec(e[s]).toUpperCase();else throw new Error("Invalid size "+r);s%6===4?n+=`
`+new Array(t.length+4).join(" "):s<e.length-2&&(n+=" ")}console.log(n)}function $A(t,e,r){let n=new Date().getTime(),s=new Uint8Array(e);for(let o=0;o<e;o++)s[o]=o%256;let i=new Date().getTime();console.log("Generated random input in "+(i-n)+"ms"),n=i;for(let o=0;o<r;o++){let a=t(s),c=new Date().getTime(),u=c-n;n=c,console.log("Hashed in "+u+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(u/1e3)*100)/100+" MB PER SECOND")}}Hy.exports={normalizeInput:MA,toHex:qA,debugPrint:jA,testSpeed:$A}});var Qy=Te((eL,Zy)=>{"use strict";var rc=yh();function tc(t,e,r){let n=t[e]+t[r],s=t[e+1]+t[r+1];n>=4294967296&&s++,t[e]=n,t[e+1]=s}function Vy(t,e,r,n){let s=t[e]+r;r<0&&(s+=4294967296);let i=t[e+1]+n;s>=4294967296&&i++,t[e]=s,t[e+1]=i}function Ky(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function mn(t,e,r,n,s,i){let o=Gi[s],a=Gi[s+1],c=Gi[i],u=Gi[i+1];tc(te,t,e),Vy(te,t,o,a);let l=te[n]^te[t],h=te[n+1]^te[t+1];te[n]=h,te[n+1]=l,tc(te,r,n),l=te[e]^te[r],h=te[e+1]^te[r+1],te[e]=l>>>24^h<<8,te[e+1]=h>>>24^l<<8,tc(te,t,e),Vy(te,t,c,u),l=te[n]^te[t],h=te[n+1]^te[t+1],te[n]=l>>>16^h<<16,te[n+1]=h>>>16^l<<16,tc(te,r,n),l=te[e]^te[r],h=te[e+1]^te[r+1],te[e]=h>>>31^l<<1,te[e+1]=l>>>31^h<<1}var Wy=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),zA=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],it=new Uint8Array(zA.map(function(t){return t*2})),te=new Uint32Array(32),Gi=new Uint32Array(32);function Gy(t,e){let r=0;for(r=0;r<16;r++)te[r]=t.h[r],te[r+16]=Wy[r];for(te[24]=te[24]^t.t,te[25]=te[25]^t.t/4294967296,e&&(te[28]=~te[28],te[29]=~te[29]),r=0;r<32;r++)Gi[r]=Ky(t.b,4*r);for(r=0;r<12;r++)mn(0,8,16,24,it[r*16+0],it[r*16+1]),mn(2,10,18,26,it[r*16+2],it[r*16+3]),mn(4,12,20,28,it[r*16+4],it[r*16+5]),mn(6,14,22,30,it[r*16+6],it[r*16+7]),mn(0,10,20,30,it[r*16+8],it[r*16+9]),mn(2,12,22,24,it[r*16+10],it[r*16+11]),mn(4,14,16,26,it[r*16+12],it[r*16+13]),mn(6,8,18,28,it[r*16+14],it[r*16+15]);for(r=0;r<16;r++)t.h[r]=t.h[r]^te[r]^te[r+16]}var yn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function Yy(t,e,r,n){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(r&&r.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(n&&n.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");let s={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};yn.fill(0),yn[0]=t,e&&(yn[1]=e.length),yn[2]=1,yn[3]=1,r&&yn.set(r,32),n&&yn.set(n,48);for(let i=0;i<16;i++)s.h[i]=Wy[i]^Ky(yn,i*4);return e&&(wh(s,e),s.c=128),s}function wh(t,e){for(let r=0;r<e.length;r++)t.c===128&&(t.t+=t.c,Gy(t,!1),t.c=0),t.b[t.c++]=e[r]}function Jy(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;Gy(t,!0);let e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3);return e}function Xy(t,e,r,n,s){r=r||64,t=rc.normalizeInput(t),n&&(n=rc.normalizeInput(n)),s&&(s=rc.normalizeInput(s));let i=Yy(r,e,n,s);return wh(i,t),Jy(i)}function HA(t,e,r,n,s){let i=Xy(t,e,r,n,s);return rc.toHex(i)}Zy.exports={blake2b:Xy,blake2bHex:HA,blake2bInit:Yy,blake2bUpdate:wh,blake2bFinal:Jy}});var a0=Te((tL,o0)=>{"use strict";var e0=yh();function VA(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function wn(t,e,r,n,s,i){ue[t]=ue[t]+ue[e]+s,ue[n]=nc(ue[n]^ue[t],16),ue[r]=ue[r]+ue[n],ue[e]=nc(ue[e]^ue[r],12),ue[t]=ue[t]+ue[e]+i,ue[n]=nc(ue[n]^ue[t],8),ue[r]=ue[r]+ue[n],ue[e]=nc(ue[e]^ue[r],7)}function nc(t,e){return t>>>e^t<<32-e}var t0=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ot=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),ue=new Uint32Array(16),Ze=new Uint32Array(16);function r0(t,e){let r=0;for(r=0;r<8;r++)ue[r]=t.h[r],ue[r+8]=t0[r];for(ue[12]^=t.t,ue[13]^=t.t/4294967296,e&&(ue[14]=~ue[14]),r=0;r<16;r++)Ze[r]=VA(t.b,4*r);for(r=0;r<10;r++)wn(0,4,8,12,Ze[ot[r*16+0]],Ze[ot[r*16+1]]),wn(1,5,9,13,Ze[ot[r*16+2]],Ze[ot[r*16+3]]),wn(2,6,10,14,Ze[ot[r*16+4]],Ze[ot[r*16+5]]),wn(3,7,11,15,Ze[ot[r*16+6]],Ze[ot[r*16+7]]),wn(0,5,10,15,Ze[ot[r*16+8]],Ze[ot[r*16+9]]),wn(1,6,11,12,Ze[ot[r*16+10]],Ze[ot[r*16+11]]),wn(2,7,8,13,Ze[ot[r*16+12]],Ze[ot[r*16+13]]),wn(3,4,9,14,Ze[ot[r*16+14]],Ze[ot[r*16+15]]);for(r=0;r<8;r++)t.h[r]^=ue[r]^ue[r+8]}function n0(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");let r=e?e.length:0;if(e&&!(r>0&&r<=32))throw new Error("Incorrect key length, should be in [1, 32]");let n={h:new Uint32Array(t0),b:new Uint8Array(64),c:0,t:0,outlen:t};return n.h[0]^=16842752^r<<8^t,r>0&&(bh(n,e),n.c=64),n}function bh(t,e){for(let r=0;r<e.length;r++)t.c===64&&(t.t+=t.c,r0(t,!1),t.c=0),t.b[t.c++]=e[r]}function s0(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;r0(t,!0);let e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3)&255;return e}function i0(t,e,r){r=r||32,t=e0.normalizeInput(t);let n=n0(r,e);return bh(n,t),s0(n)}function KA(t,e,r){let n=i0(t,e,r);return e0.toHex(n)}o0.exports={blake2s:i0,blake2sHex:KA,blake2sInit:n0,blake2sUpdate:bh,blake2sFinal:s0}});var u0=Te((rL,c0)=>{"use strict";var Yi=Qy(),Ji=a0();c0.exports={blake2b:Yi.blake2b,blake2bHex:Yi.blake2bHex,blake2bInit:Yi.blake2bInit,blake2bUpdate:Yi.blake2bUpdate,blake2bFinal:Yi.blake2bFinal,blake2s:Ji.blake2s,blake2sHex:Ji.blake2sHex,blake2sInit:Ji.blake2sInit,blake2sUpdate:Ji.blake2sUpdate,blake2sFinal:Ji.blake2sFinal}});var Ub={};ze(Ub,{__assign:()=>Rf,__asyncDelegator:()=>OC,__asyncGenerator:()=>DC,__asyncValues:()=>PC,__await:()=>vo,__awaiter:()=>SC,__classPrivateFieldGet:()=>UC,__classPrivateFieldSet:()=>kC,__createBinding:()=>_C,__decorate:()=>vC,__exportStar:()=>AC,__extends:()=>wC,__generator:()=>IC,__importDefault:()=>BC,__importStar:()=>NC,__makeTemplateObject:()=>RC,__metadata:()=>xC,__param:()=>EC,__read:()=>Bb,__rest:()=>bC,__spread:()=>TC,__spreadArrays:()=>CC,__values:()=>Nf});function wC(t,e){Pf(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function bC(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r}function vC(t,e,r,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(i=(s<3?o(i):s>3?o(e,r,i):o(e,r))||i);return s>3&&i&&Object.defineProperty(e,r,i),i}function EC(t,e){return function(r,n){e(r,n,t)}}function xC(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function SC(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):s(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function IC(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,s=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],s=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function _C(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function AC(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Nf(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Bb(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function TC(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Bb(arguments[e]));return t}function CC(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),s=0,e=0;e<r;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)n[s]=i[o];return n}function vo(t){return this instanceof vo?(this.v=t,this):new vo(t)}function DC(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){n[f]&&(s[f]=function(d){return new Promise(function(p,g){i.push([f,d,p,g])>1||a(f,d)})})}function a(f,d){try{c(n[f](d))}catch(p){h(i[0][3],p)}}function c(f){f.value instanceof vo?Promise.resolve(f.value.v).then(u,l):h(i[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,d){f(d),i.shift(),i.length&&a(i[0][0],i[0][1])}}function OC(t){var e,r;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,i){e[s]=t[s]?function(o){return(r=!r)?{value:vo(t[s](o)),done:s==="return"}:i?i(o):o}:i}}function PC(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Nf=="function"?Nf(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=t[i]&&function(o){return new Promise(function(a,c){o=t[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},o)}}function RC(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function NC(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function BC(t){return t&&t.__esModule?t:{default:t}}function UC(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function kC(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Pf,Rf,kb=lp(()=>{"use strict";Pf=function(t,e){return Pf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)n.hasOwnProperty(s)&&(r[s]=n[s])},Pf(t,e)};Rf=function(){return Rf=Object.assign||function(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Rf.apply(this,arguments)}});var Lb=Te(Un=>{"use strict";Object.defineProperty(Un,"__esModule",{value:!0});Un.isBrowserCryptoAvailable=Un.getSubtleCrypto=Un.getBrowerCrypto=void 0;function Bf(){return(global==null?void 0:global.crypto)||(global==null?void 0:global.msCrypto)||{}}Un.getBrowerCrypto=Bf;function Fb(){let t=Bf();return t.subtle||t.webkitSubtle}Un.getSubtleCrypto=Fb;function FC(){return!!Bf()&&!!Fb()}Un.isBrowserCryptoAvailable=FC});var jb=Te(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.isBrowser=kn.isNode=kn.isReactNative=void 0;function Mb(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}kn.isReactNative=Mb;function qb(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}kn.isNode=qb;function LC(){return!Mb()&&!qb()}kn.isBrowser=LC});var Uf=Te(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});var $b=(kb(),gi(Ub));$b.__exportStar(Lb(),Uc);$b.__exportStar(jb(),Uc)});var Yb=Te((qL,Gb)=>{"use strict";Gb.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}});var G1=Te((jn,W1)=>{"use strict";var Gc=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global,Yc=(function(){function t(){this.fetch=!1,this.DOMException=Gc.DOMException}return t.prototype=Gc,new t})();(function(t){var e=(function(r){var n=typeof t<"u"&&t||typeof self<"u"&&self||typeof global<"u"&&global||{},s={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n};function i(b){return b&&DataView.prototype.isPrototypeOf(b)}if(s.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(b){return b&&o.indexOf(Object.prototype.toString.call(b))>-1};function c(b){if(typeof b!="string"&&(b=String(b)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(b)||b==="")throw new TypeError('Invalid character in header field name: "'+b+'"');return b.toLowerCase()}function u(b){return typeof b!="string"&&(b=String(b)),b}function l(b){var E={next:function(){var v=b.shift();return{done:v===void 0,value:v}}};return s.iterable&&(E[Symbol.iterator]=function(){return E}),E}function h(b){this.map={},b instanceof h?b.forEach(function(E,v){this.append(v,E)},this):Array.isArray(b)?b.forEach(function(E){if(E.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+E.length);this.append(E[0],E[1])},this):b&&Object.getOwnPropertyNames(b).forEach(function(E){this.append(E,b[E])},this)}h.prototype.append=function(b,E){b=c(b),E=u(E);var v=this.map[b];this.map[b]=v?v+", "+E:E},h.prototype.delete=function(b){delete this.map[c(b)]},h.prototype.get=function(b){return b=c(b),this.has(b)?this.map[b]:null},h.prototype.has=function(b){return this.map.hasOwnProperty(c(b))},h.prototype.set=function(b,E){this.map[c(b)]=u(E)},h.prototype.forEach=function(b,E){for(var v in this.map)this.map.hasOwnProperty(v)&&b.call(E,this.map[v],v,this)},h.prototype.keys=function(){var b=[];return this.forEach(function(E,v){b.push(v)}),l(b)},h.prototype.values=function(){var b=[];return this.forEach(function(E){b.push(E)}),l(b)},h.prototype.entries=function(){var b=[];return this.forEach(function(E,v){b.push([v,E])}),l(b)},s.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);function f(b){if(!b._noBody){if(b.bodyUsed)return Promise.reject(new TypeError("Already read"));b.bodyUsed=!0}}function d(b){return new Promise(function(E,v){b.onload=function(){E(b.result)},b.onerror=function(){v(b.error)}})}function p(b){var E=new FileReader,v=d(E);return E.readAsArrayBuffer(b),v}function g(b){var E=new FileReader,v=d(E),A=/charset=([A-Za-z0-9_-]+)/.exec(b.type),y=A?A[1]:"utf-8";return E.readAsText(b,y),v}function w(b){for(var E=new Uint8Array(b),v=new Array(E.length),A=0;A<E.length;A++)v[A]=String.fromCharCode(E[A]);return v.join("")}function P(b){if(b.slice)return b.slice(0);var E=new Uint8Array(b.byteLength);return E.set(new Uint8Array(b)),E.buffer}function R(){return this.bodyUsed=!1,this._initBody=function(b){this.bodyUsed=this.bodyUsed,this._bodyInit=b,b?typeof b=="string"?this._bodyText=b:s.blob&&Blob.prototype.isPrototypeOf(b)?this._bodyBlob=b:s.formData&&FormData.prototype.isPrototypeOf(b)?this._bodyFormData=b:s.searchParams&&URLSearchParams.prototype.isPrototypeOf(b)?this._bodyText=b.toString():s.arrayBuffer&&s.blob&&i(b)?(this._bodyArrayBuffer=P(b.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(b)||a(b))?this._bodyArrayBuffer=P(b):this._bodyText=b=Object.prototype.toString.call(b):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof b=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):s.searchParams&&URLSearchParams.prototype.isPrototypeOf(b)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s.blob&&(this.blob=function(){var b=f(this);if(b)return b;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var b=f(this);return b||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(s.blob)return this.blob().then(p);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var b=f(this);if(b)return b;if(this._bodyBlob)return g(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(w(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s.formData&&(this.formData=function(){return this.text().then(B)}),this.json=function(){return this.text().then(JSON.parse)},this}var x=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function I(b){var E=b.toUpperCase();return x.indexOf(E)>-1?E:b}function C(b,E){if(!(this instanceof C))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');E=E||{};var v=E.body;if(b instanceof C){if(b.bodyUsed)throw new TypeError("Already read");this.url=b.url,this.credentials=b.credentials,E.headers||(this.headers=new h(b.headers)),this.method=b.method,this.mode=b.mode,this.signal=b.signal,!v&&b._bodyInit!=null&&(v=b._bodyInit,b.bodyUsed=!0)}else this.url=String(b);if(this.credentials=E.credentials||this.credentials||"same-origin",(E.headers||!this.headers)&&(this.headers=new h(E.headers)),this.method=I(E.method||this.method||"GET"),this.mode=E.mode||this.mode||null,this.signal=E.signal||this.signal||(function(){if("AbortController"in n){var m=new AbortController;return m.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&v)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(v),(this.method==="GET"||this.method==="HEAD")&&(E.cache==="no-store"||E.cache==="no-cache")){var A=/([?&])_=[^&]*/;if(A.test(this.url))this.url=this.url.replace(A,"$1_="+new Date().getTime());else{var y=/\?/;this.url+=(y.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}C.prototype.clone=function(){return new C(this,{body:this._bodyInit})};function B(b){var E=new FormData;return b.trim().split("&").forEach(function(v){if(v){var A=v.split("="),y=A.shift().replace(/\+/g," "),m=A.join("=").replace(/\+/g," ");E.append(decodeURIComponent(y),decodeURIComponent(m))}}),E}function k(b){var E=new h,v=b.replace(/\r?\n[\t ]+/g," ");return v.split("\r").map(function(A){return A.indexOf(`
`)===0?A.substr(1,A.length):A}).forEach(function(A){var y=A.split(":"),m=y.shift().trim();if(m){var _=y.join(":").trim();try{E.append(m,_)}catch(O){console.warn("Response "+O.message)}}}),E}R.call(C.prototype);function U(b,E){if(!(this instanceof U))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(E||(E={}),this.type="default",this.status=E.status===void 0?200:E.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=E.statusText===void 0?"":""+E.statusText,this.headers=new h(E.headers),this.url=E.url||"",this._initBody(b)}R.call(U.prototype),U.prototype.clone=function(){return new U(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},U.error=function(){var b=new U(null,{status:200,statusText:""});return b.ok=!1,b.status=0,b.type="error",b};var N=[301,302,303,307,308];U.redirect=function(b,E){if(N.indexOf(E)===-1)throw new RangeError("Invalid status code");return new U(null,{status:E,headers:{location:b}})},r.DOMException=n.DOMException;try{new r.DOMException}catch{r.DOMException=function(E,v){this.message=E,this.name=v;var A=Error(E);this.stack=A.stack},r.DOMException.prototype=Object.create(Error.prototype),r.DOMException.prototype.constructor=r.DOMException}function j(b,E){return new Promise(function(v,A){var y=new C(b,E);if(y.signal&&y.signal.aborted)return A(new r.DOMException("Aborted","AbortError"));var m=new XMLHttpRequest;function _(){m.abort()}m.onload=function(){var T={statusText:m.statusText,headers:k(m.getAllResponseHeaders()||"")};y.url.indexOf("file://")===0&&(m.status<200||m.status>599)?T.status=200:T.status=m.status,T.url="responseURL"in m?m.responseURL:T.headers.get("X-Request-URL");var F="response"in m?m.response:m.responseText;setTimeout(function(){v(new U(F,T))},0)},m.onerror=function(){setTimeout(function(){A(new TypeError("Network request failed"))},0)},m.ontimeout=function(){setTimeout(function(){A(new TypeError("Network request timed out"))},0)},m.onabort=function(){setTimeout(function(){A(new r.DOMException("Aborted","AbortError"))},0)};function O(T){try{return T===""&&n.location.href?n.location.href:T}catch{return T}}if(m.open(y.method,O(y.url),!0),y.credentials==="include"?m.withCredentials=!0:y.credentials==="omit"&&(m.withCredentials=!1),"responseType"in m&&(s.blob?m.responseType="blob":s.arrayBuffer&&(m.responseType="arraybuffer")),E&&typeof E.headers=="object"&&!(E.headers instanceof h||n.Headers&&E.headers instanceof n.Headers)){var S=[];Object.getOwnPropertyNames(E.headers).forEach(function(T){S.push(c(T)),m.setRequestHeader(T,u(E.headers[T]))}),y.headers.forEach(function(T,F){S.indexOf(F)===-1&&m.setRequestHeader(F,T)})}else y.headers.forEach(function(T,F){m.setRequestHeader(F,T)});y.signal&&(y.signal.addEventListener("abort",_),m.onreadystatechange=function(){m.readyState===4&&y.signal.removeEventListener("abort",_)}),m.send(typeof y._bodyInit>"u"?null:y._bodyInit)})}return j.polyfill=!0,n.fetch||(n.fetch=j,n.Headers=h,n.Request=C,n.Response=U),r.Headers=h,r.Request=C,r.Response=U,r.fetch=j,Object.defineProperty(r,"__esModule",{value:!0}),r})({})})(Yc);Yc.fetch.ponyfill=!0;delete Yc.fetch.polyfill;var ci=Gc.fetch?Gc:Yc;jn=ci.fetch;jn.default=ci.fetch;jn.fetch=ci.fetch;jn.Headers=ci.Headers;jn.Request=ci.Request;jn.Response=ci.Response;W1.exports=jn});var bi={id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},su={id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},Kv={providers:nu,selectedProvider:null,error:null,purchaseCurrency:bi,paymentCurrency:su,purchaseCurrencies:[bi],paymentCurrencies:[],quotesLoading:!1},ce=At(Kv),Wv={state:ce,subscribe(t){return Xt(ce,()=>t(ce))},subscribeKey(t,e){return Tt(ce,t,e)},setSelectedProvider(t){if(t&&t.name==="meld"){let e=Q.state.activeChain,r=e===Se.CHAIN.SOLANA?"SOL":"USDC",n=e?Q.state.chains.get(e)?.accountState?.address??"":"",s=new URL(t.url);s.searchParams.append("publicKey",fp),s.searchParams.append("destinationCurrencyCode",r),s.searchParams.append("walletAddress",n),s.searchParams.append("externalCustomerId",Ue.state.projectId),ce.selectedProvider=pe(M({},t),{url:s.toString()})}else ce.selectedProvider=t},setOnrampProviders(t){if(Array.isArray(t)&&t.every(e=>typeof e=="string")){let e=t,r=nu.filter(n=>e.includes(n.name));ce.providers=r}else ce.providers=[]},setPurchaseCurrency(t){ce.purchaseCurrency=t},setPaymentCurrency(t){ce.paymentCurrency=t},setPurchaseAmount(t){iu.state.purchaseAmount=t},setPaymentAmount(t){iu.state.paymentAmount=t},async getAvailableCurrencies(){let t=await He.getOnrampOptions();ce.purchaseCurrencies=t.purchaseCurrencies,ce.paymentCurrencies=t.paymentCurrencies,ce.paymentCurrency=t.paymentCurrencies[0]||su,ce.purchaseCurrency=t.purchaseCurrencies[0]||bi,await No.fetchCurrencyImages(t.paymentCurrencies.map(e=>e.id)),await No.fetchTokenImages(t.purchaseCurrencies.map(e=>e.symbol))},async getQuote(){ce.quotesLoading=!0;try{let t=await He.getOnrampQuote({purchaseCurrency:ce.purchaseCurrency,paymentCurrency:ce.paymentCurrency,amount:ce.paymentAmount?.toString()||"0",network:ce.purchaseCurrency?.symbol});return ce.quotesLoading=!1,ce.purchaseAmount=Number(t?.purchaseAmount.amount),t}catch(t){return ce.error=t.message,ce.quotesLoading=!1,null}finally{ce.quotesLoading=!1}},resetState(){ce.selectedProvider=null,ce.error=null,ce.purchaseCurrency=bi,ce.paymentCurrency=su,ce.purchaseCurrencies=[bi],ce.paymentCurrencies=[],ce.paymentAmount=void 0,ce.purchaseAmount=void 0,ce.quotesLoading=!1}},iu=hr(Wv);var Kc=Be(qr(),1);var an=Be(qr(),1);var Hp=Be(qr()),Ho=Be(As());var fr=class{};var du=class extends fr{constructor(e){super()}},zp=Ho.FIVE_SECONDS,ln={pulse:"heartbeat_pulse"},zo=class t extends du{constructor(e){super(e),this.events=new Hp.EventEmitter,this.interval=zp,this.interval=e?.interval||zp}static async init(e){let r=new t(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,Ho.toMiliseconds)(this.interval))}pulse(){this.events.emit(ln.pulse)}};var SE=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,IE=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,_E=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function AE(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){TE(t);return}return e}function TE(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Ii(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);let r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!_E.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(SE.test(t)||IE.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,AE)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function CE(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Me(t,...e){try{return CE(t(...e))}catch(r){return Promise.reject(r)}}function DE(t){let e=typeof t;return t===null||e!=="object"&&e!=="function"}function OE(t){let e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function _i(t){if(DE(t))return String(t);if(OE(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return _i(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}var pu="base64:";function Vp(t){return typeof t=="string"?t:pu+RE(t)}function Kp(t){return typeof t!="string"||!t.startsWith(pu)?t:PE(t.slice(pu.length))}function PE(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function RE(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function xt(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function Wp(...t){return xt(t.join(":"))}function Ai(t){return t=xt(t),t?t+":":""}function Gp(t,e){if(e===void 0)return!0;let r=0,n=t.indexOf(":");for(;n>-1;)r++,n=t.indexOf(":",n+1);return r<=e}function Yp(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}var NE="memory",BE=()=>{let t=new Map;return{name:NE,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Zp(t={}){let e={mounts:{"":t.driver||BE()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(let l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},n=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),s=(u,l)=>{if(e.watching){l=xt(l);for(let h of e.watchListeners)h(u,l)}},i=async()=>{if(!e.watching){e.watching=!0;for(let u in e.mounts)e.unwatch[u]=await Jp(e.mounts[u],s,u)}},o=async()=>{if(e.watching){for(let u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{let f=new Map,d=p=>{let g=f.get(p.base);return g||(g={driver:p.driver,base:p.base,items:[]},f.set(p.base,g)),g};for(let p of u){let g=typeof p=="string",w=xt(g?p:p.key),P=g?void 0:p.value,R=g||!p.options?l:M(M({},l),p.options),x=r(w);d(x).items.push({key:w,value:P,relativeKey:x.relativeKey,options:R})}return Promise.all([...f.values()].map(p=>h(p))).then(p=>p.flat())},c={hasItem(u,l={}){u=xt(u);let{relativeKey:h,driver:f}=r(u);return Me(f.hasItem,h,l)},getItem(u,l={}){u=xt(u);let{relativeKey:h,driver:f}=r(u);return Me(f.getItem,h,l).then(d=>Ii(d))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?Me(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),l).then(f=>f.map(d=>({key:Wp(h.base,d.key),value:Ii(d.value)}))):Promise.all(h.items.map(f=>Me(h.driver.getItem,f.relativeKey,f.options).then(d=>({key:f.key,value:Ii(d)})))))},getItemRaw(u,l={}){u=xt(u);let{relativeKey:h,driver:f}=r(u);return f.getItemRaw?Me(f.getItemRaw,h,l):Me(f.getItem,h,l).then(d=>Kp(d))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=xt(u);let{relativeKey:f,driver:d}=r(u);d.setItem&&(await Me(d.setItem,f,_i(l),h),d.watch||s("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return Me(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:_i(f.value),options:f.options})),l);h.driver.setItem&&await Promise.all(h.items.map(f=>Me(h.driver.setItem,f.relativeKey,_i(f.value),f.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=xt(u);let{relativeKey:f,driver:d}=r(u);if(d.setItemRaw)await Me(d.setItemRaw,f,l,h);else if(d.setItem)await Me(d.setItem,f,Vp(l),h);else return;d.watch||s("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=xt(u);let{relativeKey:h,driver:f}=r(u);f.removeItem&&(await Me(f.removeItem,h,l),(l.removeMeta||l.removeMata)&&await Me(f.removeItem,h+"$",l),f.watch||s("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=xt(u);let{relativeKey:h,driver:f}=r(u),d=Object.create(null);if(f.getMeta&&Object.assign(d,await Me(f.getMeta,h,l)),!l.nativeOnly){let p=await Me(f.getItem,h+"$",l).then(g=>Ii(g));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(d,p))}return d},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){u=Ai(u);let h=n(u,!0),f=[],d=[],p=!0;for(let w of h){w.driver.flags?.maxDepth||(p=!1);let P=await Me(w.driver.getKeys,w.relativeBase,l);for(let R of P){let x=w.mountpoint+xt(R);f.some(I=>x.startsWith(I))||d.push(x)}f=[w.mountpoint,...f.filter(R=>!R.startsWith(w.mountpoint))]}let g=l.maxDepth!==void 0&&!p;return d.filter(w=>(!g||Gp(w,l.maxDepth))&&Yp(w,u))},async clear(u,l={}){u=Ai(u),await Promise.all(n(u,!1).map(async h=>{if(h.driver.clear)return Me(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){let f=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(f.map(d=>h.driver.removeItem(d,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>Xp(u)))},async watch(u){return await i(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=Ai(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(Jp(l,s,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){u=Ai(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),l&&await Xp(e.mounts[u]),e.mountpoints=e.mountpoints.filter(h=>h!==u),delete e.mounts[u])},getMount(u=""){u=xt(u)+":";let l=r(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=xt(u),n(u,l.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function Jp(t,e,r){return t.watch?t.watch((n,s)=>e(n,r+s)):()=>{}}async function Xp(t){typeof t.dispose=="function"&&await Me(t.dispose)}function Vn(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function mu(t,e){let r,n=()=>{if(r)return r;let s=indexedDB.open(t);return s.onupgradeneeded=()=>s.result.createObjectStore(e),r=Vn(s),r.then(i=>{i.onclose=()=>r=void 0},()=>{}),r};return(s,i)=>n().then(o=>i(o.transaction(e,s).objectStore(e)))}var gu;function Ti(){return gu||(gu=mu("keyval-store","keyval")),gu}function yu(t,e=Ti()){return e("readonly",r=>Vn(r.get(t)))}function Qp(t,e,r=Ti()){return r("readwrite",n=>(n.put(e,t),Vn(n.transaction)))}function eg(t,e=Ti()){return e("readwrite",r=>(r.delete(t),Vn(r.transaction)))}function tg(t=Ti()){return t("readwrite",e=>(e.clear(),Vn(e.transaction)))}function UE(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Vn(t.transaction)}function rg(t=Ti()){return t("readonly",e=>{if(e.getAllKeys)return Vn(e.getAllKeys());let r=[];return UE(e,n=>r.push(n.key)).then(()=>r)})}var kE="idb-keyval",FE=(t={})=>{let e=t.base&&t.base.length>0?`${t.base}:`:"",r=s=>e+s,n;return t.dbName&&t.storeName&&(n=mu(t.dbName,t.storeName)),{name:kE,options:t,async hasItem(s){return!(typeof await yu(r(s),n)>"u")},async getItem(s){return await yu(r(s),n)??null},setItem(s,i){return Qp(r(s),i,n)},removeItem(s){return eg(r(s),n)},getKeys(){return rg(n)},clear(){return tg(n)}}},LE="WALLET_CONNECT_V2_INDEXED_DB",ME="keyvaluestorage",bu=class{constructor(){this.indexedDb=Zp({driver:FE({dbName:LE,storeName:ME})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){let r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Qt(r))}async removeItem(e){await this.indexedDb.removeItem(e)}},wu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Vo={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){let r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof wu<"u"&&wu.localStorage?Vo.exports=wu.localStorage:typeof window<"u"&&window.localStorage?Vo.exports=window.localStorage:Vo.exports=new e})();function qE(t){var e;return[t[0],Zt((e=t[1])!=null?e:"")]}var vu=class{constructor(){this.localStorage=Vo.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(qE)}async getItem(e){let r=this.localStorage.getItem(e);if(r!==null)return Zt(r)}async setItem(e,r){this.localStorage.setItem(e,Qt(r))}async removeItem(e){this.localStorage.removeItem(e)}},jE="wc_storage_version",ng=1,$E=async(t,e,r)=>{let n=jE,s=await e.getItem(n);if(s&&s>=ng){r(e);return}let i=await t.getKeys();if(!i.length){r(e);return}let o=[];for(;i.length;){let a=i.shift();if(!a)continue;let c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){let u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(n,ng),r(e),zE(t,o)},zE=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})},Ko=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};let e=new vu;this.storage=e;try{let r=new bu;$E(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{let r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var og=Be(qr()),HE=Object.defineProperty,VE=(t,e,r)=>e in t?HE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sg=(t,e,r)=>VE(t,typeof e!="symbol"?e+"":e,r),Wo=class extends fr{constructor(e){super(),this.opts=e,sg(this,"protocol","wc"),sg(this,"version",2)}};var KE=Object.defineProperty,WE=(t,e,r)=>e in t?KE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,GE=(t,e,r)=>WE(t,typeof e!="symbol"?e+"":e,r),Go=class extends fr{constructor(e,r){super(),this.core=e,this.logger=r,GE(this,"records",new Map)}},Yo=class{constructor(e,r){this.logger=e,this.core=r}},Jo=class extends fr{constructor(e,r){super(),this.relayer=e,this.logger=r}},Xo=class extends fr{constructor(e){super()}},Zo=class{constructor(e,r,n,s){this.core=e,this.logger=r,this.name=n}};var Qo=class extends fr{constructor(e,r){super(),this.relayer=e,this.logger=r}};var ea=class extends fr{constructor(e,r){super(),this.core=e,this.logger=r}};var ta=class{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}},ra=class{constructor(e,r){this.projectId=e,this.logger=r}},na=class{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}},YE=Object.defineProperty,JE=(t,e,r)=>e in t?YE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ig=(t,e,r)=>JE(t,typeof e!="symbol"?e+"":e,r);var sa=class{constructor(e){this.opts=e,ig(this,"protocol","wc"),ig(this,"version",2)}};var ia=class{constructor(e){this.client=e}};var X=Be(As(),1);var _g=Be(As());function XE(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ag(t,...e){if(!XE(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function ag(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ZE(t,e){Ag(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}var Ts=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Eu=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function QE(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Tg(t){return typeof t=="string"&&(t=QE(t)),Ag(t),t}var Du=class{clone(){return this._cloneInto()}};function ex(t){let e=n=>t().update(Tg(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Cg(t=32){if(Ts&&typeof Ts.getRandomValues=="function")return Ts.getRandomValues(new Uint8Array(t));if(Ts&&typeof Ts.randomBytes=="function")return Ts.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function tx(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}var Ou=class extends Du{constructor(e,r,n,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Eu(this.buffer)}update(e){ag(this);let{view:r,buffer:n,blockLen:s}=this;e=Tg(e);let i=e.length;for(let o=0;o<i;){let a=Math.min(s-this.pos,i-o);if(a===s){let c=Eu(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ag(this),ZE(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:s,isLE:i}=this,{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;tx(n,s-8,BigInt(this.length*8),i),this.process(n,0);let a=Eu(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%r&&e.buffer.set(n),e}},oa=BigInt(2**32-1),Pu=BigInt(32);function Dg(t,e=!1){return e?{h:Number(t&oa),l:Number(t>>Pu&oa)}:{h:Number(t>>Pu&oa)|0,l:Number(t&oa)|0}}function rx(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let s=0;s<t.length;s++){let{h:i,l:o}=Dg(t[s],e);[r[s],n[s]]=[i,o]}return[r,n]}var nx=(t,e)=>BigInt(t>>>0)<<Pu|BigInt(e>>>0),sx=(t,e,r)=>t>>>r,ix=(t,e,r)=>t<<32-r|e>>>r,ox=(t,e,r)=>t>>>r|e<<32-r,ax=(t,e,r)=>t<<32-r|e>>>r,cx=(t,e,r)=>t<<64-r|e>>>r-32,ux=(t,e,r)=>t>>>r-32|e<<64-r,lx=(t,e)=>e,hx=(t,e)=>t,fx=(t,e,r)=>t<<r|e>>>32-r,dx=(t,e,r)=>e<<r|t>>>32-r,px=(t,e,r)=>e<<r-32|t>>>64-r,gx=(t,e,r)=>t<<r-32|e>>>64-r;function mx(t,e,r,n){let s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}var yx=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),wx=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,bx=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),vx=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,Ex=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),xx=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,re={fromBig:Dg,split:rx,toBig:nx,shrSH:sx,shrSL:ix,rotrSH:ox,rotrSL:ax,rotrBH:cx,rotrBL:ux,rotr32H:lx,rotr32L:hx,rotlSH:fx,rotlSL:dx,rotlBH:px,rotlBL:gx,add:mx,add3L:yx,add3H:wx,add4L:bx,add4H:vx,add5H:xx,add5L:Ex},[Sx,Ix]=re.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),hn=new Uint32Array(80),fn=new Uint32Array(80),Ru=class extends Ou{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:d,Gl:p,Hh:g,Hl:w}=this;return[e,r,n,s,i,o,a,c,u,l,h,f,d,p,g,w]}set(e,r,n,s,i,o,a,c,u,l,h,f,d,p,g,w){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=p|0,this.Hh=g|0,this.Hl=w|0}process(e,r){for(let x=0;x<16;x++,r+=4)hn[x]=e.getUint32(r),fn[x]=e.getUint32(r+=4);for(let x=16;x<80;x++){let I=hn[x-15]|0,C=fn[x-15]|0,B=re.rotrSH(I,C,1)^re.rotrSH(I,C,8)^re.shrSH(I,C,7),k=re.rotrSL(I,C,1)^re.rotrSL(I,C,8)^re.shrSL(I,C,7),U=hn[x-2]|0,N=fn[x-2]|0,j=re.rotrSH(U,N,19)^re.rotrBH(U,N,61)^re.shrSH(U,N,6),b=re.rotrSL(U,N,19)^re.rotrBL(U,N,61)^re.shrSL(U,N,6),E=re.add4L(k,b,fn[x-7],fn[x-16]),v=re.add4H(E,B,j,hn[x-7],hn[x-16]);hn[x]=v|0,fn[x]=E|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:d,Fl:p,Gh:g,Gl:w,Hh:P,Hl:R}=this;for(let x=0;x<80;x++){let I=re.rotrSH(h,f,14)^re.rotrSH(h,f,18)^re.rotrBH(h,f,41),C=re.rotrSL(h,f,14)^re.rotrSL(h,f,18)^re.rotrBL(h,f,41),B=h&d^~h&g,k=f&p^~f&w,U=re.add5L(R,C,k,Ix[x],fn[x]),N=re.add5H(U,P,I,B,Sx[x],hn[x]),j=U|0,b=re.rotrSH(n,s,28)^re.rotrBH(n,s,34)^re.rotrBH(n,s,39),E=re.rotrSL(n,s,28)^re.rotrBL(n,s,34)^re.rotrBL(n,s,39),v=n&i^n&a^i&a,A=s&o^s&c^o&c;P=g|0,R=w|0,g=d|0,w=p|0,d=h|0,p=f|0,{h,l:f}=re.add(u|0,l|0,N|0,j|0),u=a|0,l=c|0,a=i|0,c=o|0,i=n|0,o=s|0;let y=re.add3L(j,E,A);n=re.add3H(y,N,b,v),s=y|0}({h:n,l:s}=re.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=re.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=re.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=re.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=re.add(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:p}=re.add(this.Fh|0,this.Fl|0,d|0,p|0),{h:g,l:w}=re.add(this.Gh|0,this.Gl|0,g|0,w|0),{h:P,l:R}=re.add(this.Hh|0,this.Hl|0,P|0,R|0),this.set(n,s,i,o,a,c,u,l,h,f,d,p,g,w,P,R)}roundClean(){hn.fill(0),fn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},_x=ex(()=>new Ru);var zu=BigInt(0),Og=BigInt(1),Ax=BigInt(2);function Hu(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Vu(t){if(!Hu(t))throw new Error("Uint8Array expected")}function xu(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}var Tx=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ku(t){Vu(t);let e="";for(let r=0;r<t.length;r++)e+=Tx[t[r]];return e}function Pg(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?zu:BigInt("0x"+t)}var jr={_0:48,_9:57,A:65,F:70,a:97,f:102};function cg(t){if(t>=jr._0&&t<=jr._9)return t-jr._0;if(t>=jr.A&&t<=jr.F)return t-(jr.A-10);if(t>=jr.a&&t<=jr.f)return t-(jr.a-10)}function Rg(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){let o=cg(t.charCodeAt(i)),a=cg(t.charCodeAt(i+1));if(o===void 0||a===void 0){let c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function Cx(t){return Pg(Ku(t))}function ua(t){return Vu(t),Pg(Ku(Uint8Array.from(t).reverse()))}function Ng(t,e){return Rg(t.toString(16).padStart(e*2,"0"))}function Nu(t,e){return Ng(t,e).reverse()}function $r(t,e,r){let n;if(typeof e=="string")try{n=Rg(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Hu(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}function ug(...t){let e=0;for(let n=0;n<t.length;n++){let s=t[n];Vu(s),e+=s.length}let r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){let i=t[n];r.set(i,s),s+=i.length}return r}var Su=t=>typeof t=="bigint"&&zu<=t;function Dx(t,e,r){return Su(t)&&Su(e)&&Su(r)&&e<=t&&t<r}function Ci(t,e,r,n){if(!Dx(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Ox(t){let e;for(e=0;t>zu;t>>=Og,e+=1);return e}var Px=t=>(Ax<<BigInt(t-1))-Og,Rx={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Hu(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Wu(t,e,r={}){let n=(s,i,o)=>{let a=Rx[i];if(typeof a!="function")throw new Error("invalid validator function");let c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(let[s,i]of Object.entries(e))n(s,i,!1);for(let[s,i]of Object.entries(r))n(s,i,!0);return t}function lg(t){let e=new WeakMap;return(r,...n)=>{let s=e.get(r);if(s!==void 0)return s;let i=t(r,...n);return e.set(r,i),i}}var Ve=BigInt(0),Re=BigInt(1),Kn=BigInt(2),Nx=BigInt(3),Bu=BigInt(4),hg=BigInt(5),fg=BigInt(8);function qe(t,e){let r=t%e;return r>=Ve?r:e+r}function Bx(t,e,r){if(e<Ve)throw new Error("invalid exponent, negatives unsupported");if(r<=Ve)throw new Error("invalid modulus");if(r===Re)return Ve;let n=Re;for(;e>Ve;)e&Re&&(n=n*t%r),t=t*t%r,e>>=Re;return n}function Pr(t,e,r){let n=t;for(;e-- >Ve;)n*=n,n%=r;return n}function dg(t,e){if(t===Ve)throw new Error("invert: expected non-zero number");if(e<=Ve)throw new Error("invert: expected positive modulus, got "+e);let r=qe(t,e),n=e,s=Ve,i=Re;for(;r!==Ve;){let o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==Re)throw new Error("invert: does not exist");return qe(s,e)}function Ux(t){let e=(t-Re)/Kn,r,n,s;for(r=t-Re,n=0;r%Kn===Ve;r/=Kn,n++);for(s=Kn;s<t&&Bx(s,e,t)!==t-Re;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){let o=(t+Re)/Bu;return function(a,c){let u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}let i=(r+Re)/Kn;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,s),r),l=o.pow(a,i),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let p=o.sqr(h);f<c&&!o.eql(p,o.ONE);f++)p=o.sqr(p);let d=o.pow(u,Re<<BigInt(c-f-1));u=o.sqr(d),l=o.mul(l,d),h=o.mul(h,u),c=f}return l}}function kx(t){if(t%Bu===Nx){let e=(t+Re)/Bu;return function(r,n){let s=r.pow(n,e);if(!r.eql(r.sqr(s),n))throw new Error("Cannot find square root");return s}}if(t%fg===hg){let e=(t-hg)/fg;return function(r,n){let s=r.mul(n,Kn),i=r.pow(s,e),o=r.mul(n,i),a=r.mul(r.mul(o,Kn),i),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return Ux(t)}var Fx=(t,e)=>(qe(t,e)&Re)===Re,Lx=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Mx(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Lx.reduce((n,s)=>(n[s]="function",n),e);return Wu(t,r)}function qx(t,e,r){if(r<Ve)throw new Error("invalid exponent, negatives unsupported");if(r===Ve)return t.ONE;if(r===Re)return e;let n=t.ONE,s=e;for(;r>Ve;)r&Re&&(n=t.mul(n,s)),s=t.sqr(s),r>>=Re;return n}function jx(t,e){let r=new Array(e.length),n=e.reduce((i,o,a)=>t.is0(o)?i:(r[a]=i,t.mul(i,o)),t.ONE),s=t.inv(n);return e.reduceRight((i,o,a)=>t.is0(o)?i:(r[a]=t.mul(i,r[a]),t.mul(i,o)),s),r}function Bg(t,e){let r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Ug(t,e,r=!1,n={}){if(t<=Ve)throw new Error("invalid field: expected ORDER > 0, got "+t);let{nBitLength:s,nByteLength:i}=Bg(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o,a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:i,MASK:Px(s),ZERO:Ve,ONE:Re,create:c=>qe(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ve<=c&&c<t},is0:c=>c===Ve,isOdd:c=>(c&Re)===Re,neg:c=>qe(-c,t),eql:(c,u)=>c===u,sqr:c=>qe(c*c,t),add:(c,u)=>qe(c+u,t),sub:(c,u)=>qe(c-u,t),mul:(c,u)=>qe(c*u,t),pow:(c,u)=>qx(a,c,u),div:(c,u)=>qe(c*dg(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>dg(c,t),sqrt:n.sqrt||(c=>(o||(o=kx(t)),o(a,c))),invertBatch:c=>jx(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?Nu(c,i):Ng(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?ua(c):Cx(c)}});return Object.freeze(a)}var pg=BigInt(0),aa=BigInt(1);function Iu(t,e){let r=e.negate();return t?r:e}function kg(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function _u(t,e){kg(t,e);let r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function $x(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function zx(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}var Au=new WeakMap,Fg=new WeakMap;function Tu(t){return Fg.get(t)||1}function Hx(t,e){return{constTimeNegate:Iu,hasPrecomputes(r){return Tu(r)!==1},unsafeLadder(r,n,s=t.ZERO){let i=r;for(;n>pg;)n&aa&&(s=s.add(i)),i=i.double(),n>>=aa;return s},precomputeWindow(r,n){let{windows:s,windowSize:i}=_u(n,e),o=[],a=r,c=a;for(let u=0;u<s;u++){c=a,o.push(c);for(let l=1;l<i;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,s){let{windows:i,windowSize:o}=_u(r,e),a=t.ZERO,c=t.BASE,u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let f=0;f<i;f++){let d=f*o,p=Number(s&u);s>>=h,p>o&&(p-=l,s+=aa);let g=d,w=d+Math.abs(p)-1,P=f%2!==0,R=p<0;p===0?c=c.add(Iu(P,n[g])):a=a.add(Iu(R,n[w]))}return{p:a,f:c}},wNAFUnsafe(r,n,s,i=t.ZERO){let{windows:o,windowSize:a}=_u(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){let f=h*a;if(s===pg)break;let d=Number(s&c);if(s>>=l,d>a&&(d-=u,s+=aa),d===0)continue;let p=n[f+Math.abs(d)-1];d<0&&(p=p.negate()),i=i.add(p)}return i},getPrecomputes(r,n,s){let i=Au.get(n);return i||(i=this.precomputeWindow(n,r),r!==1&&Au.set(n,s(i))),i},wNAFCached(r,n,s){let i=Tu(r);return this.wNAF(i,this.getPrecomputes(i,r,s),n)},wNAFCachedUnsafe(r,n,s,i){let o=Tu(r);return o===1?this.unsafeLadder(r,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),n,i)},setWindowSize(r,n){kg(n,e),Fg.set(r,n),Au.delete(r)}}}function Vx(t,e,r,n){if($x(r,t),zx(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");let s=t.ZERO,i=Ox(BigInt(r.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),u=Math.floor((e.BITS-1)/o)*o,l=s;for(let h=u;h>=0;h-=o){c.fill(s);for(let d=0;d<n.length;d++){let p=n[d],g=Number(p>>BigInt(h)&BigInt(a));c[g]=c[g].add(r[d])}let f=s;for(let d=c.length-1,p=s;d>0;d--)p=p.add(c[d]),f=f.add(p);if(l=l.add(f),h!==0)for(let d=0;d<o;d++)l=l.double()}return l}function Kx(t){return Mx(t.Fp),Wu(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze(pe(M(M({},Bg(t.n,t.nBitLength)),t),{p:t.Fp.ORDER}))}var dr=BigInt(0),Ot=BigInt(1),ca=BigInt(2),Wx=BigInt(8),Gx={zip215:!0};function Yx(t){let e=Kx(t);return Wu(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze(M({},e))}function Jx(t){let e=Yx(t),{Fp:r,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,u=ca<<BigInt(a*8)-Ot,l=r.create,h=Ug(e.n,e.nBitLength),f=e.uvRatio||((y,m)=>{try{return{isValid:!0,value:r.sqrt(y*r.inv(m))}}catch{return{isValid:!1,value:dr}}}),d=e.adjustScalarBytes||(y=>y),p=e.domain||((y,m,_)=>{if(xu("phflag",_),m.length||_)throw new Error("Contexts/pre-hash are not supported");return y});function g(y,m){Ci("coordinate "+y,m,dr,u)}function w(y){if(!(y instanceof x))throw new Error("ExtendedPoint expected")}let P=lg((y,m)=>{let{ex:_,ey:O,ez:S}=y,T=y.is0();m==null&&(m=T?Wx:r.inv(S));let F=l(_*m),L=l(O*m),K=l(S*m);if(T)return{x:dr,y:Ot};if(K!==Ot)throw new Error("invZ was invalid");return{x:F,y:L}}),R=lg(y=>{let{a:m,d:_}=e;if(y.is0())throw new Error("bad point: ZERO");let{ex:O,ey:S,ez:T,et:F}=y,L=l(O*O),K=l(S*S),H=l(T*T),z=l(H*H),G=l(L*m),J=l(H*l(G+K)),ne=l(z+l(_*l(L*K)));if(J!==ne)throw new Error("bad point: equation left != right (1)");let Y=l(O*S),se=l(T*F);if(Y!==se)throw new Error("bad point: equation left != right (2)");return!0});class x{constructor(m,_,O,S){this.ex=m,this.ey=_,this.ez=O,this.et=S,g("x",m),g("y",_),g("z",O),g("t",S),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(m){if(m instanceof x)throw new Error("extended point not allowed");let{x:_,y:O}=m||{};return g("x",_),g("y",O),new x(_,O,Ot,l(_*O))}static normalizeZ(m){let _=r.invertBatch(m.map(O=>O.ez));return m.map((O,S)=>O.toAffine(_[S])).map(x.fromAffine)}static msm(m,_){return Vx(x,h,m,_)}_setWindowSize(m){B.setWindowSize(this,m)}assertValidity(){R(this)}equals(m){w(m);let{ex:_,ey:O,ez:S}=this,{ex:T,ey:F,ez:L}=m,K=l(_*L),H=l(T*S),z=l(O*L),G=l(F*S);return K===H&&z===G}is0(){return this.equals(x.ZERO)}negate(){return new x(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){let{a:m}=e,{ex:_,ey:O,ez:S}=this,T=l(_*_),F=l(O*O),L=l(ca*l(S*S)),K=l(m*T),H=_+O,z=l(l(H*H)-T-F),G=K+F,J=G-L,ne=K-F,Y=l(z*J),se=l(G*ne),_e=l(z*ne),Fe=l(J*G);return new x(Y,se,Fe,_e)}add(m){w(m);let{a:_,d:O}=e,{ex:S,ey:T,ez:F,et:L}=this,{ex:K,ey:H,ez:z,et:G}=m;if(_===BigInt(-1)){let np=l((T-S)*(H+K)),sp=l((T+S)*(H-K)),ru=l(sp-np);if(ru===dr)return this.double();let ip=l(F*ca*G),op=l(L*ca*z),ap=op+ip,cp=sp+np,up=op-ip,$v=l(ap*ru),zv=l(cp*up),Hv=l(ap*up),Vv=l(ru*cp);return new x($v,zv,Vv,Hv)}let J=l(S*K),ne=l(T*H),Y=l(L*O*G),se=l(F*z),_e=l((S+T)*(K+H)-J-ne),Fe=se-Y,$e=se+Y,bt=l(ne-_*J),Dr=l(_e*Fe),Po=l($e*bt),qv=l(_e*bt),jv=l(Fe*$e);return new x(Dr,Po,jv,qv)}subtract(m){return this.add(m.negate())}wNAF(m){return B.wNAFCached(this,m,x.normalizeZ)}multiply(m){let _=m;Ci("scalar",_,Ot,n);let{p:O,f:S}=this.wNAF(_);return x.normalizeZ([O,S])[0]}multiplyUnsafe(m,_=x.ZERO){let O=m;return Ci("scalar",O,dr,n),O===dr?C:this.is0()||O===Ot?this:B.wNAFCachedUnsafe(this,O,x.normalizeZ,_)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return B.unsafeLadder(this,n).is0()}toAffine(m){return P(this,m)}clearCofactor(){let{h:m}=e;return m===Ot?this:this.multiplyUnsafe(m)}static fromHex(m,_=!1){let{d:O,a:S}=e,T=r.BYTES;m=$r("pointHex",m,T),xu("zip215",_);let F=m.slice(),L=m[T-1];F[T-1]=L&-129;let K=ua(F),H=_?u:r.ORDER;Ci("pointHex.y",K,dr,H);let z=l(K*K),G=l(z-Ot),J=l(O*z-S),{isValid:ne,value:Y}=f(G,J);if(!ne)throw new Error("Point.fromHex: invalid y coordinate");let se=(Y&Ot)===Ot,_e=(L&128)!==0;if(!_&&Y===dr&&_e)throw new Error("Point.fromHex: x=0 and x_0=1");return _e!==se&&(Y=l(-Y)),x.fromAffine({x:Y,y:K})}static fromPrivateKey(m){return N(m).point}toRawBytes(){let{x:m,y:_}=this.toAffine(),O=Nu(_,r.BYTES);return O[O.length-1]|=m&Ot?128:0,O}toHex(){return Ku(this.toRawBytes())}}x.BASE=new x(e.Gx,e.Gy,Ot,l(e.Gx*e.Gy)),x.ZERO=new x(dr,Ot,Ot,dr);let{BASE:I,ZERO:C}=x,B=Hx(x,a*8);function k(y){return qe(y,n)}function U(y){return k(ua(y))}function N(y){let m=r.BYTES;y=$r("private key",y,m);let _=$r("hashed private key",i(y),2*m),O=d(_.slice(0,m)),S=_.slice(m,2*m),T=U(O),F=I.multiply(T),L=F.toRawBytes();return{head:O,prefix:S,scalar:T,point:F,pointBytes:L}}function j(y){return N(y).pointBytes}function b(y=new Uint8Array,...m){let _=ug(...m);return U(i(p(_,$r("context",y),!!s)))}function E(y,m,_={}){y=$r("message",y),s&&(y=s(y));let{prefix:O,scalar:S,pointBytes:T}=N(m),F=b(_.context,O,y),L=I.multiply(F).toRawBytes(),K=b(_.context,L,T,y),H=k(F+K*S);Ci("signature.s",H,dr,n);let z=ug(L,Nu(H,r.BYTES));return $r("result",z,r.BYTES*2)}let v=Gx;function A(y,m,_,O=v){let{context:S,zip215:T}=O,F=r.BYTES;y=$r("signature",y,2*F),m=$r("message",m),_=$r("publicKey",_,F),T!==void 0&&xu("zip215",T),s&&(m=s(m));let L=ua(y.slice(F,2*F)),K,H,z;try{K=x.fromHex(_,T),H=x.fromHex(y.slice(0,F),T),z=I.multiplyUnsafe(L)}catch{return!1}if(!T&&K.isSmallOrder())return!1;let G=b(S,H.toRawBytes(),K.toRawBytes(),m);return H.add(K.multiplyUnsafe(G)).subtract(z).clearCofactor().equals(x.ZERO)}return I._setWindowSize(8),{CURVE:e,getPublicKey:j,sign:E,verify:A,ExtendedPoint:x,utils:{getExtendedPublicKey:N,randomPrivateKey:()=>o(r.BYTES),precompute(y=8,m=x.BASE){return m._setWindowSize(y),m.multiply(BigInt(3)),m}}}}BigInt(0),BigInt(1);var Gu=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),gg=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);var Xx=BigInt(1),mg=BigInt(2);BigInt(3);var Zx=BigInt(5),Qx=BigInt(8);function e2(t){let e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=Gu,o=t*t%i*t%i,a=Pr(o,mg,i)*o%i,c=Pr(a,Xx,i)*t%i,u=Pr(c,Zx,i)*c%i,l=Pr(u,e,i)*u%i,h=Pr(l,r,i)*l%i,f=Pr(h,n,i)*h%i,d=Pr(f,s,i)*f%i,p=Pr(d,s,i)*f%i,g=Pr(p,e,i)*u%i;return{pow_p_5_8:Pr(g,mg,i)*t%i,b2:o}}function t2(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function r2(t,e){let r=Gu,n=qe(e*e*e,r),s=qe(n*n*e,r),i=e2(t*s).pow_p_5_8,o=qe(t*n*i,r),a=qe(e*o*o,r),c=o,u=qe(o*gg,r),l=a===t,h=a===qe(-t,r),f=a===qe(-t*gg,r);return l&&(o=c),(h||f)&&(o=u),Fx(o,r)&&(o=qe(-o,r)),{isValid:l||h,value:o}}var n2=Ug(Gu,void 0,!0),s2={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:n2,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Qx,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:_x,randomBytes:Cg,adjustScalarBytes:t2,uvRatio:r2},Lg=Jx(s2),i2="EdDSA",o2="JWT",la=".",fa="base64url",Mg="utf8",qg="utf8",a2=":",c2="did",u2="key",yg="base58btc",l2="z",h2="K36";var f2=32;function Yu(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function jg(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Yu(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function $g(t,e){e||(e=t.reduce((s,i)=>s+i.length,0));let r=jg(e),n=0;for(let s of t)r.set(s,n),n+=s.length;return Yu(r)}function d2(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,P=0,R=p.length;P!==R&&p[P]===0;)P++,g++;for(var x=(R-P)*l+1>>>0,I=new Uint8Array(x);P!==R;){for(var C=p[P],B=0,k=x-1;(C!==0||B<w)&&k!==-1;k--,B++)C+=256*I[k]>>>0,I[k]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");w=B,P++}for(var U=x-w;U!==x&&I[U]===0;)U++;for(var N=c.repeat(g);U<x;++U)N+=t.charAt(I[U]);return N}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,P=0;p[g]===c;)w++,g++;for(var R=(p.length-g)*u+1>>>0,x=new Uint8Array(R);p[g];){var I=r[p.charCodeAt(g)];if(I===255)return;for(var C=0,B=R-1;(I!==0||C<P)&&B!==-1;B--,C++)I+=a*x[B]>>>0,x[B]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");P=C,g++}if(p[g]!==" "){for(var k=R-P;k!==R&&x[k]===0;)k++;for(var U=new Uint8Array(w+(R-k)),N=w;k!==R;)U[N++]=x[k++];return U}}}function d(p){var g=f(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var p2=d2,g2=p2,zg=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},m2=t=>new TextEncoder().encode(t),y2=t=>new TextDecoder().decode(t),Uu=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ku=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Hg(this,e)}},Fu=class{constructor(e){this.decoders=e}or(e){return Hg(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Hg=(t,e)=>new Fu(M(M({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e})),Lu=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new Uu(e,r,n),this.decoder=new ku(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},da=({name:t,prefix:e,encode:r,decode:n})=>new Lu(t,e,r,n),Di=({prefix:t,name:e,alphabet:r})=>{let{encode:n,decode:s}=g2(r,e);return da({prefix:t,name:e,encode:n,decode:i=>zg(s(i))})},w2=(t,e,r,n)=>{let s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*r/8|0),a=0,c=0,u=0;for(let l=0;l<i;++l){let h=s[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},b2=(t,e,r)=>{let n=e[e.length-1]==="=",s=(1<<r)-1,i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},Je=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>da({prefix:e,name:t,encode(s){return b2(s,n,r)},decode(s){return w2(s,n,r,t)}}),v2=da({prefix:"\0",name:"identity",encode:t=>y2(t),decode:t=>m2(t)}),E2=Object.freeze({__proto__:null,identity:v2}),x2=Je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),S2=Object.freeze({__proto__:null,base2:x2}),I2=Je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),_2=Object.freeze({__proto__:null,base8:I2}),A2=Di({prefix:"9",name:"base10",alphabet:"0123456789"}),T2=Object.freeze({__proto__:null,base10:A2}),C2=Je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),D2=Je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),O2=Object.freeze({__proto__:null,base16:C2,base16upper:D2}),P2=Je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),R2=Je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),N2=Je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),B2=Je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),U2=Je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),k2=Je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),F2=Je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),L2=Je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),M2=Je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),q2=Object.freeze({__proto__:null,base32:P2,base32upper:R2,base32pad:N2,base32padupper:B2,base32hex:U2,base32hexupper:k2,base32hexpad:F2,base32hexpadupper:L2,base32z:M2}),j2=Di({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),$2=Di({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),z2=Object.freeze({__proto__:null,base36:j2,base36upper:$2}),H2=Di({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),V2=Di({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),K2=Object.freeze({__proto__:null,base58btc:H2,base58flickr:V2}),W2=Je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),G2=Je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Y2=Je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),J2=Je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),X2=Object.freeze({__proto__:null,base64:W2,base64pad:G2,base64url:Y2,base64urlpad:J2}),Vg=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Z2=Vg.reduce((t,e,r)=>(t[r]=e,t),[]),Q2=Vg.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function eS(t){return t.reduce((e,r)=>(e+=Z2[r],e),"")}function tS(t){let e=[];for(let r of t){let n=Q2[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}var rS=da({prefix:"\u{1F680}",name:"base256emoji",encode:eS,decode:tS}),nS=Object.freeze({__proto__:null,base256emoji:rS}),sS=Kg,wg=128,iS=127,oS=~iS,aS=Math.pow(2,31);function Kg(t,e,r){e=e||[],r=r||0;for(var n=r;t>=aS;)e[r++]=t&255|wg,t/=128;for(;t&oS;)e[r++]=t&255|wg,t>>>=7;return e[r]=t|0,Kg.bytes=r-n+1,e}var cS=Mu,uS=128,bg=127;function Mu(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw Mu.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&bg)<<s:(o&bg)*Math.pow(2,s),s+=7}while(o>=uS);return Mu.bytes=i-n,r}var lS=Math.pow(2,7),hS=Math.pow(2,14),fS=Math.pow(2,21),dS=Math.pow(2,28),pS=Math.pow(2,35),gS=Math.pow(2,42),mS=Math.pow(2,49),yS=Math.pow(2,56),wS=Math.pow(2,63),bS=function(t){return t<lS?1:t<hS?2:t<fS?3:t<dS?4:t<pS?5:t<gS?6:t<mS?7:t<yS?8:t<wS?9:10},vS={encode:sS,decode:cS,encodingLength:bS},Wg=vS,vg=(t,e,r=0)=>(Wg.encode(t,e,r),e),Eg=t=>Wg.encodingLength(t),qu=(t,e)=>{let r=e.byteLength,n=Eg(t),s=n+Eg(r),i=new Uint8Array(s+r);return vg(t,i,0),vg(r,i,n),i.set(e,s),new ju(t,r,e,i)},ju=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}},Gg=({name:t,code:e,encode:r})=>new $u(t,e,r),$u=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?qu(this.code,r):r.then(n=>qu(this.code,n))}else throw Error("Unknown type, must be binary type")}},Yg=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),ES=Gg({name:"sha2-256",code:18,encode:Yg("SHA-256")}),xS=Gg({name:"sha2-512",code:19,encode:Yg("SHA-512")}),SS=Object.freeze({__proto__:null,sha256:ES,sha512:xS}),Jg=0,IS="identity",Xg=zg,_S=t=>qu(Jg,Xg(t)),AS={code:Jg,name:IS,encode:Xg,digest:_S},TS=Object.freeze({__proto__:null,identity:AS});new TextEncoder,new TextDecoder;var xg=M(M(M(M(M(M(M(M(M(M({},E2),S2),_2),T2),O2),q2),z2),K2),X2),nS);M(M({},SS),TS);function Zg(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}var Sg=Zg("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Cu=Zg("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=jg(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Qg=M({utf8:Sg,"utf-8":Sg,hex:xg.base16,latin1:Cu,ascii:Cu,binary:Cu},xg);function pa(t,e="utf8"){let r=Qg[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Cs(t,e="utf8"){let r=Qg[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Yu(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Ig(t){return Zt(pa(Cs(t,fa),Mg))}function ha(t){return pa(Cs(Qt(t),Mg),fa)}function Ju(t){let e=Cs(h2,yg),r=l2+pa($g([e,t]),yg);return[c2,u2,r].join(a2)}function CS(t){return pa(t,fa)}function DS(t){return Cs(t,fa)}function OS(t){return Cs([ha(t.header),ha(t.payload)].join(la),qg)}function PS(t){return[ha(t.header),ha(t.payload),CS(t.signature)].join(la)}function Oi(t){let e=t.split(la),r=Ig(e[0]),n=Ig(e[1]),s=DS(e[2]),i=Cs(e.slice(0,2).join(la),qg);return{header:r,payload:n,signature:s,data:i}}function Xu(t=Cg(f2)){let e=Lg.getPublicKey(t);return{secretKey:$g([t,e]),publicKey:e}}async function em(t,e,r,n,s=(0,_g.fromMiliseconds)(Date.now())){let i={alg:i2,typ:o2},o=Ju(n.publicKey),a=s+r,c={iss:o,sub:t,aud:e,iat:s,exp:a},u=OS({header:i,payload:c}),l=Lg.sign(u,n.secretKey.slice(0,32));return PS({header:i,payload:c,signature:l})}var tm=function(t,e,r){if(r||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))},NS=(function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t})();var BS=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t})();var US=(function(){function t(e,r,n,s){this.name=e,this.version=r,this.os=n,this.bot=s,this.type="bot-device"}return t})();var kS=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})();var FS=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})();var LS=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,MS=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,rm=3,qS=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",LS]],nm=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function im(t){return t?sm(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new FS:typeof navigator<"u"?sm(navigator.userAgent):zS()}function jS(t){return t!==""&&qS.reduce(function(e,r){var n=r[0],s=r[1];if(e)return e;var i=s.exec(t);return!!i&&[n,i]},!1)}function sm(t){var e=jS(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new kS;var s=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);s?s.length<rm&&(s=tm(tm([],s,!0),HS(rm-s.length),!0)):s=[];var i=s.join("."),o=$S(t),a=MS.exec(t);return a&&a[1]?new US(r,i,o,a[1]):new NS(r,i,o)}function $S(t){for(var e=0,r=nm.length;e<r;e++){var n=nm[e],s=n[0],i=n[1],o=i.exec(t);if(o)return s}return null}function zS(){var t=typeof process<"u"&&process.version;return t?new BS(process.version.slice(1)):null}function HS(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Qr=Be(As(),1),br=Be(ga(),1),H0=Be(am(),1);var cm="0.1.1";function um(){return cm}var de=class t extends Error{constructor(e,r={}){let n=(()=>{if(r.cause instanceof t){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),s=r.cause instanceof t&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${s??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||s?["",n?`Details: ${n}`:void 0,s?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${um()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=s,this.shortMessage=e}walk(e){return lm(this,e)}};function lm(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?lm(t.cause,e):e?null:t}var tl=BigInt(0),el=BigInt(1);function Ps(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function rl(t){if(!Ps(t))throw new Error("Uint8Array expected")}function Rs(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Pi(t){let e=t.toString(16);return e.length&1?"0"+e:e}function dm(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?tl:BigInt("0x"+t)}var pm=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",rI=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ns(t){if(rl(t),pm)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=rI[t[r]];return e}var zr={_0:48,_9:57,A:65,F:70,a:97,f:102};function hm(t){if(t>=zr._0&&t<=zr._9)return t-zr._0;if(t>=zr.A&&t<=zr.F)return t-(zr.A-10);if(t>=zr.a&&t<=zr.f)return t-(zr.a-10)}function Ri(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(pm)return Uint8Array.fromHex(t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){let o=hm(t.charCodeAt(i)),a=hm(t.charCodeAt(i+1));if(o===void 0||a===void 0){let c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function Hr(t){return dm(Ns(t))}function nl(t){return rl(t),dm(Ns(Uint8Array.from(t).reverse()))}function Gn(t,e){return Ri(t.toString(16).padStart(e*2,"0"))}function sl(t,e){return Gn(t,e).reverse()}function Pt(t,e,r){let n;if(typeof e=="string")try{n=Ri(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Ps(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}function Ni(...t){let e=0;for(let n=0;n<t.length;n++){let s=t[n];rl(s),e+=s.length}let r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){let i=t[n];r.set(i,s),s+=i.length}return r}var Zu=t=>typeof t=="bigint"&&tl<=t;function ya(t,e,r){return Zu(t)&&Zu(e)&&Zu(r)&&e<=t&&t<r}function Yn(t,e,r,n){if(!ya(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function gm(t){let e;for(e=0;t>tl;t>>=el,e+=1);return e}var Jn=t=>(el<<BigInt(t))-el,Qu=t=>new Uint8Array(t),fm=t=>Uint8Array.from(t);function mm(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Qu(t),s=Qu(t),i=0,o=()=>{n.fill(1),s.fill(0),i=0},a=(...h)=>r(s,n,...h),c=(h=Qu(0))=>{s=a(fm([0]),h),n=a(),h.length!==0&&(s=a(fm([1]),h),n=a())},u=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let h=0,f=[];for(;h<e;){n=a();let d=n.slice();f.push(d),h+=n.length}return Ni(...f)};return(h,f)=>{o(),c(h);let d;for(;!(d=f(u()));)c();return o(),d}}var nI={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ps(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Xn(t,e,r={}){let n=(s,i,o)=>{let a=nI[i];if(typeof a!="function")throw new Error("invalid validator function");let c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(let[s,i]of Object.entries(e))n(s,i,!1);for(let[s,i]of Object.entries(r))n(s,i,!0);return t}function il(t){let e=new WeakMap;return(r,...n)=>{let s=e.get(r);if(s!==void 0)return s;let i=t(r,...n);return e.set(r,i),i}}function ym(t,e){if(ol(t)>e)throw new wa({givenSize:ol(t),maxSize:e})}var Vr={zero:48,nine:57,A:65,F:70,a:97,f:102};function al(t){if(t>=Vr.zero&&t<=Vr.nine)return t-Vr.zero;if(t>=Vr.A&&t<=Vr.F)return t-(Vr.A-10);if(t>=Vr.a&&t<=Vr.f)return t-(Vr.a-10)}function wm(t,e={}){let{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new ba({size:t.length,targetSize:n,type:"Bytes"});let s=new Uint8Array(n);for(let i=0;i<n;i++){let o=r==="right";s[o?i:n-i-1]=t[o?i:t.length-i-1]}return s}function va(t,e){if(er(t)>e)throw new Ea({givenSize:er(t),maxSize:e})}function bm(t,e){if(typeof e=="number"&&e>0&&e>er(t)-1)throw new Bi({offset:e,position:"start",size:er(t)})}function vm(t,e,r){if(typeof e=="number"&&typeof r=="number"&&er(t)!==r-e)throw new Bi({offset:r,position:"end",size:er(t)})}function cl(t,e={}){let{dir:r,size:n=32}=e;if(n===0)return t;let s=t.replace("0x","");if(s.length>n*2)throw new xa({size:Math.ceil(s.length/2),targetSize:n,type:"Hex"});return`0x${s[r==="right"?"padEnd":"padStart"](n*2,"0")}`}function Em(t,e={}){let{dir:r="left"}=e,n=t.replace("0x",""),s=0;for(let i=0;i<n.length-1&&n[r==="left"?i:n.length-i-1].toString()==="0";i++)s++;return n=r==="left"?n.slice(s):n.slice(0,n.length-s),n==="0"?"0x":r==="right"&&n.length%2===1?`0x${n}0`:`0x${n}`}var iI="#__bigint";function dn(t,e,r){return JSON.stringify(t,(n,s)=>typeof e=="function"?e(n,s):typeof s=="bigint"?s.toString()+iI:s,r)}var oI=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function aI(t,e={}){let{strict:r=!1}=e;if(!t)throw new Sa(t);if(typeof t!="string")throw new Sa(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new Ia(t);if(!t.startsWith("0x"))throw new Ia(t)}function _a(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Rr(t){return t instanceof Uint8Array?jt(t):Array.isArray(t)?jt(new Uint8Array(t)):t}function jt(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=oI[t[s]];let n=`0x${r}`;return typeof e.size=="number"?(va(n,e.size),ll(n,e.size)):n}function $t(t,e={}){let{signed:r,size:n}=e,s=BigInt(t),i;n?r?i=(1n<<BigInt(n)*8n-1n)-1n:i=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));let o=typeof i=="bigint"&&r?-i-1n:0;if(i&&s>i||s<o){let u=typeof t=="bigint"?"n":"";throw new ul({max:i?`${i}${u}`:void 0,min:`${o}${u}`,signed:r,size:n,value:`${t}${u}`})}let c=`0x${(r&&s<0?(1n<<BigInt(n*8))+BigInt(s):s).toString(16)}`;return n?cI(c,n):c}function cI(t,e){return cl(t,{dir:"left",size:e})}function ll(t,e){return cl(t,{dir:"right",size:e})}function pr(t,e,r,n={}){let{strict:s}=n;bm(t,e);let i=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return s&&vm(i,e,r),i}function er(t){return Math.ceil((t.length-2)/2)}function hl(t){return Em(t,{dir:"left"})}function fl(t,e={}){let{strict:r=!1}=e;try{return aI(t,{strict:r}),!0}catch{return!1}}var ul=class extends de{constructor({max:e,min:r,signed:n,size:s,value:i}){super(`Number \`${i}\` is not in safe${s?` ${s*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}};var Sa=class extends de{constructor(e){super(`Value \`${typeof e=="object"?dn(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}},Ia=class extends de{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}};var Ea=class extends de{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}},Bi=class extends de{constructor({offset:e,position:r,size:n}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}},xa=class extends de{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};var uI=new TextEncoder;function lI(t){if(!(t instanceof Uint8Array)){if(!t)throw new Bs(t);if(typeof t!="object")throw new Bs(t);if(!("BYTES_PER_ELEMENT"in t))throw new Bs(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new Bs(t)}}function Us(t){return t instanceof Uint8Array?t:typeof t=="string"?ki(t):hI(t)}function hI(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function ki(t,e={}){let{size:r}=e,n=t;r&&(va(t,r),n=ll(t,r));let s=n.slice(2);s.length%2&&(s=`0${s}`);let i=s.length/2,o=new Uint8Array(i);for(let a=0,c=0;a<i;a++){let u=al(s.charCodeAt(c++)),l=al(s.charCodeAt(c++));if(u===void 0||l===void 0)throw new de(`Invalid byte sequence ("${s[c-2]}${s[c-1]}" in "${s}").`);o[a]=u*16+l}return o}function Sm(t,e={}){let{size:r}=e,n=uI.encode(t);return typeof r=="number"?(ym(n,r),fI(n,r)):n}function fI(t,e){return wm(t,{dir:"right",size:e})}function ol(t){return t.length}function Im(t){try{return lI(t),!0}catch{return!1}}var Bs=class extends de{constructor(e){super(`Value \`${typeof e=="object"?dn(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}},wa=class extends de{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}};var ba=class extends de{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}};function dl(t,e={}){let{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=yp(Us(t));return r==="Bytes"?n:jt(n)}var Aa=class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){let r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){let n=this.keys().next().value;n&&this.delete(n)}return this}};var dI={checksum:new Aa(8192)},Ta=dI.checksum;function Tm(t,e={}){let{compressed:r}=e,{prefix:n,x:s,y:i}=t;if(r===!1||typeof s=="bigint"&&typeof i=="bigint"){if(n!==4)throw new Ca({prefix:n,cause:new ml});return}if(r===!0||typeof s=="bigint"&&typeof i>"u"){if(n!==3&&n!==2)throw new Ca({prefix:n,cause:new gl});return}throw new pl({publicKey:t})}function wl(t){let e=(()=>{if(fl(t))return Cm(t);if(Im(t))return pI(t);let{prefix:r,x:n,y:s}=t;return typeof n=="bigint"&&typeof s=="bigint"?{prefix:r??4,x:n,y:s}:{prefix:r,x:n}})();return Tm(e),e}function pI(t){return Cm(jt(t))}function Cm(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new yl({publicKey:t});if(t.length===130){let n=BigInt(pr(t,0,32)),s=BigInt(pr(t,32,64));return{prefix:4,x:n,y:s}}if(t.length===132){let n=Number(pr(t,0,1)),s=BigInt(pr(t,1,33)),i=BigInt(pr(t,33,65));return{prefix:n,x:s,y:i}}let e=Number(pr(t,0,1)),r=BigInt(pr(t,1,33));return{prefix:e,x:r}}function Dm(t,e={}){return ki(Fi(t,e))}function Fi(t,e={}){Tm(t);let{prefix:r,x:n,y:s}=t,{includePrefix:i=!0}=e;return _a(i?$t(r,{size:1}):"0x",$t(n,{size:32}),typeof s=="bigint"?$t(s,{size:32}):"0x")}var pl=class extends de{constructor({publicKey:e}){super(`Value \`${dn(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}},Ca=class extends de{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}},gl=class extends de{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}},ml=class extends de{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}},yl=class extends de{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${er(Rr(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};var gI=/^0x[a-fA-F0-9]{40}$/;function Da(t,e={}){let{strict:r=!0}=e;if(!gI.test(t))throw new Oa({address:t,cause:new vl});if(r){if(t.toLowerCase()===t)return;if(Om(t)!==t)throw new Oa({address:t,cause:new El})}}function Om(t){if(Ta.has(t))return Ta.get(t);Da(t,{strict:!1});let e=t.substring(2).toLowerCase(),r=dl(Sm(e),{as:"Bytes"}),n=e.split("");for(let i=0;i<40;i+=2)r[i>>1]>>4>=8&&n[i]&&(n[i]=n[i].toUpperCase()),(r[i>>1]&15)>=8&&n[i+1]&&(n[i+1]=n[i+1].toUpperCase());let s=`0x${n.join("")}`;return Ta.set(t,s),s}function mI(t,e={}){let{checksum:r=!1}=e;return Da(t),r?Om(t):t}function Pm(t,e={}){let r=dl(`0x${Fi(t).slice(4)}`).substring(26);return mI(`0x${r}`,e)}function Rm(t,e){return Da(t,{strict:!1}),Da(e,{strict:!1}),t.toLowerCase()===e.toLowerCase()}var Oa=class extends de{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}},vl=class extends de{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}},El=class extends de{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}};var qN=2n**(8n-1n)-1n,jN=2n**(16n-1n)-1n,$N=2n**(24n-1n)-1n,zN=2n**(32n-1n)-1n,HN=2n**(40n-1n)-1n,VN=2n**(48n-1n)-1n,KN=2n**(56n-1n)-1n,WN=2n**(64n-1n)-1n,GN=2n**(72n-1n)-1n,YN=2n**(80n-1n)-1n,JN=2n**(88n-1n)-1n,XN=2n**(96n-1n)-1n,ZN=2n**(104n-1n)-1n,QN=2n**(112n-1n)-1n,eB=2n**(120n-1n)-1n,tB=2n**(128n-1n)-1n,rB=2n**(136n-1n)-1n,nB=2n**(144n-1n)-1n,sB=2n**(152n-1n)-1n,iB=2n**(160n-1n)-1n,oB=2n**(168n-1n)-1n,aB=2n**(176n-1n)-1n,cB=2n**(184n-1n)-1n,uB=2n**(192n-1n)-1n,lB=2n**(200n-1n)-1n,hB=2n**(208n-1n)-1n,fB=2n**(216n-1n)-1n,dB=2n**(224n-1n)-1n,pB=2n**(232n-1n)-1n,gB=2n**(240n-1n)-1n,mB=2n**(248n-1n)-1n,yB=2n**(256n-1n)-1n,wB=-(2n**(8n-1n)),bB=-(2n**(16n-1n)),vB=-(2n**(24n-1n)),EB=-(2n**(32n-1n)),xB=-(2n**(40n-1n)),SB=-(2n**(48n-1n)),IB=-(2n**(56n-1n)),_B=-(2n**(64n-1n)),AB=-(2n**(72n-1n)),TB=-(2n**(80n-1n)),CB=-(2n**(88n-1n)),DB=-(2n**(96n-1n)),OB=-(2n**(104n-1n)),PB=-(2n**(112n-1n)),RB=-(2n**(120n-1n)),NB=-(2n**(128n-1n)),BB=-(2n**(136n-1n)),UB=-(2n**(144n-1n)),kB=-(2n**(152n-1n)),FB=-(2n**(160n-1n)),LB=-(2n**(168n-1n)),MB=-(2n**(176n-1n)),qB=-(2n**(184n-1n)),jB=-(2n**(192n-1n)),$B=-(2n**(200n-1n)),zB=-(2n**(208n-1n)),HB=-(2n**(216n-1n)),VB=-(2n**(224n-1n)),KB=-(2n**(232n-1n)),WB=-(2n**(240n-1n)),GB=-(2n**(248n-1n)),YB=-(2n**(256n-1n)),JB=2n**8n-1n,XB=2n**16n-1n,ZB=2n**24n-1n,QB=2n**32n-1n,e5=2n**40n-1n,t5=2n**48n-1n,r5=2n**56n-1n,n5=2n**64n-1n,s5=2n**72n-1n,i5=2n**80n-1n,o5=2n**88n-1n,a5=2n**96n-1n,c5=2n**104n-1n,u5=2n**112n-1n,l5=2n**120n-1n,h5=2n**128n-1n,f5=2n**136n-1n,d5=2n**144n-1n,p5=2n**152n-1n,g5=2n**160n-1n,m5=2n**168n-1n,y5=2n**176n-1n,w5=2n**184n-1n,b5=2n**192n-1n,v5=2n**200n-1n,E5=2n**208n-1n,x5=2n**216n-1n,S5=2n**224n-1n,I5=2n**232n-1n,_5=2n**240n-1n,A5=2n**248n-1n,xl=2n**256n-1n;var La={};ze(La,{InvalidRError:()=>Na,InvalidSError:()=>Ba,InvalidSerializedSizeError:()=>Ra,InvalidVError:()=>Ua,InvalidYParityError:()=>ts,MissingPropertiesError:()=>ks,assert:()=>ka,extract:()=>NI,from:()=>Ml,fromBytes:()=>ey,fromDerBytes:()=>BI,fromDerHex:()=>ty,fromHex:()=>Ll,fromLegacy:()=>ry,fromRpc:()=>ny,fromTuple:()=>UI,toBytes:()=>kI,toDerBytes:()=>FI,toDerHex:()=>LI,toHex:()=>sy,toLegacy:()=>MI,toRpc:()=>qI,toTuple:()=>jI,vToYParity:()=>Fa,validate:()=>$I,yParityToV:()=>ql});var St=BigInt(0),st=BigInt(1),es=BigInt(2),yI=BigInt(3),km=BigInt(4),Fm=BigInt(5),Lm=BigInt(8);function nt(t,e){let r=t%e;return r>=St?r:e+r}function zt(t,e,r){let n=t;for(;e-- >St;)n*=n,n%=r;return n}function Pa(t,e){if(t===St)throw new Error("invert: expected non-zero number");if(e<=St)throw new Error("invert: expected positive modulus, got "+e);let r=nt(t,e),n=e,s=St,i=st,o=st,a=St;for(;r!==St;){let u=n/r,l=n%r,h=s-o*u,f=i-a*u;n=r,r=l,s=o,i=a,o=h,a=f}if(n!==st)throw new Error("invert: does not exist");return nt(s,e)}function Mm(t,e){let r=(t.ORDER+st)/km,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function wI(t,e){let r=(t.ORDER-Fm)/Lm,n=t.mul(e,es),s=t.pow(n,r),i=t.mul(e,s),o=t.mul(t.mul(i,es),s),a=t.mul(i,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function bI(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-st,r=0;for(;e%es===St;)e/=es,r++;let n=es,s=Li(t);for(;Um(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Mm;let i=s.pow(n,e),o=(e+st)/es;return function(c,u){if(c.is0(u))return u;if(Um(c,u)!==1)throw new Error("Cannot find square root");let l=r,h=c.mul(c.ONE,i),f=c.pow(u,e),d=c.pow(u,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let p=1,g=c.sqr(f);for(;!c.eql(g,c.ONE);)if(p++,g=c.sqr(g),p===l)throw new Error("Cannot find square root");let w=st<<BigInt(l-p-1),P=c.pow(h,w);l=p,h=c.sqr(P),f=c.mul(f,h),d=c.mul(d,P)}return d}}function vI(t){return t%km===yI?Mm:t%Lm===Fm?wI:bI(t)}var EI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Sl(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=EI.reduce((n,s)=>(n[s]="function",n),e);return Xn(t,r)}function xI(t,e,r){if(r<St)throw new Error("invalid exponent, negatives unsupported");if(r===St)return t.ONE;if(r===st)return e;let n=t.ONE,s=e;for(;r>St;)r&st&&(n=t.mul(n,s)),s=t.sqr(s),r>>=st;return n}function Il(t,e,r=!1){let n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function Um(t,e){let r=(t.ORDER-st)/es,n=t.pow(e,r),s=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function _l(t,e){e!==void 0&&pp(e);let r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Li(t,e,r=!1,n={}){if(t<=St)throw new Error("invalid field: expected ORDER > 0, got "+t);let{nBitLength:s,nByteLength:i}=_l(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o,a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:i,MASK:Jn(s),ZERO:St,ONE:st,create:c=>nt(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return St<=c&&c<t},is0:c=>c===St,isOdd:c=>(c&st)===st,neg:c=>nt(-c,t),eql:(c,u)=>c===u,sqr:c=>nt(c*c,t),add:(c,u)=>nt(c+u,t),sub:(c,u)=>nt(c-u,t),mul:(c,u)=>nt(c*u,t),pow:(c,u)=>xI(a,c,u),div:(c,u)=>nt(c*Pa(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Pa(c,t),sqrt:n.sqrt||(c=>(o||(o=vI(t)),o(a,c))),toBytes:c=>r?sl(c,i):Gn(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?nl(c):Hr(c)},invertBatch:c=>Il(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function qm(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function Al(t){let e=qm(t);return e+Math.ceil(e/2)}function jm(t,e,r=!1){let n=t.length,s=qm(e),i=Al(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);let o=r?nl(t):Hr(t),a=nt(o,e-st)+st;return r?sl(a,s):Gn(a,s)}var $m=BigInt(0),Pl=BigInt(1);function Tl(t,e){let r=e.negate();return t?r:e}function Hm(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Cl(t,e){Hm(t,e);let r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,i=Jn(t),o=BigInt(t);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function zm(t,e,r){let{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r,a=Number(t&s),c=t>>o;a>n&&(a-=i,c+=Pl);let u=e*n,l=u+Math.abs(a)-1,h=a===0,f=a<0,d=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:d,offsetF:u}}function SI(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function II(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}var Dl=new WeakMap,Vm=new WeakMap;function Ol(t){return Vm.get(t)||1}function Km(t,e){return{constTimeNegate:Tl,hasPrecomputes(r){return Ol(r)!==1},unsafeLadder(r,n,s=t.ZERO){let i=r;for(;n>$m;)n&Pl&&(s=s.add(i)),i=i.double(),n>>=Pl;return s},precomputeWindow(r,n){let{windows:s,windowSize:i}=Cl(n,e),o=[],a=r,c=a;for(let u=0;u<s;u++){c=a,o.push(c);for(let l=1;l<i;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,s){let i=t.ZERO,o=t.BASE,a=Cl(r,e);for(let c=0;c<a.windows;c++){let{nextN:u,offset:l,isZero:h,isNeg:f,isNegF:d,offsetF:p}=zm(s,c,a);s=u,h?o=o.add(Tl(d,n[p])):i=i.add(Tl(f,n[l]))}return{p:i,f:o}},wNAFUnsafe(r,n,s,i=t.ZERO){let o=Cl(r,e);for(let a=0;a<o.windows&&s!==$m;a++){let{nextN:c,offset:u,isZero:l,isNeg:h}=zm(s,a,o);if(s=c,!l){let f=n[u];i=i.add(h?f.negate():f)}}return i},getPrecomputes(r,n,s){let i=Dl.get(n);return i||(i=this.precomputeWindow(n,r),r!==1&&Dl.set(n,s(i))),i},wNAFCached(r,n,s){let i=Ol(r);return this.wNAF(i,this.getPrecomputes(i,r,s),n)},wNAFCachedUnsafe(r,n,s,i){let o=Ol(r);return o===1?this.unsafeLadder(r,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),n,i)},setWindowSize(r,n){Hm(n,e),Vm.set(r,n),Dl.delete(r)}}}function Wm(t,e,r,n){SI(r,t),II(n,e);let s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");let o=t.ZERO,a=gm(BigInt(s)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let u=Jn(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c,f=o;for(let d=h;d>=0;d-=c){l.fill(o);for(let g=0;g<i;g++){let w=n[g],P=Number(w>>BigInt(d)&u);l[P]=l[P].add(r[g])}let p=o;for(let g=l.length-1,w=o;g>0;g--)w=w.add(l[g]),p=p.add(w);if(f=f.add(p),d!==0)for(let g=0;g<c;g++)f=f.double()}return f}function Rl(t){return Sl(t.Fp),Xn(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze(pe(M(M({},_l(t.n,t.nBitLength)),t),{p:t.Fp.ORDER}))}function Gm(t){t.lowS!==void 0&&Rs("lowS",t.lowS),t.prehash!==void 0&&Rs("prehash",t.prehash)}function _I(t){let e=Rl(t);Xn(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:r,Fp:n,a:s}=e;if(r){if(!n.eql(s,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze(M({},e))}var Ul=class extends Error{constructor(e=""){super(e)}},Kr={Err:Ul,_tlv:{encode:(t,e)=>{let{Err:r}=Kr;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");let n=e.length/2,s=Pi(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");let i=n>127?Pi(s.length/2|128):"";return Pi(t)+i+s+e},decode(t,e){let{Err:r}=Kr,n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");let s=e[n++],i=!!(s&128),o=0;if(!i)o=s;else{let c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");let u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}let a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){let{Err:e}=Kr;if(t<Wr)throw new e("integer: negative integers are not allowed");let r=Pi(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){let{Err:e}=Kr;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Hr(t)}},toSig(t){let{Err:e,_int:r,_tlv:n}=Kr,s=Pt("signature",t),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,i),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){let{_tlv:e,_int:r}=Kr,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),i=n+s;return e.encode(48,i)}};function Nl(t,e){return Ns(Gn(t,e))}var Wr=BigInt(0),Ke=BigInt(1),F5=BigInt(2),Bl=BigInt(3),AI=BigInt(4);function TI(t){let e=_I(t),{Fp:r}=e,n=Li(e.n,e.nBitLength),s=e.toBytes||((x,I,C)=>{let B=I.toAffine();return Ni(Uint8Array.from([4]),r.toBytes(B.x),r.toBytes(B.y))}),i=e.fromBytes||(x=>{let I=x.subarray(1),C=r.fromBytes(I.subarray(0,r.BYTES)),B=r.fromBytes(I.subarray(r.BYTES,2*r.BYTES));return{x:C,y:B}});function o(x){let{a:I,b:C}=e,B=r.sqr(x),k=r.mul(B,x);return r.add(r.add(k,r.mul(x,I)),C)}function a(x,I){let C=r.sqr(I),B=o(x);return r.eql(C,B)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");let c=r.mul(r.pow(e.a,Bl),AI),u=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,u)))throw new Error("bad curve params: a or b");function l(x){return ya(x,Ke,e.n)}function h(x){let{allowedPrivateKeyLengths:I,nByteLength:C,wrapPrivateKey:B,n:k}=e;if(I&&typeof x!="bigint"){if(Ps(x)&&(x=Ns(x)),typeof x!="string"||!I.includes(x.length))throw new Error("invalid private key");x=x.padStart(C*2,"0")}let U;try{U=typeof x=="bigint"?x:Hr(Pt("private key",x,C))}catch{throw new Error("invalid private key, expected hex or "+C+" bytes, got "+typeof x)}return B&&(U=nt(U,k)),Yn("private key",U,Ke,k),U}function f(x){if(!(x instanceof g))throw new Error("ProjectivePoint expected")}let d=il((x,I)=>{let{px:C,py:B,pz:k}=x;if(r.eql(k,r.ONE))return{x:C,y:B};let U=x.is0();I==null&&(I=U?r.ONE:r.inv(k));let N=r.mul(C,I),j=r.mul(B,I),b=r.mul(k,I);if(U)return{x:r.ZERO,y:r.ZERO};if(!r.eql(b,r.ONE))throw new Error("invZ was invalid");return{x:N,y:j}}),p=il(x=>{if(x.is0()){if(e.allowInfinityPoint&&!r.is0(x.py))return;throw new Error("bad point: ZERO")}let{x:I,y:C}=x.toAffine();if(!r.isValid(I)||!r.isValid(C))throw new Error("bad point: x or y not FE");if(!a(I,C))throw new Error("bad point: equation left != right");if(!x.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(I,C,B){if(I==null||!r.isValid(I))throw new Error("x required");if(C==null||!r.isValid(C)||r.is0(C))throw new Error("y required");if(B==null||!r.isValid(B))throw new Error("z required");this.px=I,this.py=C,this.pz=B,Object.freeze(this)}static fromAffine(I){let{x:C,y:B}=I||{};if(!I||!r.isValid(C)||!r.isValid(B))throw new Error("invalid affine point");if(I instanceof g)throw new Error("projective point not allowed");let k=U=>r.eql(U,r.ZERO);return k(C)&&k(B)?g.ZERO:new g(C,B,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(I){let C=Il(r,I.map(B=>B.pz));return I.map((B,k)=>B.toAffine(C[k])).map(g.fromAffine)}static fromHex(I){let C=g.fromAffine(i(Pt("pointHex",I)));return C.assertValidity(),C}static fromPrivateKey(I){return g.BASE.multiply(h(I))}static msm(I,C){return Wm(g,n,I,C)}_setWindowSize(I){R.setWindowSize(this,I)}assertValidity(){p(this)}hasEvenY(){let{y:I}=this.toAffine();if(r.isOdd)return!r.isOdd(I);throw new Error("Field doesn't support isOdd")}equals(I){f(I);let{px:C,py:B,pz:k}=this,{px:U,py:N,pz:j}=I,b=r.eql(r.mul(C,j),r.mul(U,k)),E=r.eql(r.mul(B,j),r.mul(N,k));return b&&E}negate(){return new g(this.px,r.neg(this.py),this.pz)}double(){let{a:I,b:C}=e,B=r.mul(C,Bl),{px:k,py:U,pz:N}=this,j=r.ZERO,b=r.ZERO,E=r.ZERO,v=r.mul(k,k),A=r.mul(U,U),y=r.mul(N,N),m=r.mul(k,U);return m=r.add(m,m),E=r.mul(k,N),E=r.add(E,E),j=r.mul(I,E),b=r.mul(B,y),b=r.add(j,b),j=r.sub(A,b),b=r.add(A,b),b=r.mul(j,b),j=r.mul(m,j),E=r.mul(B,E),y=r.mul(I,y),m=r.sub(v,y),m=r.mul(I,m),m=r.add(m,E),E=r.add(v,v),v=r.add(E,v),v=r.add(v,y),v=r.mul(v,m),b=r.add(b,v),y=r.mul(U,N),y=r.add(y,y),v=r.mul(y,m),j=r.sub(j,v),E=r.mul(y,A),E=r.add(E,E),E=r.add(E,E),new g(j,b,E)}add(I){f(I);let{px:C,py:B,pz:k}=this,{px:U,py:N,pz:j}=I,b=r.ZERO,E=r.ZERO,v=r.ZERO,A=e.a,y=r.mul(e.b,Bl),m=r.mul(C,U),_=r.mul(B,N),O=r.mul(k,j),S=r.add(C,B),T=r.add(U,N);S=r.mul(S,T),T=r.add(m,_),S=r.sub(S,T),T=r.add(C,k);let F=r.add(U,j);return T=r.mul(T,F),F=r.add(m,O),T=r.sub(T,F),F=r.add(B,k),b=r.add(N,j),F=r.mul(F,b),b=r.add(_,O),F=r.sub(F,b),v=r.mul(A,T),b=r.mul(y,O),v=r.add(b,v),b=r.sub(_,v),v=r.add(_,v),E=r.mul(b,v),_=r.add(m,m),_=r.add(_,m),O=r.mul(A,O),T=r.mul(y,T),_=r.add(_,O),O=r.sub(m,O),O=r.mul(A,O),T=r.add(T,O),m=r.mul(_,T),E=r.add(E,m),m=r.mul(F,T),b=r.mul(S,b),b=r.sub(b,m),m=r.mul(S,_),v=r.mul(F,v),v=r.add(v,m),new g(b,E,v)}subtract(I){return this.add(I.negate())}is0(){return this.equals(g.ZERO)}wNAF(I){return R.wNAFCached(this,I,g.normalizeZ)}multiplyUnsafe(I){let{endo:C,n:B}=e;Yn("scalar",I,Wr,B);let k=g.ZERO;if(I===Wr)return k;if(this.is0()||I===Ke)return this;if(!C||R.hasPrecomputes(this))return R.wNAFCachedUnsafe(this,I,g.normalizeZ);let{k1neg:U,k1:N,k2neg:j,k2:b}=C.splitScalar(I),E=k,v=k,A=this;for(;N>Wr||b>Wr;)N&Ke&&(E=E.add(A)),b&Ke&&(v=v.add(A)),A=A.double(),N>>=Ke,b>>=Ke;return U&&(E=E.negate()),j&&(v=v.negate()),v=new g(r.mul(v.px,C.beta),v.py,v.pz),E.add(v)}multiply(I){let{endo:C,n:B}=e;Yn("scalar",I,Ke,B);let k,U;if(C){let{k1neg:N,k1:j,k2neg:b,k2:E}=C.splitScalar(I),{p:v,f:A}=this.wNAF(j),{p:y,f:m}=this.wNAF(E);v=R.constTimeNegate(N,v),y=R.constTimeNegate(b,y),y=new g(r.mul(y.px,C.beta),y.py,y.pz),k=v.add(y),U=A.add(m)}else{let{p:N,f:j}=this.wNAF(I);k=N,U=j}return g.normalizeZ([k,U])[0]}multiplyAndAddUnsafe(I,C,B){let k=g.BASE,U=(j,b)=>b===Wr||b===Ke||!j.equals(k)?j.multiplyUnsafe(b):j.multiply(b),N=U(this,C).add(U(I,B));return N.is0()?void 0:N}toAffine(I){return d(this,I)}isTorsionFree(){let{h:I,isTorsionFree:C}=e;if(I===Ke)return!0;if(C)return C(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:I,clearCofactor:C}=e;return I===Ke?this:C?C(g,this):this.multiplyUnsafe(e.h)}toRawBytes(I=!0){return Rs("isCompressed",I),this.assertValidity(),s(g,this,I)}toHex(I=!0){return Rs("isCompressed",I),Ns(this.toRawBytes(I))}}g.BASE=new g(e.Gx,e.Gy,r.ONE),g.ZERO=new g(r.ZERO,r.ONE,r.ZERO);let{endo:w,nBitLength:P}=e,R=Km(g,w?Math.ceil(P/2):P);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:l}}function CI(t){let e=Rl(t);return Xn(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze(M({lowS:!0},e))}function Ym(t){let e=CI(t),{Fp:r,n,nByteLength:s,nBitLength:i}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(y){return nt(y,n)}function u(y){return Pa(y,n)}let{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:d}=TI(pe(M({},e),{toBytes(y,m,_){let O=m.toAffine(),S=r.toBytes(O.x),T=Ni;return Rs("isCompressed",_),_?T(Uint8Array.from([m.hasEvenY()?2:3]),S):T(Uint8Array.from([4]),S,r.toBytes(O.y))},fromBytes(y){let m=y.length,_=y[0],O=y.subarray(1);if(m===o&&(_===2||_===3)){let S=Hr(O);if(!ya(S,Ke,r.ORDER))throw new Error("Point is not on curve");let T=f(S),F;try{F=r.sqrt(T)}catch(H){let z=H instanceof Error?": "+H.message:"";throw new Error("Point is not on curve"+z)}let L=(F&Ke)===Ke;return(_&1)===1!==L&&(F=r.neg(F)),{x:S,y:F}}else if(m===a&&_===4){let S=r.fromBytes(O.subarray(0,r.BYTES)),T=r.fromBytes(O.subarray(r.BYTES,2*r.BYTES));return{x:S,y:T}}else{let S=o,T=a;throw new Error("invalid Point, expected length of "+S+", or uncompressed "+T+", got "+m)}}}));function p(y){let m=n>>Ke;return y>m}function g(y){return p(y)?c(-y):y}let w=(y,m,_)=>Hr(y.slice(m,_));class P{constructor(m,_,O){Yn("r",m,Ke,n),Yn("s",_,Ke,n),this.r=m,this.s=_,O!=null&&(this.recovery=O),Object.freeze(this)}static fromCompact(m){let _=s;return m=Pt("compactSignature",m,_*2),new P(w(m,0,_),w(m,_,2*_))}static fromDER(m){let{r:_,s:O}=Kr.toSig(Pt("DER",m));return new P(_,O)}assertValidity(){}addRecoveryBit(m){return new P(this.r,this.s,m)}recoverPublicKey(m){let{r:_,s:O,recovery:S}=this,T=k(Pt("msgHash",m));if(S==null||![0,1,2,3].includes(S))throw new Error("recovery id invalid");let F=S===2||S===3?_+e.n:_;if(F>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");let L=(S&1)===0?"02":"03",K=l.fromHex(L+Nl(F,r.BYTES)),H=u(F),z=c(-T*H),G=c(O*H),J=l.BASE.multiplyAndAddUnsafe(K,z,G);if(!J)throw new Error("point at infinify");return J.assertValidity(),J}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new P(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Ri(this.toDERHex())}toDERHex(){return Kr.hexFromSig(this)}toCompactRawBytes(){return Ri(this.toCompactHex())}toCompactHex(){let m=s;return Nl(this.r,m)+Nl(this.s,m)}}let R={isValidPrivateKey(y){try{return h(y),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{let y=Al(e.n);return jm(e.randomBytes(y),e.n)},precompute(y=8,m=l.BASE){return m._setWindowSize(y),m.multiply(BigInt(3)),m}};function x(y,m=!0){return l.fromPrivateKey(y).toRawBytes(m)}function I(y){if(typeof y=="bigint")return!1;if(y instanceof l)return!0;let _=Pt("key",y).length,O=r.BYTES,S=O+1,T=2*O+1;if(!(e.allowedPrivateKeyLengths||s===S))return _===S||_===T}function C(y,m,_=!0){if(I(y)===!0)throw new Error("first arg must be private key");if(I(m)===!1)throw new Error("second arg must be public key");return l.fromHex(m).multiply(h(y)).toRawBytes(_)}let B=e.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");let m=Hr(y),_=y.length*8-i;return _>0?m>>BigInt(_):m},k=e.bits2int_modN||function(y){return c(B(y))},U=Jn(i);function N(y){return Yn("num < 2^"+i,y,Wr,U),Gn(y,s)}function j(y,m,_=b){if(["recovered","canonical"].some(Y=>Y in _))throw new Error("sign() legacy options not supported");let{hash:O,randomBytes:S}=e,{lowS:T,prehash:F,extraEntropy:L}=_;T==null&&(T=!0),y=Pt("msgHash",y),Gm(_),F&&(y=Pt("prehashed msgHash",O(y)));let K=k(y),H=h(m),z=[N(H),N(K)];if(L!=null&&L!==!1){let Y=L===!0?S(r.BYTES):L;z.push(Pt("extraEntropy",Y))}let G=Ni(...z),J=K;function ne(Y){let se=B(Y);if(!d(se))return;let _e=u(se),Fe=l.BASE.multiply(se).toAffine(),$e=c(Fe.x);if($e===Wr)return;let bt=c(_e*c(J+$e*H));if(bt===Wr)return;let Dr=(Fe.x===$e?0:2)|Number(Fe.y&Ke),Po=bt;return T&&p(bt)&&(Po=g(bt),Dr^=1),new P($e,Po,Dr)}return{seed:G,k2sig:ne}}let b={lowS:e.lowS,prehash:!1},E={lowS:e.lowS,prehash:!1};function v(y,m,_=b){let{seed:O,k2sig:S}=j(y,m,_),T=e;return mm(T.hash.outputLen,T.nByteLength,T.hmac)(O,S)}l.BASE._setWindowSize(8);function A(y,m,_,O=E){let S=y;m=Pt("msgHash",m),_=Pt("publicKey",_);let{lowS:T,prehash:F,format:L}=O;if(Gm(O),"strict"in O)throw new Error("options.strict was renamed to lowS");if(L!==void 0&&L!=="compact"&&L!=="der")throw new Error("format must be compact or der");let K=typeof S=="string"||Ps(S),H=!K&&!L&&typeof S=="object"&&S!==null&&typeof S.r=="bigint"&&typeof S.s=="bigint";if(!K&&!H)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let z,G;try{if(H&&(z=new P(S.r,S.s)),K){try{L!=="compact"&&(z=P.fromDER(S))}catch(Dr){if(!(Dr instanceof Kr.Err))throw Dr}!z&&L!=="der"&&(z=P.fromCompact(S))}G=l.fromHex(_)}catch{return!1}if(!z||T&&z.hasHighS())return!1;F&&(m=e.hash(m));let{r:J,s:ne}=z,Y=k(m),se=u(ne),_e=c(Y*se),Fe=c(J*se),$e=l.BASE.multiplyAndAddUnsafe(G,_e,Fe)?.toAffine();return $e?c($e.x)===J:!1}return{CURVE:e,getPublicKey:x,getSharedSecret:C,sign:v,verify:A,ProjectivePoint:l,Signature:P,utils:R}}function DI(t){return{hash:t,hmac:(e,...r)=>bp(t,e,gp(...r)),randomBytes:mp}}function Jm(t,e){let r=n=>Ym(M(M({},t),DI(n)));return pe(M({},r(e)),{create:r})}var Qm=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Xm=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),OI=BigInt(0),PI=BigInt(1),kl=BigInt(2),Zm=(t,e)=>(t+e/kl)/e;function RI(t){let e=Qm,r=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=zt(l,r,e)*l%e,f=zt(h,r,e)*l%e,d=zt(f,kl,e)*u%e,p=zt(d,s,e)*d%e,g=zt(p,i,e)*p%e,w=zt(g,a,e)*g%e,P=zt(w,c,e)*w%e,R=zt(P,a,e)*g%e,x=zt(R,r,e)*l%e,I=zt(x,o,e)*p%e,C=zt(I,n,e)*u%e,B=zt(C,kl,e);if(!Fl.eql(Fl.sqr(B),t))throw new Error("Cannot find square root");return B}var Fl=Li(Qm,void 0,void 0,{sqrt:RI}),Ht=Jm({a:OI,b:BigInt(7),Fp:Fl,n:Xm,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{let e=Xm,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-PI*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,o=BigInt("0x100000000000000000000000000000000"),a=Zm(i*t,e),c=Zm(-n*t,e),u=nt(t-a*r-c*s,e),l=nt(-a*n-c*i,e),h=u>o,f=l>o;if(h&&(u=e-u),f&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}}},wp);function ka(t,e={}){let{recovered:r}=e;if(typeof t.r>"u")throw new ks({signature:t});if(typeof t.s>"u")throw new ks({signature:t});if(r&&typeof t.yParity>"u")throw new ks({signature:t});if(t.r<0n||t.r>xl)throw new Na({value:t.r});if(t.s<0n||t.s>xl)throw new Ba({value:t.s});if(typeof t.yParity=="number"&&t.yParity!==0&&t.yParity!==1)throw new ts({value:t.yParity})}function ey(t){return Ll(jt(t))}function Ll(t){if(t.length!==130&&t.length!==132)throw new Ra({signature:t});let e=BigInt(pr(t,0,32)),r=BigInt(pr(t,32,64)),n=(()=>{let s=+`0x${t.slice(130)}`;if(!Number.isNaN(s))try{return Fa(s)}catch{throw new ts({value:s})}})();return typeof n>"u"?{r:e,s:r}:{r:e,s:r,yParity:n}}function NI(t){if(!(typeof t.r>"u")&&!(typeof t.s>"u"))return Ml(t)}function Ml(t){let e=typeof t=="string"?Ll(t):t instanceof Uint8Array?ey(t):typeof t.r=="string"?ny(t):t.v?ry(t):M({r:t.r,s:t.s},typeof t.yParity<"u"?{yParity:t.yParity}:{});return ka(e),e}function BI(t){return ty(jt(t))}function ty(t){let{r:e,s:r}=Ht.Signature.fromDER(Rr(t).slice(2));return{r:e,s:r}}function ry(t){return{r:t.r,s:t.s,yParity:Fa(t.v)}}function ny(t){let e=(()=>{let r=t.v?Number(t.v):void 0,n=t.yParity?Number(t.yParity):void 0;if(typeof r=="number"&&typeof n!="number"&&(n=Fa(r)),typeof n!="number")throw new ts({value:t.yParity});return n})();return{r:BigInt(t.r),s:BigInt(t.s),yParity:e}}function UI(t){let[e,r,n]=t;return Ml({r:r==="0x"?0n:BigInt(r),s:n==="0x"?0n:BigInt(n),yParity:e==="0x"?0:Number(e)})}function kI(t){return ki(sy(t))}function sy(t){ka(t);let e=t.r,r=t.s;return _a($t(e,{size:32}),$t(r,{size:32}),typeof t.yParity=="number"?$t(ql(t.yParity),{size:1}):"0x")}function FI(t){return new Ht.Signature(t.r,t.s).toDERRawBytes()}function LI(t){return`0x${new Ht.Signature(t.r,t.s).toDERHex()}`}function MI(t){return{r:t.r,s:t.s,v:ql(t.yParity)}}function qI(t){let{r:e,s:r,yParity:n}=t;return{r:$t(e,{size:32}),s:$t(r,{size:32}),yParity:n===0?"0x0":"0x1"}}function jI(t){let{r:e,s:r,yParity:n}=t;return[n?"0x01":"0x",e===0n?"0x":hl($t(e)),r===0n?"0x":hl($t(r))]}function $I(t,e={}){try{return ka(t,e),!0}catch{return!1}}function Fa(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new Ua({value:t})}function ql(t){if(t===0)return 27;if(t===1)return 28;throw new ts({value:t})}var Ra=class extends de{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${er(Rr(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}},ks=class extends de{constructor({signature:e}){super(`Signature \`${dn(e)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}},Na=class extends de{constructor({value:e}){super(`Value \`${e}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}},Ba=class extends de{constructor({value:e}){super(`Value \`${e}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}},ts=class extends de{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}},Ua=class extends de{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}};function zI(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function oy(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Ma(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function zl(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function $l(t){if(!Array.isArray(t))throw new Error("array expected")}function qa(t,e){if(!oy(!0,e))throw new Error(`${t}: array of strings expected`)}function HI(t,e){if(!oy(!1,e))throw new Error(`${t}: array of numbers expected`)}function VI(...t){let e=i=>i,r=(i,o)=>a=>i(o(a)),n=t.map(i=>i.encode).reduceRight(r,e),s=t.map(i=>i.decode).reduce(r,e);return{encode:n,decode:s}}function KI(t){let e=typeof t=="string"?t.split(""):t,r=e.length;qa("alphabet",e);let n=new Map(e.map((s,i)=>[s,i]));return{encode:s=>($l(s),s.map(i=>{if(!Number.isSafeInteger(i)||i<0||i>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${i}". Allowed: ${t}`);return e[i]})),decode:s=>($l(s),s.map(i=>{Ma("alphabet.decode",i);let o=n.get(i);if(o===void 0)throw new Error(`Unknown letter: "${i}". Allowed: ${t}`);return o}))}}function WI(t=""){return Ma("join",t),{encode:e=>(qa("join.decode",e),e.join(t)),decode:e=>(Ma("join.decode",e),e.split(t))}}function GI(t,e="="){return zl(t),Ma("padding",e),{encode(r){for(qa("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){qa("padding.decode",r);let n=r.length;if(n*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if((n-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}var ay=(t,e)=>e===0?t:ay(e,t%e),ja=(t,e)=>t+(e-ay(t,e)),jl=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function iy(t,e,r,n){if($l(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(ja(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${ja(e,r)}`);let s=0,i=0,o=jl[e],a=jl[r]-1,c=[];for(let u of t){if(zl(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(s=s<<e|u,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=r;i-=r)c.push((s>>i-r&a)>>>0);let l=jl[i];if(l===void 0)throw new Error("invalid carry");s&=l-1}if(s=s<<r-i&a,!n&&i>=e)throw new Error("Excess padding");if(!n&&s>0)throw new Error(`Non-zero padding: ${s}`);return n&&i>0&&c.push(s>>>0),c}function YI(t,e=!1){if(zl(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(ja(8,t)>32||ja(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!zI(r))throw new Error("radix2.encode input should be Uint8Array");return iy(Array.from(r),8,t,!e)},decode:r=>(HI("radix2.decode",r),Uint8Array.from(iy(r,t,8,e)))}}var cy=VI(YI(5),KI("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),GI(5),WI(""));var $a={};ze($a,{createKeyPair:()=>ZI,getPublicKey:()=>ly,getSharedSecret:()=>QI,noble:()=>XI,randomPrivateKey:()=>hy,recoverAddress:()=>fy,recoverPublicKey:()=>dy,sign:()=>e_,verify:()=>t_});var uy=!1;var XI=Ht;function ZI(t={}){let{as:e="Hex"}=t,r=hy({as:e}),n=ly({privateKey:r});return{privateKey:r,publicKey:n}}function ly(t){let{privateKey:e}=t,r=Ht.ProjectivePoint.fromPrivateKey(Rr(e).slice(2));return wl(r)}function QI(t){let{as:e="Hex",privateKey:r,publicKey:n}=t,o=Ht.ProjectivePoint.fromHex(Fi(n).slice(2)).multiply(Ht.utils.normPrivateKeyToScalar(Rr(r).slice(2))).toRawBytes(!0);return e==="Hex"?jt(o):o}function hy(t={}){let{as:e="Hex"}=t,r=Ht.utils.randomPrivateKey();return e==="Hex"?jt(r):r}function fy(t){return Pm(dy(t))}function dy(t){let{payload:e,signature:r}=t,{r:n,s,yParity:i}=r,a=new Ht.Signature(BigInt(n),BigInt(s)).addRecoveryBit(i).recoverPublicKey(Rr(e).substring(2));return wl(a)}function e_(t){let{extraEntropy:e=uy,hash:r,payload:n,privateKey:s}=t,{r:i,s:o,recovery:a}=Ht.sign(Us(n),Us(s),M({extraEntropy:typeof e=="boolean"?e:Rr(e).slice(2),lowS:!0},r?{prehash:!0}:{}));return{r:i,s:o,yParity:a}}function t_(t){let{address:e,hash:r,payload:n,publicKey:s,signature:i}=t;return e?Rm(e,fy({payload:n,signature:i})):Ht.verify(i,Us(n),Dm(s),...r?[{prehash:!0,lowS:!0}]:[])}function r_(t){if(t.length>=255)throw new TypeError("Alphabet too long");let e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){let l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}let r=t.length,n=t.charAt(0),s=Math.log(r)/Math.log(256),i=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,f=0,d=u.length;for(;f!==d&&u[f]===0;)f++,l++;let p=(d-f)*i+1>>>0,g=new Uint8Array(p);for(;f!==d;){let R=u[f],x=0;for(let I=p-1;(R!==0||x<h)&&I!==-1;I--,x++)R+=256*g[I]>>>0,g[I]=R%r>>>0,R=R/r>>>0;if(R!==0)throw new Error("Non-zero carry");h=x,f++}let w=p-h;for(;w!==p&&g[w]===0;)w++;let P=n.repeat(l);for(;w<p;++w)P+=t.charAt(g[w]);return P}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,f=0;for(;u[l]===n;)h++,l++;let d=(u.length-l)*s+1>>>0,p=new Uint8Array(d);for(;l<u.length;){let R=u.charCodeAt(l);if(R>255)return;let x=e[R];if(x===255)return;let I=0;for(let C=d-1;(x!==0||I<f)&&C!==-1;C--,I++)x+=r*p[C]>>>0,p[C]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");f=I,l++}let g=d-f;for(;g!==d&&p[g]===0;)g++;let w=new Uint8Array(h+(d-g)),P=h;for(;g!==d;)w[P++]=p[g++];return w}function c(u){let l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var py=r_;var n_="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",Fs=py(n_);function gy(t){let e=t.length,r=0,n=0;for(;n<e;){let s=t.charCodeAt(n++);if((s&4294967168)===0){r++;continue}else if((s&4294965248)===0)r+=2;else{if(s>=55296&&s<=56319&&n<e){let i=t.charCodeAt(n);(i&64512)===56320&&(++n,s=((s&1023)<<10)+(i&1023)+65536)}(s&4294901760)===0?r+=3:r+=4}}return r}function s_(t,e,r){let n=t.length,s=r,i=0;for(;i<n;){let o=t.charCodeAt(i++);if((o&4294967168)===0){e[s++]=o;continue}else if((o&4294965248)===0)e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&i<n){let a=t.charCodeAt(i);(a&64512)===56320&&(++i,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128):(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128)}e[s++]=o&63|128}}var i_=new TextEncoder,o_=50;function a_(t,e,r){i_.encodeInto(t,e.subarray(r))}function my(t,e,r){t.length>o_?a_(t,e,r):s_(t,e,r)}var c_=4096;function Hl(t,e,r){let n=e,s=n+r,i=[],o="";for(;n<s;){let a=t[n++];if((a&128)===0)i.push(a);else if((a&224)===192){let c=t[n++]&63;i.push((a&31)<<6|c)}else if((a&240)===224){let c=t[n++]&63,u=t[n++]&63;i.push((a&31)<<12|c<<6|u)}else if((a&248)===240){let c=t[n++]&63,u=t[n++]&63,l=t[n++]&63,h=(a&7)<<18|c<<12|u<<6|l;h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|h&1023),i.push(h)}else i.push(a);i.length>=c_&&(o+=String.fromCharCode(...i),i.length=0)}return i.length>0&&(o+=String.fromCharCode(...i)),o}var u_=new TextDecoder,l_=200;function h_(t,e,r){let n=t.subarray(e,e+r);return u_.decode(n)}function yy(t,e,r){return r>l_?h_(t,e,r):Hl(t,e,r)}var rs=class{constructor(e,r){this.type=e,this.data=r}};var Rt=class t extends Error{constructor(e){super(e);let r=Object.create(t.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:t.name})}};function wy(t,e,r){let n=r/4294967296,s=r;t.setUint32(e,n),t.setUint32(e+4,s)}function za(t,e,r){let n=Math.floor(r/4294967296),s=r;t.setUint32(e,n),t.setUint32(e+4,s)}function Ha(t,e){let r=t.getInt32(e),n=t.getUint32(e+4);return r*4294967296+n}function by(t,e){let r=t.getUint32(e),n=t.getUint32(e+4);return r*4294967296+n}var f_=-1,d_=4294967296-1,p_=17179869184-1;function g_({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=p_)if(e===0&&t<=d_){let r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{let r=t/4294967296,n=t&4294967295,s=new Uint8Array(8),i=new DataView(s.buffer);return i.setUint32(0,e<<2|r&3),i.setUint32(4,n),s}else{let r=new Uint8Array(12),n=new DataView(r.buffer);return n.setUint32(0,e),za(n,4,t),r}}function m_(t){let e=t.getTime(),r=Math.floor(e/1e3),n=(e-r*1e3)*1e6,s=Math.floor(n/1e9);return{sec:r+s,nsec:n-s*1e9}}function y_(t){if(t instanceof Date){let e=m_(t);return g_(e)}else return null}function w_(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{let r=e.getUint32(0),n=e.getUint32(4),s=(r&3)*4294967296+n,i=r>>>2;return{sec:s,nsec:i}}case 12:{let r=Ha(e,4),n=e.getUint32(0);return{sec:r,nsec:n}}default:throw new Rt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function b_(t){let e=w_(t);return new Date(e.sec*1e3+e.nsec/1e6)}var vy={type:f_,encode:y_,decode:b_};var pn=class{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(vy)}register({type:e,encode:r,decode:n}){if(e>=0)this.encoders[e]=r,this.decoders[e]=n;else{let s=-1-e;this.builtInEncoders[s]=r,this.builtInDecoders[s]=n}}tryToEncode(e,r){for(let n=0;n<this.builtInEncoders.length;n++){let s=this.builtInEncoders[n];if(s!=null){let i=s(e,r);if(i!=null){let o=-1-n;return new rs(o,i)}}}for(let n=0;n<this.encoders.length;n++){let s=this.encoders[n];if(s!=null){let i=s(e,r);if(i!=null){let o=n;return new rs(o,i)}}}return e instanceof rs?e:null}decode(e,r,n){let s=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return s?s(e,r,n):new rs(r,e)}};pn.defaultCodec=new pn;function v_(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Mi(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):v_(t)?new Uint8Array(t):Uint8Array.from(t)}var E_=100,x_=2048,Va=class t{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??pn.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??E_,this.initialBufferSize=e?.initialBufferSize??x_,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new t({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){let r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){let r=new ArrayBuffer(e),n=new Uint8Array(r),s=new DataView(r);n.set(this.bytes),this.view=s,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){let n=gy(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),my(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,r){let n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){let r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);let n=Mi(e);this.writeU8a(n)}encodeArray(e,r){let n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(let s of e)this.doEncode(s,r+1)}countWithoutUndefined(e,r){let n=0;for(let s of r)e[s]!==void 0&&n++;return n}encodeMap(e,r){let n=Object.keys(e);this.sortKeys&&n.sort();let s=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(let i of n){let o=e[i];this.ignoreUndefined&&o===void 0||(this.encodeString(i),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){let n=e.data(this.pos+6),s=n.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(n);return}let r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),wy(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),za(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function Vl(t,e){return new Va(e).encodeSharedRef(t)}function Ka(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}var S_=16,I_=16,Wa=class{constructor(e=S_,r=I_){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,n){let s=this.caches[n-1];e:for(let i of s){let o=i.bytes;for(let a=0;a<n;a++)if(o[a]!==e[r+a])continue e;return i.str}return null}store(e,r){let n=this.caches[e.length-1],s={bytes:e,str:r};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=s:n.push(s)}decode(e,r,n){let s=this.find(e,r,n);if(s!=null)return this.hit++,s;this.miss++;let i=Hl(e,r,n),o=Uint8Array.prototype.slice.call(e,r,r+n);return this.store(o,i),i}};var Kl="array",$i="map_key",xy="map_value",__=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new Rt("The type of key must be string or number but "+typeof t)},Wl=class{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){let r=this.getUninitializedStateFromPool();r.type=Kl,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){let r=this.getUninitializedStateFromPool();r.type=$i,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){let e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===Kl){let n=e;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(e.type===$i||e.type===xy){let n=e;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}},ji=-1,Gl=new DataView(new ArrayBuffer(0)),A_=new Uint8Array(Gl.buffer);try{Gl.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var Ey=new RangeError("Insufficient data"),T_=new Wa,Ga=class t{constructor(e){this.totalPos=0,this.pos=0,this.view=Gl,this.bytes=A_,this.headByte=ji,this.stack=new Wl,this.entered=!1,this.extensionCodec=e?.extensionCodec??pn.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??4294967295,this.maxBinLength=e?.maxBinLength??4294967295,this.maxArrayLength=e?.maxArrayLength??4294967295,this.maxMapLength=e?.maxMapLength??4294967295,this.maxExtLength=e?.maxExtLength??4294967295,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:T_,this.mapKeyConverter=e?.mapKeyConverter??__}clone(){return new t({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=ji,this.stack.reset()}setBuffer(e){let r=Mi(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===ji&&!this.hasRemaining(1))this.setBuffer(e);else{let r=this.bytes.subarray(this.pos),n=Mi(e),s=new Uint8Array(r.length+n.length);s.set(r),s.set(n,r.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){let{view:r,pos:n}=this;return new RangeError(`Extra ${r.byteLength-n} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);let r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,n;for await(let a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}let{headByte:s,pos:i,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Ka(s)} at ${o} (${i} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let n=r,s=-1;for await(let i of e){if(r&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(i),n&&(s=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){let e=this.readHeadByte(),r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){let s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e<160){let s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else{let s=e-160;r=this.decodeString(s,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){let s=this.lookU8();r=this.decodeString(s,1)}else if(e===218){let s=this.lookU16();r=this.decodeString(s,2)}else if(e===219){let s=this.lookU32();r=this.decodeString(s,4)}else if(e===220){let s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===221){let s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===222){let s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===223){let s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===196){let s=this.lookU8();r=this.decodeBinary(s,1)}else if(e===197){let s=this.lookU16();r=this.decodeBinary(s,2)}else if(e===198){let s=this.lookU32();r=this.decodeBinary(s,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){let s=this.lookU8();r=this.decodeExtension(s,1)}else if(e===200){let s=this.lookU16();r=this.decodeExtension(s,2)}else if(e===201){let s=this.lookU32();r=this.decodeExtension(s,4)}else throw new Rt(`Unrecognized type byte: ${Ka(e)}`);this.complete();let n=this.stack;for(;n.length>0;){let s=n.top();if(s.type===Kl)if(s.array[s.position]=r,s.position++,s.position===s.size)r=s.array,n.release(s);else continue e;else if(s.type===$i){if(r==="__proto__")throw new Rt("The key __proto__ is not allowed");s.key=this.mapKeyConverter(r),s.type=xy;continue e}else if(s.map[s.key]=r,s.readCount++,s.readCount===s.size)r=s.map,n.release(s);else{s.key=null,s.type=$i;continue e}}return r}}readHeadByte(){return this.headByte===ji&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=ji}readArraySize(){let e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new Rt(`Unrecognized array type byte: ${Ka(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new Rt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new Rt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){if(e>this.maxStrLength)throw new Rt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw Ey;let n=this.pos+r,s;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?s=this.keyDecoder.decode(this.bytes,n,e):s=yy(this.bytes,n,e),this.pos+=r+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===$i:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new Rt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw Ey;let n=this.pos+r,s=this.bytes.subarray(n,n+e);return this.pos+=r+e,s}decodeExtension(e,r){if(e>this.maxExtLength)throw new Rt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);let n=this.view.getInt8(this.pos+r),s=this.decodeBinary(e,r+1);return this.extensionCodec.decode(s,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){let e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){let e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){let e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){let e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){let e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){let e=by(this.view,this.pos);return this.pos+=8,e}readI64(){let e=Ha(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){let e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){let e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){let e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){let e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function Yl(t,e){return new Ga(e).decode(t)}function ns(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function zi(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ns(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ss(t,e){e||(e=t.reduce((s,i)=>s+i.length,0));let r=zi(e),n=0;for(let s of t)r.set(s,n),n+=s.length;return ns(r)}var eh={};ze(eh,{identity:()=>N_});function C_(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,P=0,R=p.length;P!==R&&p[P]===0;)P++,g++;for(var x=(R-P)*l+1>>>0,I=new Uint8Array(x);P!==R;){for(var C=p[P],B=0,k=x-1;(C!==0||B<w)&&k!==-1;k--,B++)C+=256*I[k]>>>0,I[k]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");w=B,P++}for(var U=x-w;U!==x&&I[U]===0;)U++;for(var N=c.repeat(g);U<x;++U)N+=t.charAt(I[U]);return N}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,P=0;p[g]===c;)w++,g++;for(var R=(p.length-g)*u+1>>>0,x=new Uint8Array(R);p[g];){var I=r[p.charCodeAt(g)];if(I===255)return;for(var C=0,B=R-1;(I!==0||C<P)&&B!==-1;B--,C++)I+=a*x[B]>>>0,x[B]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");P=C,g++}if(p[g]!==" "){for(var k=R-P;k!==R&&x[k]===0;)k++;for(var U=new Uint8Array(w+(R-k)),N=w;k!==R;)U[N++]=x[k++];return U}}}function d(p){var g=f(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var D_=C_,O_=D_,Sy=O_;var Jk=new Uint8Array(0);var Iy=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0},Gr=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};var _y=t=>new TextEncoder().encode(t),Ay=t=>new TextDecoder().decode(t);var Jl=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Xl=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Cy(this,e)}},Zl=class{constructor(e){this.decoders=e}or(e){return Cy(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Cy=(t,e)=>new Zl(M(M({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e})),Ql=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new Jl(e,r,n),this.decoder=new Xl(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Ls=({name:t,prefix:e,encode:r,decode:n})=>new Ql(t,e,r,n),gn=({prefix:t,name:e,alphabet:r})=>{let{encode:n,decode:s}=Sy(r,e);return Ls({prefix:t,name:e,encode:n,decode:i=>Gr(s(i))})},P_=(t,e,r,n)=>{let s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*r/8|0),a=0,c=0,u=0;for(let l=0;l<i;++l){let h=s[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},R_=(t,e,r)=>{let n=e[e.length-1]==="=",s=(1<<r)-1,i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},De=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Ls({prefix:e,name:t,encode(s){return R_(s,n,r)},decode(s){return P_(s,n,r,t)}});var N_=Ls({prefix:"\0",name:"identity",encode:t=>Ay(t),decode:t=>_y(t)});var th={};ze(th,{base2:()=>B_});var B_=De({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var rh={};ze(rh,{base8:()=>U_});var U_=De({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var nh={};ze(nh,{base10:()=>k_});var k_=gn({prefix:"9",name:"base10",alphabet:"0123456789"});var sh={};ze(sh,{base16:()=>F_,base16upper:()=>L_});var F_=De({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),L_=De({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ih={};ze(ih,{base32:()=>Ms,base32hex:()=>$_,base32hexpad:()=>H_,base32hexpadupper:()=>V_,base32hexupper:()=>z_,base32pad:()=>q_,base32padupper:()=>j_,base32upper:()=>M_,base32z:()=>K_});var Ms=De({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),M_=De({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),q_=De({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),j_=De({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),$_=De({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),z_=De({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),H_=De({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),V_=De({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),K_=De({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var oh={};ze(oh,{base36:()=>W_,base36upper:()=>G_});var W_=gn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),G_=gn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ah={};ze(ah,{base58btc:()=>Nr,base58flickr:()=>Y_});var Nr=gn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Y_=gn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ch={};ze(ch,{base64:()=>J_,base64pad:()=>X_,base64url:()=>Z_,base64urlpad:()=>Q_});var J_=De({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),X_=De({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Z_=De({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Q_=De({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var uh={};ze(uh,{base256emoji:()=>sA});var Dy=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),eA=Dy.reduce((t,e,r)=>(t[r]=e,t),[]),tA=Dy.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function rA(t){return t.reduce((e,r)=>(e+=eA[r],e),"")}function nA(t){let e=[];for(let r of t){let n=tA[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}var sA=Ls({prefix:"\u{1F680}",name:"base256emoji",encode:rA,decode:nA});var dh={};ze(dh,{sha256:()=>SA,sha512:()=>IA});var iA=Ry,Oy=128,oA=127,aA=~oA,cA=Math.pow(2,31);function Ry(t,e,r){e=e||[],r=r||0;for(var n=r;t>=cA;)e[r++]=t&255|Oy,t/=128;for(;t&aA;)e[r++]=t&255|Oy,t>>>=7;return e[r]=t|0,Ry.bytes=r-n+1,e}var uA=lh,lA=128,Py=127;function lh(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw lh.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&Py)<<s:(o&Py)*Math.pow(2,s),s+=7}while(o>=lA);return lh.bytes=i-n,r}var hA=Math.pow(2,7),fA=Math.pow(2,14),dA=Math.pow(2,21),pA=Math.pow(2,28),gA=Math.pow(2,35),mA=Math.pow(2,42),yA=Math.pow(2,49),wA=Math.pow(2,56),bA=Math.pow(2,63),vA=function(t){return t<hA?1:t<fA?2:t<dA?3:t<pA?4:t<gA?5:t<mA?6:t<yA?7:t<wA?8:t<bA?9:10},EA={encode:iA,decode:uA,encodingLength:vA},xA=EA,Hi=xA;var Vi=(t,e=0)=>[Hi.decode(t,e),Hi.decode.bytes],qs=(t,e,r=0)=>(Hi.encode(t,e,r),e),js=t=>Hi.encodingLength(t);var is=(t,e)=>{let r=e.byteLength,n=js(t),s=n+js(r),i=new Uint8Array(s+r);return qs(t,i,0),qs(r,i,n),i.set(e,s),new $s(t,r,e,i)},Ny=t=>{let e=Gr(t),[r,n]=Vi(e),[s,i]=Vi(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new $s(r,s,o,e)},By=(t,e)=>t===e?!0:t.code===e.code&&t.size===e.size&&Iy(t.bytes,e.bytes),$s=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}};var fh=({name:t,code:e,encode:r})=>new hh(t,e,r),hh=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?is(this.code,r):r.then(n=>is(this.code,n))}else throw Error("Unknown type, must be binary type")}};var ky=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),SA=fh({name:"sha2-256",code:18,encode:ky("SHA-256")}),IA=fh({name:"sha2-512",code:19,encode:ky("SHA-512")});var ph={};ze(ph,{identity:()=>TA});var Fy=0,_A="identity",Ly=Gr,AA=t=>is(Fy,Ly(t)),TA={code:Fy,name:_A,encode:Ly,digest:AA};var wF=new TextEncoder,bF=new TextDecoder;var Za=class t{constructor(e,r,n,s){this.code=r,this.version=e,this.multihash=n,this.bytes=s,this.byteOffset=s.byteOffset,this.byteLength=s.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:Xa,byteLength:Xa,code:Ja,version:Ja,multihash:Ja,bytes:Ja,_baseCache:Xa,asCID:Xa})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:r}=this;if(e!==Wi)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==NA)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return t.createV0(r)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,n=is(e,r);return t.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&By(this.multihash,e.multihash)}toString(e){let{bytes:r,version:n,_baseCache:s}=this;switch(n){case 0:return PA(r,s,e||Nr.encoder);default:return RA(r,s,e||Ms.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return UA(/^0\.0/,kA),!!(e&&(e[qy]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof t)return e;if(e!=null&&e.asCID===e){let{version:r,code:n,multihash:s,bytes:i}=e;return new t(r,n,s,i||My(r,n,s.bytes))}else if(e!=null&&e[qy]===!0){let{version:r,multihash:n,code:s}=e,i=Ny(n);return t.create(r,s,i)}else return null}static create(e,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(r!==Wi)throw new Error(`Version 0 CID must use dag-pb (code: ${Wi}) block encoding`);return new t(e,r,n,n.bytes)}case 1:{let s=My(e,r,n.bytes);return new t(e,r,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return t.create(0,Wi,e)}static createV1(e,r){return t.create(1,e,r)}static decode(e){let[r,n]=t.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=t.inspectBytes(e),n=r.size-r.multihashSize,s=Gr(e.subarray(n,n+r.multihashSize));if(s.byteLength!==r.multihashSize)throw new Error("Incorrect length");let i=s.subarray(r.multihashSize-r.digestSize),o=new $s(r.multihashCode,r.digestSize,i,s);return[r.version===0?t.createV0(o):t.createV1(r.codec,o),e.subarray(r.size)]}static inspectBytes(e){let r=0,n=()=>{let[h,f]=Vi(e.subarray(r));return r+=f,h},s=n(),i=Wi;if(s===18?(s=0,r=0):s===1&&(i=n()),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=r,a=n(),c=n(),u=r+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,r){let[n,s]=OA(e,r),i=t.decode(s);return i._baseCache.set(n,e),i}},OA=(t,e)=>{switch(t[0]){case"Q":{let r=e||Nr;return[Nr.prefix,r.decode(`${Nr.prefix}${t}`)]}case Nr.prefix:{let r=e||Nr;return[Nr.prefix,r.decode(t)]}case Ms.prefix:{let r=e||Ms;return[Ms.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}},PA=(t,e,r)=>{let{prefix:n}=r;if(n!==Nr.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let s=e.get(n);if(s==null){let i=r.encode(t).slice(1);return e.set(n,i),i}else return s},RA=(t,e,r)=>{let{prefix:n}=r,s=e.get(n);if(s==null){let i=r.encode(t);return e.set(n,i),i}else return s},Wi=112,NA=18,My=(t,e,r)=>{let n=js(t),s=n+js(e),i=new Uint8Array(s+r.byteLength);return qs(t,i,0),qs(e,i,n),i.set(r,s),i},qy=Symbol.for("@ipld/js-cid/CID"),Ja={writable:!1,configurable:!1,enumerable:!0},Xa={writable:!1,enumerable:!1,configurable:!1},BA="0.0.0-dev",UA=(t,e)=>{if(t.test(BA))console.warn(e);else throw new Error(e)},kA=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var gh=M(M(M(M(M(M(M(M(M(M({},eh),th),rh),nh),sh),ih),oh),ah),ch),uh),TF=M(M({},dh),ph);function $y(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}var jy=$y("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),mh=$y("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=zi(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),FA=M({utf8:jy,"utf-8":jy,hex:gh.base16,latin1:mh,ascii:mh,binary:mh},gh),Qa=FA;function Nt(t,e="utf8"){let r=Qa[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ns(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Xe(t,e="utf8"){let r=Qa[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var zy={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var V0=Be(u0(),1);var WA=":";function Er(t){let[e,r]=t.split(WA);return{namespace:e,reference:r}}function K0(t,e){return t.includes(":")?[t]:e.chains||[]}var GA=Object.defineProperty,YA=Object.defineProperties,JA=Object.getOwnPropertyDescriptors,l0=Object.getOwnPropertySymbols,XA=Object.prototype.hasOwnProperty,ZA=Object.prototype.propertyIsEnumerable,Rh=(t,e,r)=>e in t?GA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,h0=(t,e)=>{for(var r in e||(e={}))XA.call(e,r)&&Rh(t,r,e[r]);if(l0)for(var r of l0(e))ZA.call(e,r)&&Rh(t,r,e[r]);return t},QA=(t,e)=>YA(t,JA(e)),f0=(t,e,r)=>Rh(t,typeof e!="symbol"?e+"":e,r),e3="ReactNative",Ut={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};var t3="js";function io(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function tn(){return!(0,br.getDocument)()&&!!(0,br.getNavigator)()&&navigator.product===e3}function W0(){return tn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function G0(){return tn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function hs(){return!io()&&!!(0,br.getNavigator)()&&!!(0,br.getDocument)()}function oo(){return tn()?Ut.reactNative:io()?Ut.node:hs()?Ut.browser:Ut.unknown}function Zh(){var t;try{return tn()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function r3(t,e){let r=new URLSearchParams(t);return Object.entries(e).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!=null&&r.set(n,String(s))}),r.toString()}function Y0(t){var e,r;let n=Qh();try{return t!=null&&t.url&&n.url&&new URL(t.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),t.url=n.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(s=>s!=="")),QA(h0(h0({},n),t),{url:t?.url||n.url,name:t?.name||n.name,description:t?.description||n.description,icons:(r=t?.icons)!=null&&r.length&&t.icons.length>0?t.icons:n.icons})}catch(s){return console.warn("Error populating app metadata",s),t||n}}function Qh(){return(0,H0.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function n3(){if(oo()===Ut.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){let{OS:r,Version:n}=global.Platform;return[r,n].join("-")}let t=im();if(t===null)return"unknown";let e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function s3(){var t;let e=oo();return e===Ut.browser?[e,((t=(0,br.getLocation)())==null?void 0:t.host)||"unknown"].join(":"):e}function ef(t,e,r){let n=n3(),s=s3();return[[t,e].join("-"),[t3,r].join("-"),n,s].join("/")}function J0({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:s,projectId:i,useOnCloseEvent:o,bundleId:a,packageName:c}){let u=r.split("?"),l=ef(t,e,n),h={auth:s,ua:l,projectId:i,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},f=r3(u[1]||"",h);return u[0]+"?"+f}function os(t,e){return t.filter(r=>e.includes(r)).length===t.length}function yc(t){return Object.fromEntries(t.entries())}function wc(t){return new Map(Object.entries(t))}function rn(t=Qr.FIVE_MINUTES,e){let r=(0,Qr.toMiliseconds)(t||Qr.FIVE_MINUTES),n,s,i,o;return{resolve:a=>{i&&n&&(clearTimeout(i),n(a),o=Promise.resolve(a))},reject:a=>{i&&s&&(clearTimeout(i),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);i=setTimeout(()=>{let u=new Error(e);o=Promise.reject(u),c(u)},r),n=a,s=c})}}function xr(t,e,r){return new Promise(async(n,s)=>{let i=setTimeout(()=>s(new Error(r)),e);try{let o=await t;n(o)}catch(o){s(o)}clearTimeout(i)})}function X0(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Z0(t){return X0("topic",t)}function Q0(t){return X0("id",t)}function bc(t){let[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function Ae(t,e){return(0,Qr.fromMiliseconds)((e||Date.now())+(0,Qr.toMiliseconds)(t))}function Kt(t){return Date.now()>=(0,Qr.toMiliseconds)(t)}function he(t,e){return`${t}${e?`:${e}`:""}`}function yr(t=[],e=[]){return[...new Set([...t,...e])]}async function ew({id:t,topic:e,wcDeepLink:r}){var n;try{if(!r)return;let s=typeof r=="string"?JSON.parse(r):r,i=s?.href;if(typeof i!="string")return;let o=i3(i,t,e),a=oo();if(a===Ut.browser){if(!((n=(0,br.getDocument)())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}o3(o)}else a===Ut.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function i3(t,e,r){let n=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){let i=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${i}${u3(n,!0)}`}else s=`${s}/wc?${n}`;return s}function o3(t){let e="_self";c3()?e="_top":(a3()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function tw(t,e){let r="";try{if(hs()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(n){console.error(n)}return r}function tf(t,e){if(!t.includes(e))return null;let r=t.split(/([&,?,=])/),n=r.indexOf(e);return r[n+2]}function rf(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function ao(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function a3(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function c3(){try{return window.self!==window.top}catch{return!1}}function u3(t,e=!1){let r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function rw(t){return Buffer.from(t,"base64").toString("utf-8")}function nw(t){return new Promise(e=>setTimeout(e,t))}var uc=class{constructor({limit:e}){f0(this,"limit"),f0(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){let r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}},sc=BigInt(2**32-1),d0=BigInt(32);function sw(t,e=!1){return e?{h:Number(t&sc),l:Number(t>>d0&sc)}:{h:Number(t>>d0&sc)|0,l:Number(t&sc)|0}}function iw(t,e=!1){let r=t.length,n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){let{h:o,l:a}=sw(t[i],e);[n[i],s[i]]=[o,a]}return[n,s]}var p0=(t,e,r)=>t>>>r,g0=(t,e,r)=>t<<32-r|e>>>r,_n=(t,e,r)=>t>>>r|e<<32-r,An=(t,e,r)=>t<<32-r|e>>>r,Qi=(t,e,r)=>t<<64-r|e>>>r-32,eo=(t,e,r)=>t>>>r-32|e<<64-r,l3=(t,e)=>e,h3=(t,e)=>t,f3=(t,e,r)=>t<<r|e>>>32-r,d3=(t,e,r)=>e<<r|t>>>32-r,p3=(t,e,r)=>e<<r-32|t>>>64-r,g3=(t,e,r)=>t<<r-32|e>>>64-r;function mr(t,e,r,n){let s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}var nf=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),sf=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,m3=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),y3=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,w3=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),b3=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,zs=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function vc(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function en(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function vr(t,...e){if(!vc(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ec(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");en(t.outputLen),en(t.blockLen)}function On(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function of(t,e){vr(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ro(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function tr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function vh(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Br(t,e){return t<<32-e|t>>>e}var ow=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function aw(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}var Jr=ow?t=>t:t=>aw(t);function v3(t){for(let e=0;e<t.length;e++)t[e]=aw(t[e]);return t}var Tn=ow?t=>t:v3,cw=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",E3=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ks(t){if(vr(t),cw)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=E3[t[r]];return e}var Yr={_0:48,_9:57,A:65,F:70,a:97,f:102};function m0(t){if(t>=Yr._0&&t<=Yr._9)return t-Yr._0;if(t>=Yr.A&&t<=Yr.F)return t-(Yr.A-10);if(t>=Yr.a&&t<=Yr.f)return t-(Yr.a-10)}function lc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(cw)return Uint8Array.fromHex(t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){let o=m0(t.charCodeAt(i)),a=m0(t.charCodeAt(i+1));if(o===void 0||a===void 0){let c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function uw(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function wr(t){return typeof t=="string"&&(t=uw(t)),vr(t),t}function Cn(...t){let e=0;for(let n=0;n<t.length;n++){let s=t[n];vr(s),e+=s.length}let r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){let i=t[n];r.set(i,s),s+=i.length}return r}var Gs=class{};function co(t){let e=n=>t().update(wr(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function x3(t){let e=(n,s)=>t(s).update(wr(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function fs(t=32){if(zs&&typeof zs.getRandomValues=="function")return zs.getRandomValues(new Uint8Array(t));if(zs&&typeof zs.randomBytes=="function")return Uint8Array.from(zs.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}var S3=BigInt(0),Xi=BigInt(1),I3=BigInt(2),_3=BigInt(7),A3=BigInt(256),T3=BigInt(113),lw=[],hw=[],fw=[];for(let t=0,e=Xi,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],lw.push(2*(5*n+r)),hw.push((t+1)*(t+2)/2%64);let s=S3;for(let i=0;i<7;i++)e=(e<<Xi^(e>>_3)*T3)%A3,e&I3&&(s^=Xi<<(Xi<<BigInt(i))-Xi);fw.push(s)}var dw=iw(fw,!0),C3=dw[0],D3=dw[1],y0=(t,e,r)=>r>32?p3(t,e,r):f3(t,e,r),w0=(t,e,r)=>r>32?g3(t,e,r):d3(t,e,r);function O3(t,e=24){let r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){let a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=y0(u,l,1)^r[a],f=w0(u,l,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=h,t[o+d+1]^=f}let s=t[2],i=t[3];for(let o=0;o<24;o++){let a=hw[o],c=y0(s,i,a),u=w0(s,i,a),l=lw[o];s=t[l],i=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=C3[n],t[1]^=D3[n]}tr(r)}var Nh=class t extends Gs{constructor(e,r,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=s,this.rounds=i,en(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=ro(this.state)}clone(){return this._cloneInto()}keccak(){Tn(this.state32),O3(this.state32,this.rounds),Tn(this.state32),this.posOut=0,this.pos=0}update(e){On(this),e=wr(e),vr(e);let{blockLen:r,state:n}=this,s=e.length;for(let i=0;i<s;){let o=Math.min(r-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:r,pos:n,blockLen:s}=this;e[n]^=r,(r&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){On(this,!1),vr(e),this.finish();let r=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();let o=Math.min(n-this.posOut,i-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return en(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(of(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,tr(this.state)}_cloneInto(e){let{blockLen:r,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new t(r,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}},P3=(t,e,r)=>co(()=>new Nh(e,t,r)),R3=P3(1,136,256/8);function N3(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function B3(t,e,r){return t&e^~t&r}function U3(t,e,r){return t&e^t&r^e&r}var hc=class extends Gs{constructor(e,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=vh(this.buffer)}update(e){On(this),e=wr(e),vr(e);let{view:r,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){let a=Math.min(s-this.pos,i-o);if(a===s){let c=vh(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){On(this),of(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:s,isLE:i}=this,{pos:o}=this;r[o++]=128,tr(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;N3(n,s-8,BigInt(this.length*8),i),this.process(n,0);let a=vh(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}},bn=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),at=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),ct=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),k3=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),vn=new Uint32Array(64),Bh=class extends hc{constructor(e=32){super(64,e,8,!1),this.A=bn[0]|0,this.B=bn[1]|0,this.C=bn[2]|0,this.D=bn[3]|0,this.E=bn[4]|0,this.F=bn[5]|0,this.G=bn[6]|0,this.H=bn[7]|0}get(){let{A:e,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,r,n,s,i,o,a,c]}set(e,r,n,s,i,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)vn[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){let f=vn[h-15],d=vn[h-2],p=Br(f,7)^Br(f,18)^f>>>3,g=Br(d,17)^Br(d,19)^d>>>10;vn[h]=g+vn[h-7]+p+vn[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){let f=Br(a,6)^Br(a,11)^Br(a,25),d=l+f+B3(a,c,u)+k3[h]+vn[h]|0,p=(Br(n,2)^Br(n,13)^Br(n,22))+U3(n,s,i)|0;l=u,u=c,c=a,a=o+d|0,o=i,i=s,s=n,n=d+p|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,s,i,o,a,c,u,l)}roundClean(){tr(vn)}destroy(){this.set(0,0,0,0,0,0,0,0),tr(this.buffer)}},pw=iw(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),F3=pw[0],L3=pw[1],En=new Uint32Array(80),xn=new Uint32Array(80),no=class extends hc{constructor(e=64){super(128,e,16,!1),this.Ah=ct[0]|0,this.Al=ct[1]|0,this.Bh=ct[2]|0,this.Bl=ct[3]|0,this.Ch=ct[4]|0,this.Cl=ct[5]|0,this.Dh=ct[6]|0,this.Dl=ct[7]|0,this.Eh=ct[8]|0,this.El=ct[9]|0,this.Fh=ct[10]|0,this.Fl=ct[11]|0,this.Gh=ct[12]|0,this.Gl=ct[13]|0,this.Hh=ct[14]|0,this.Hl=ct[15]|0}get(){let{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:d,Gl:p,Hh:g,Hl:w}=this;return[e,r,n,s,i,o,a,c,u,l,h,f,d,p,g,w]}set(e,r,n,s,i,o,a,c,u,l,h,f,d,p,g,w){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=p|0,this.Hh=g|0,this.Hl=w|0}process(e,r){for(let x=0;x<16;x++,r+=4)En[x]=e.getUint32(r),xn[x]=e.getUint32(r+=4);for(let x=16;x<80;x++){let I=En[x-15]|0,C=xn[x-15]|0,B=_n(I,C,1)^_n(I,C,8)^p0(I,C,7),k=An(I,C,1)^An(I,C,8)^g0(I,C,7),U=En[x-2]|0,N=xn[x-2]|0,j=_n(U,N,19)^Qi(U,N,61)^p0(U,N,6),b=An(U,N,19)^eo(U,N,61)^g0(U,N,6),E=m3(k,b,xn[x-7],xn[x-16]),v=y3(E,B,j,En[x-7],En[x-16]);En[x]=v|0,xn[x]=E|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:d,Fl:p,Gh:g,Gl:w,Hh:P,Hl:R}=this;for(let x=0;x<80;x++){let I=_n(h,f,14)^_n(h,f,18)^Qi(h,f,41),C=An(h,f,14)^An(h,f,18)^eo(h,f,41),B=h&d^~h&g,k=f&p^~f&w,U=w3(R,C,k,L3[x],xn[x]),N=b3(U,P,I,B,F3[x],En[x]),j=U|0,b=_n(n,s,28)^Qi(n,s,34)^Qi(n,s,39),E=An(n,s,28)^eo(n,s,34)^eo(n,s,39),v=n&i^n&a^i&a,A=s&o^s&c^o&c;P=g|0,R=w|0,g=d|0,w=p|0,d=h|0,p=f|0,{h,l:f}=mr(u|0,l|0,N|0,j|0),u=a|0,l=c|0,a=i|0,c=o|0,i=n|0,o=s|0;let y=nf(j,E,A);n=sf(y,N,b,v),s=y|0}({h:n,l:s}=mr(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=mr(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=mr(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=mr(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=mr(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:p}=mr(this.Fh|0,this.Fl|0,d|0,p|0),{h:g,l:w}=mr(this.Gh|0,this.Gl|0,g|0,w|0),{h:P,l:R}=mr(this.Hh|0,this.Hl|0,P|0,R|0),this.set(n,s,i,o,a,c,u,l,h,f,d,p,g,w,P,R)}roundClean(){tr(En,xn)}destroy(){tr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Uh=class extends no{constructor(){super(48),this.Ah=at[0]|0,this.Al=at[1]|0,this.Bh=at[2]|0,this.Bl=at[3]|0,this.Ch=at[4]|0,this.Cl=at[5]|0,this.Dh=at[6]|0,this.Dl=at[7]|0,this.Eh=at[8]|0,this.El=at[9]|0,this.Fh=at[10]|0,this.Fl=at[11]|0,this.Gh=at[12]|0,this.Gl=at[13]|0,this.Hh=at[14]|0,this.Hl=at[15]|0}},ut=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]),kh=class extends no{constructor(){super(32),this.Ah=ut[0]|0,this.Al=ut[1]|0,this.Bh=ut[2]|0,this.Bl=ut[3]|0,this.Ch=ut[4]|0,this.Cl=ut[5]|0,this.Dh=ut[6]|0,this.Dl=ut[7]|0,this.Eh=ut[8]|0,this.El=ut[9]|0,this.Fh=ut[10]|0,this.Fl=ut[11]|0,this.Gh=ut[12]|0,this.Gl=ut[13]|0,this.Hh=ut[14]|0,this.Hl=ut[15]|0}},xc=co(()=>new Bh),M3=co(()=>new no),q3=co(()=>new Uh),j3=co(()=>new kh),$3=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),je=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),V=new Uint32Array(32);function Sn(t,e,r,n,s,i){let o=s[i],a=s[i+1],c=V[2*t],u=V[2*t+1],l=V[2*e],h=V[2*e+1],f=V[2*r],d=V[2*r+1],p=V[2*n],g=V[2*n+1],w=nf(c,l,o);u=sf(w,u,h,a),c=w|0,{Dh:g,Dl:p}={Dh:g^u,Dl:p^c},{Dh:g,Dl:p}={Dh:l3(g,p),Dl:h3(g)},{h:d,l:f}=mr(d,f,g,p),{Bh:h,Bl:l}={Bh:h^d,Bl:l^f},{Bh:h,Bl:l}={Bh:_n(h,l,24),Bl:An(h,l,24)},V[2*t]=c,V[2*t+1]=u,V[2*e]=l,V[2*e+1]=h,V[2*r]=f,V[2*r+1]=d,V[2*n]=p,V[2*n+1]=g}function In(t,e,r,n,s,i){let o=s[i],a=s[i+1],c=V[2*t],u=V[2*t+1],l=V[2*e],h=V[2*e+1],f=V[2*r],d=V[2*r+1],p=V[2*n],g=V[2*n+1],w=nf(c,l,o);u=sf(w,u,h,a),c=w|0,{Dh:g,Dl:p}={Dh:g^u,Dl:p^c},{Dh:g,Dl:p}={Dh:_n(g,p,16),Dl:An(g,p,16)},{h:d,l:f}=mr(d,f,g,p),{Bh:h,Bl:l}={Bh:h^d,Bl:l^f},{Bh:h,Bl:l}={Bh:Qi(h,l,63),Bl:eo(h,l,63)},V[2*t]=c,V[2*t+1]=u,V[2*e]=l,V[2*e+1]=h,V[2*r]=f,V[2*r+1]=d,V[2*n]=p,V[2*n+1]=g}function z3(t,e={},r,n,s){if(en(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");let{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}var Fh=class extends Gs{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,en(e),en(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=ro(this.buffer)}update(e){On(this),e=wr(e),vr(e);let{blockLen:r,buffer:n,buffer32:s}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===r&&(Tn(s),this.compress(s,0,!1),Tn(s),this.pos=0);let u=Math.min(r-this.pos,i-c),l=o+c;if(u===r&&!(l%4)&&c+u<i){let h=new Uint32Array(a,l,Math.floor((i-c)/4));Tn(h);for(let f=0;c+r<i;f+=s.length,c+=r)this.length+=r,this.compress(h,f,!1);Tn(h);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){On(this),of(e,this);let{pos:r,buffer32:n}=this;this.finished=!0,tr(this.buffer.subarray(r)),Tn(n),this.compress(n,0,!0),Tn(n);let s=ro(e);this.get().forEach((i,o)=>s[o]=Jr(i))}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){let{buffer:r,length:n,finished:s,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=i,e.finished=s,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},Lh=class extends Fh{constructor(e={}){let r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=je[0]|0,this.v0h=je[1]|0,this.v1l=je[2]|0,this.v1h=je[3]|0,this.v2l=je[4]|0,this.v2h=je[5]|0,this.v3l=je[6]|0,this.v3h=je[7]|0,this.v4l=je[8]|0,this.v4h=je[9]|0,this.v5l=je[10]|0,this.v5h=je[11]|0,this.v6l=je[12]|0,this.v6h=je[13]|0,this.v7l=je[14]|0,this.v7h=je[15]|0,z3(r,e,64,16,16);let{key:n,personalization:s,salt:i}=e,o=0;if(n!==void 0&&(n=wr(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=wr(i);let a=ro(i);this.v4l^=Jr(a[0]),this.v4h^=Jr(a[1]),this.v5l^=Jr(a[2]),this.v5h^=Jr(a[3])}if(s!==void 0){s=wr(s);let a=ro(s);this.v6l^=Jr(a[0]),this.v6h^=Jr(a[1]),this.v7l^=Jr(a[2]),this.v7h^=Jr(a[3])}if(n!==void 0){let a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:s,v2l:i,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:h,v5h:f,v6l:d,v6h:p,v7l:g,v7h:w}=this;return[e,r,n,s,i,o,a,c,u,l,h,f,d,p,g,w]}set(e,r,n,s,i,o,a,c,u,l,h,f,d,p,g,w){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=s|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=h|0,this.v5h=f|0,this.v6l=d|0,this.v6h=p|0,this.v7l=g|0,this.v7h=w|0}compress(e,r,n){this.get().forEach((c,u)=>V[u]=c),V.set(je,16);let{h:s,l:i}=sw(BigInt(this.length));V[24]=je[8]^i,V[25]=je[9]^s,n&&(V[28]=~V[28],V[29]=~V[29]);let o=0,a=$3;for(let c=0;c<12;c++)Sn(0,4,8,12,e,r+2*a[o++]),In(0,4,8,12,e,r+2*a[o++]),Sn(1,5,9,13,e,r+2*a[o++]),In(1,5,9,13,e,r+2*a[o++]),Sn(2,6,10,14,e,r+2*a[o++]),In(2,6,10,14,e,r+2*a[o++]),Sn(3,7,11,15,e,r+2*a[o++]),In(3,7,11,15,e,r+2*a[o++]),Sn(0,5,10,15,e,r+2*a[o++]),In(0,5,10,15,e,r+2*a[o++]),Sn(1,6,11,12,e,r+2*a[o++]),In(1,6,11,12,e,r+2*a[o++]),Sn(2,7,8,13,e,r+2*a[o++]),In(2,7,8,13,e,r+2*a[o++]),Sn(3,4,9,14,e,r+2*a[o++]),In(3,4,9,14,e,r+2*a[o++]);this.v0l^=V[0]^V[16],this.v0h^=V[1]^V[17],this.v1l^=V[2]^V[18],this.v1h^=V[3]^V[19],this.v2l^=V[4]^V[20],this.v2h^=V[5]^V[21],this.v3l^=V[6]^V[22],this.v3h^=V[7]^V[23],this.v4l^=V[8]^V[24],this.v4h^=V[9]^V[25],this.v5l^=V[10]^V[26],this.v5h^=V[11]^V[27],this.v6l^=V[12]^V[28],this.v6h^=V[13]^V[29],this.v7l^=V[14]^V[30],this.v7h^=V[15]^V[31],tr(V)}destroy(){this.destroyed=!0,tr(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},H3=x3(t=>new Lh(t)),V3="https://rpc.walletconnect.org/v1";function gw(t){let e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(R3(r)).toString("hex")}async function K3(t,e,r,n,s,i){switch(r.t){case"eip191":return await W3(t,e,r.s);case"eip1271":return await G3(t,e,r.s,n,s,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function W3(t,e,r){let n=La.fromHex(r);return $a.recoverAddress({payload:gw(e),signature:n}).toLowerCase()===t.toLowerCase()}async function G3(t,e,r,n,s,i){let o=Er(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{let a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u=r.substring(2),l=(u.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:gw(e)).substring(2),f=a+h+c+l+u,d=await fetch(`${i||V3}/?chainId=${n}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Y3(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:p}=await d.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function Y3(){return Date.now()+Math.floor(Math.random()*1e3)}function mw(t){let e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);let n=r[0];if(n===0)throw new Error("No signatures found");let s=1+n*64;if(r.length<s)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");let i=Buffer.from(t,"base64").slice(1,65);return Fs.encode(i)}function yw(t){let e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(i=>i.charCodeAt(0)),n=new Uint8Array(r.length+e.length);n.set(r),n.set(e,r.length);let s=H3(n,{dkLen:32});return Fs.encode(s)}function af(t){let e=new Uint8Array(xc(J3(t)));return Fs.encode(e)}function J3(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function cf(t){let e=Buffer.from(t,"base64"),r=Yl(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");let n=Vl(r),s=Buffer.from("TX"),i=Buffer.concat([s,Buffer.from(n)]),o=j3(i);return cy.encode(o).replace(/=+$/,"")}function Eh(t){let e=[],r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function ww(t){let e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),n=Buffer.from(t.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(Eh(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(Eh(r.length)),s.push(r),s.push(Buffer.from([26])),s.push(Eh(n.length)),s.push(n);let i=Buffer.concat(s),o=xc(i);return Buffer.from(o).toString("hex").toUpperCase()}function bw(t){var e,r;let n=[];try{if(typeof t=="string")return n.push(t),n;if(typeof t!="object")return n;t!=null&&t.id&&n.push(t.id);let s=(r=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;s&&n.push(...s)}catch(s){console.warn("getWalletSendCallsHashes failed: ",s)}return n}var X3=Object.defineProperty,Z3=Object.defineProperties,Q3=Object.getOwnPropertyDescriptors,b0=Object.getOwnPropertySymbols,e8=Object.prototype.hasOwnProperty,t8=Object.prototype.propertyIsEnumerable,v0=(t,e,r)=>e in t?X3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,r8=(t,e)=>{for(var r in e||(e={}))e8.call(e,r)&&v0(t,r,e[r]);if(b0)for(var r of b0(e))t8.call(e,r)&&v0(t,r,e[r]);return t},n8=(t,e)=>Z3(t,Q3(e)),s8="did:pkh:",uf=t=>t?.split(":"),i8=t=>{let e=t&&uf(t);if(e)return t.includes(s8)?e[3]:e[1]},Sc=t=>{let e=t&&uf(t);if(e)return e[2]+":"+e[3]},uo=t=>{let e=t&&uf(t);if(e)return e.pop()};async function lf(t){let{cacao:e,projectId:r}=t,{s:n,p:s}=e,i=hf(s,s.iss),o=uo(s.iss);return await K3(o,i,n,Sc(s.iss),r)}var hf=(t,e)=>{let r=`${t.domain} wants you to sign in with your Ethereum account:`,n=uo(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0,i=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${i8(e)}`,c=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,l=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,f=t.requestId?`Request ID: ${t.requestId}`:void 0,d=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,p=lo(t.resources);if(p){let g=so(p);s=f8(s,g)}return[r,n,"",s,"",i,o,a,c,u,l,h,f,d].filter(g=>g!=null).join(`
`)};function o8(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function a8(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function ls(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");let e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{let n=t.att[r];if(Array.isArray(n))throw new Error(`Resource must be an object: ${r}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(n).forEach(s=>{let i=n[s];if(!Array.isArray(i))throw new Error(`Ability limits ${s} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);i.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function c8(t,e,r,n={}){return r?.sort((s,i)=>s.localeCompare(i)),{att:{[t]:u8(e,r,n)}}}function u8(t,e,r={}){e=e?.sort((s,i)=>s.localeCompare(i));let n=e.map(s=>({[`${t}/${s}`]:[r]}));return Object.assign({},...n)}function vw(t){return ls(t),`urn:recap:${o8(t).replace(/=/g,"")}`}function so(t){let e=a8(t.replace("urn:recap:",""));return ls(e),e}function Ew(t,e,r){let n=c8(t,e,r);return vw(n)}function l8(t){return t&&t.includes("urn:recap:")}function xw(t,e){let r=so(t),n=so(e),s=h8(r,n);return vw(s)}function h8(t,e){ls(t),ls(e);let r=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,i)=>s.localeCompare(i)),n={att:{}};return r.forEach(s=>{var i,o;Object.keys(((i=t.att)==null?void 0:i[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;n.att[s]=n8(r8({},n.att[s]),{[a]:((c=t.att[s])==null?void 0:c[a])||((u=e.att[s])==null?void 0:u[a])})})}),n}function f8(t="",e){ls(e);let r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;let n=[],s=0;Object.keys(e.att).forEach(a=>{let c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));let u={};c.forEach(h=>{u[h.ability]||(u[h.ability]=[]),u[h.ability].push(h.action)});let l=Object.keys(u).map(h=>(s++,`(${s}) '${h}': '${u[h].join("', '")}' for '${a}'.`));n.push(l.join(", ").replace(".,","."))});let i=n.join(" "),o=`${r}${i}`;return`${t?t+" ":""}${o}`}function ff(t){var e;let r=so(t);ls(r);let n=(e=r.att)==null?void 0:e.eip155;return n?Object.keys(n).map(s=>s.split("/")[1]):[]}function df(t){let e=so(t);ls(e);let r=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(s=>{var i;(i=s?.[0])!=null&&i.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function lo(t){if(!t)return;let e=t?.[t.length-1];return l8(e)?e:void 0}function Sw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Mh(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function xh(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Bt(t,...e){if(!Sw(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function E0(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function d8(t,e){Bt(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Dn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ys(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function p8(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}var g8=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function m8(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function qh(t){if(typeof t=="string")t=m8(t);else if(Sw(t))t=jh(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function y8(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function w8(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}var b8=(t,e)=>{function r(n,...s){if(Bt(n),!g8)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){let u=s[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?Bt(u):Bt(u,t.nonceLength)}let i=t.tagLength;i&&s[1]!==void 0&&Bt(s[1]);let o=e(n,...s),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");Bt(l)}},c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Bt(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(Bt(u),i&&u.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function x0(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!E8(e))throw new Error("invalid output, must be aligned");return e}function S0(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function v8(t,e,r){Mh(r);let n=new Uint8Array(16),s=p8(n);return S0(s,0,BigInt(e),r),S0(s,8,BigInt(t),r),n}function E8(t){return t.byteOffset%4===0}function jh(t){return Uint8Array.from(t)}var Iw=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),x8=Iw("expand 16-byte k"),S8=Iw("expand 32-byte k"),I8=Dn(x8),_8=Dn(S8);function le(t,e){return t<<e|t>>>32-e}function $h(t){return t.byteOffset%4===0}var ic=64,A8=16,_w=2**32-1,I0=new Uint32Array;function T8(t,e,r,n,s,i,o,a){let c=s.length,u=new Uint8Array(ic),l=Dn(u),h=$h(s)&&$h(i),f=h?Dn(s):I0,d=h?Dn(i):I0;for(let p=0;p<c;o++){if(t(e,r,n,l,o,a),o>=_w)throw new Error("arx: counter overflow");let g=Math.min(ic,c-p);if(h&&g===ic){let w=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let P=0,R;P<A8;P++)R=w+P,d[R]=f[R]^l[P];p+=ic;continue}for(let w=0,P;w<g;w++)P=p+w,i[P]=s[P]^u[w];p+=g}}function C8(t,e){let{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=y8({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return xh(s),xh(o),Mh(i),Mh(r),(a,c,u,l,h=0)=>{Bt(a),Bt(c),Bt(u);let f=u.length;if(l===void 0&&(l=new Uint8Array(f)),Bt(l),xh(h),h<0||h>=_w)throw new Error("arx: counter overflow");if(l.length<f)throw new Error(`arx: output (${l.length}) is shorter than data (${f})`);let d=[],p=a.length,g,w;if(p===32)d.push(g=jh(a)),w=_8;else if(p===16&&r)g=new Uint8Array(32),g.set(a),g.set(a,16),w=I8,d.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);$h(c)||d.push(c=jh(c));let P=Dn(g);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(w,P,Dn(c.subarray(0,16)),P),c=c.subarray(16)}let R=16-s;if(R!==c.length)throw new Error(`arx: nonce must be ${R} or 16 bytes`);if(R!==12){let I=new Uint8Array(12);I.set(c,i?0:12-c.length),c=I,d.push(c)}let x=Dn(c);return T8(t,w,P,x,u,l,h,o),Ys(...d),l}}var Qe=(t,e)=>t[e++]&255|(t[e++]&255)<<8,zh=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=qh(e),Bt(e,32);let r=Qe(e,0),n=Qe(e,2),s=Qe(e,4),i=Qe(e,6),o=Qe(e,8),a=Qe(e,10),c=Qe(e,12),u=Qe(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Qe(e,16+2*l)}process(e,r,n=!1){let s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],f=o[5],d=o[6],p=o[7],g=o[8],w=o[9],P=Qe(e,r+0),R=Qe(e,r+2),x=Qe(e,r+4),I=Qe(e,r+6),C=Qe(e,r+8),B=Qe(e,r+10),k=Qe(e,r+12),U=Qe(e,r+14),N=i[0]+(P&8191),j=i[1]+((P>>>13|R<<3)&8191),b=i[2]+((R>>>10|x<<6)&8191),E=i[3]+((x>>>7|I<<9)&8191),v=i[4]+((I>>>4|C<<12)&8191),A=i[5]+(C>>>1&8191),y=i[6]+((C>>>14|B<<2)&8191),m=i[7]+((B>>>11|k<<5)&8191),_=i[8]+((k>>>8|U<<8)&8191),O=i[9]+(U>>>5|s),S=0,T=S+N*a+j*(5*w)+b*(5*g)+E*(5*p)+v*(5*d);S=T>>>13,T&=8191,T+=A*(5*f)+y*(5*h)+m*(5*l)+_*(5*u)+O*(5*c),S+=T>>>13,T&=8191;let F=S+N*c+j*a+b*(5*w)+E*(5*g)+v*(5*p);S=F>>>13,F&=8191,F+=A*(5*d)+y*(5*f)+m*(5*h)+_*(5*l)+O*(5*u),S+=F>>>13,F&=8191;let L=S+N*u+j*c+b*a+E*(5*w)+v*(5*g);S=L>>>13,L&=8191,L+=A*(5*p)+y*(5*d)+m*(5*f)+_*(5*h)+O*(5*l),S+=L>>>13,L&=8191;let K=S+N*l+j*u+b*c+E*a+v*(5*w);S=K>>>13,K&=8191,K+=A*(5*g)+y*(5*p)+m*(5*d)+_*(5*f)+O*(5*h),S+=K>>>13,K&=8191;let H=S+N*h+j*l+b*u+E*c+v*a;S=H>>>13,H&=8191,H+=A*(5*w)+y*(5*g)+m*(5*p)+_*(5*d)+O*(5*f),S+=H>>>13,H&=8191;let z=S+N*f+j*h+b*l+E*u+v*c;S=z>>>13,z&=8191,z+=A*a+y*(5*w)+m*(5*g)+_*(5*p)+O*(5*d),S+=z>>>13,z&=8191;let G=S+N*d+j*f+b*h+E*l+v*u;S=G>>>13,G&=8191,G+=A*c+y*a+m*(5*w)+_*(5*g)+O*(5*p),S+=G>>>13,G&=8191;let J=S+N*p+j*d+b*f+E*h+v*l;S=J>>>13,J&=8191,J+=A*u+y*c+m*a+_*(5*w)+O*(5*g),S+=J>>>13,J&=8191;let ne=S+N*g+j*p+b*d+E*f+v*h;S=ne>>>13,ne&=8191,ne+=A*l+y*u+m*c+_*a+O*(5*w),S+=ne>>>13,ne&=8191;let Y=S+N*w+j*g+b*p+E*d+v*f;S=Y>>>13,Y&=8191,Y+=A*h+y*l+m*u+_*c+O*a,S+=Y>>>13,Y&=8191,S=(S<<2)+S|0,S=S+T|0,T=S&8191,S=S>>>13,F+=S,i[0]=T,i[1]=F,i[2]=L,i[3]=K,i[4]=H,i[5]=z,i[6]=G,i[7]=J,i[8]=ne,i[9]=Y}finalize(){let{h:e,pad:r}=this,n=new Uint16Array(10),s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Ys(n)}update(e){E0(this),e=qh(e),Bt(e);let{buffer:r,blockLen:n}=this,s=e.length;for(let i=0;i<s;){let o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Ys(this.h,this.r,this.buffer,this.pad)}digestInto(e){E0(this),d8(e,this),this.finished=!0;let{buffer:r,h:n}=this,{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}};function D8(t){let e=(n,s)=>t(s).update(qh(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}var O8=D8(t=>new zh(t));function P8(t,e,r,n,s,i=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],f=e[2],d=e[3],p=e[4],g=e[5],w=e[6],P=e[7],R=s,x=r[0],I=r[1],C=r[2],B=o,k=a,U=c,N=u,j=l,b=h,E=f,v=d,A=p,y=g,m=w,_=P,O=R,S=x,T=I,F=C;for(let K=0;K<i;K+=2)B=B+j|0,O=le(O^B,16),A=A+O|0,j=le(j^A,12),B=B+j|0,O=le(O^B,8),A=A+O|0,j=le(j^A,7),k=k+b|0,S=le(S^k,16),y=y+S|0,b=le(b^y,12),k=k+b|0,S=le(S^k,8),y=y+S|0,b=le(b^y,7),U=U+E|0,T=le(T^U,16),m=m+T|0,E=le(E^m,12),U=U+E|0,T=le(T^U,8),m=m+T|0,E=le(E^m,7),N=N+v|0,F=le(F^N,16),_=_+F|0,v=le(v^_,12),N=N+v|0,F=le(F^N,8),_=_+F|0,v=le(v^_,7),B=B+b|0,F=le(F^B,16),m=m+F|0,b=le(b^m,12),B=B+b|0,F=le(F^B,8),m=m+F|0,b=le(b^m,7),k=k+E|0,O=le(O^k,16),_=_+O|0,E=le(E^_,12),k=k+E|0,O=le(O^k,8),_=_+O|0,E=le(E^_,7),U=U+v|0,S=le(S^U,16),A=A+S|0,v=le(v^A,12),U=U+v|0,S=le(S^U,8),A=A+S|0,v=le(v^A,7),N=N+j|0,T=le(T^N,16),y=y+T|0,j=le(j^y,12),N=N+j|0,T=le(T^N,8),y=y+T|0,j=le(j^y,7);let L=0;n[L++]=o+B|0,n[L++]=a+k|0,n[L++]=c+U|0,n[L++]=u+N|0,n[L++]=l+j|0,n[L++]=h+b|0,n[L++]=f+E|0,n[L++]=d+v|0,n[L++]=p+A|0,n[L++]=g+y|0,n[L++]=w+m|0,n[L++]=P+_|0,n[L++]=R+O|0,n[L++]=x+S|0,n[L++]=I+T|0,n[L++]=C+F|0}var R8=C8(P8,{counterRight:!1,counterLength:4,allowShortKeys:!1}),N8=new Uint8Array(16),_0=(t,e)=>{t.update(e);let r=e.length%16;r&&t.update(N8.subarray(r))},B8=new Uint8Array(32);function A0(t,e,r,n,s){let i=t(e,r,B8),o=O8.create(i);s&&_0(o,s),_0(o,n);let a=v8(n.length,s?s.length:0,!0);o.update(a);let c=o.digest();return Ys(i,a),c}var U8=t=>(e,r,n)=>({encrypt(s,i){let o=s.length;i=x0(o+16,i,!1),i.set(s);let a=i.subarray(0,-16);t(e,r,a,a,1);let c=A0(t,e,r,a,n);return i.set(c,o),Ys(c),i},decrypt(s,i){i=x0(s.length-16,i,!1);let o=s.subarray(0,-16),a=s.subarray(-16),c=A0(t,e,r,o,n);if(!w8(a,c))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),t(e,r,i,i,1),Ys(c),i}}),Aw=b8({blockSize:64,nonceLength:12,tagLength:16},U8(R8)),fc=class extends Gs{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Ec(e);let n=wr(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),tr(i)}update(e){return On(this),this.iHash.update(e),this}digestInto(e){On(this),vr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Ic=(t,e,r)=>new fc(t,e).update(r).digest();Ic.create=(t,e)=>new fc(t,e);function k8(t,e,r){return Ec(t),r===void 0&&(r=new Uint8Array(t.outputLen)),Ic(t,wr(r),wr(e))}var Sh=Uint8Array.from([0]),T0=Uint8Array.of();function F8(t,e,r,n=32){Ec(t),en(n);let s=t.outputLen;if(n>255*s)throw new Error("Length should be <= 255*HashLen");let i=Math.ceil(n/s);r===void 0&&(r=T0);let o=new Uint8Array(i*s),a=Ic.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<i;l++)Sh[0]=l+1,c.update(l===0?T0:u).update(r).update(Sh).digestInto(u),o.set(u,s*l),a._cloneInto(c);return a.destroy(),c.destroy(),tr(u,Sh),o.slice(0,n)}var L8=(t,e,r,n,s)=>F8(t,k8(t,e,r),n,s),_c=xc,pf=BigInt(0),Hh=BigInt(1);function dc(t,e=""){if(typeof t!="boolean"){let r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function as(t,e,r=""){let n=vc(t),s=t?.length,i=e!==void 0;if(!n||i&&s!==e){let o=r&&`"${r}" `,a=i?` of length ${e}`:"",c=n?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function oc(t){let e=t.toString(16);return e.length&1?"0"+e:e}function Tw(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?pf:BigInt("0x"+t)}function Ac(t){return Tw(Ks(t))}function pc(t){return vr(t),Tw(Ks(Uint8Array.from(t).reverse()))}function gf(t,e){return lc(t.toString(16).padStart(e*2,"0"))}function mf(t,e){return gf(t,e).reverse()}function lt(t,e,r){let n;if(typeof e=="string")try{n=lc(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(vc(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}var Ih=t=>typeof t=="bigint"&&pf<=t;function M8(t,e,r){return Ih(t)&&Ih(e)&&Ih(r)&&e<=t&&t<r}function Vh(t,e,r,n){if(!M8(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Cw(t){let e;for(e=0;t>pf;t>>=Hh,e+=1);return e}var ho=t=>(Hh<<BigInt(t))-Hh;function q8(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=f=>new Uint8Array(f),s=f=>Uint8Array.of(f),i=n(t),o=n(t),a=0,c=()=>{i.fill(1),o.fill(0),a=0},u=(...f)=>r(o,i,...f),l=(f=n(0))=>{o=u(s(0),f),i=u(),f.length!==0&&(o=u(s(1),f),i=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0,d=[];for(;f<e;){i=u();let p=i.slice();d.push(p),f+=i.length}return Cn(...d)};return(f,d)=>{c(),l(f);let p;for(;!(p=d(h()));)l();return c(),p}}function Tc(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(s,i,o){let a=t[s];if(o&&a===void 0)return;let c=typeof a;if(c!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([s,i])=>n(s,i,!1)),Object.entries(r).forEach(([s,i])=>n(s,i,!0))}function C0(t){let e=new WeakMap;return(r,...n)=>{let s=e.get(r);if(s!==void 0)return s;let i=t(r,...n);return e.set(r,i),i}}var kt=BigInt(0),It=BigInt(1),cs=BigInt(2),Dw=BigInt(3),Ow=BigInt(4),Pw=BigInt(5),j8=BigInt(7),Rw=BigInt(8),$8=BigInt(9),Nw=BigInt(16);function Vt(t,e){let r=t%e;return r>=kt?r:e+r}function gr(t,e,r){let n=t;for(;e-- >kt;)n*=n,n%=r;return n}function D0(t,e){if(t===kt)throw new Error("invert: expected non-zero number");if(e<=kt)throw new Error("invert: expected positive modulus, got "+e);let r=Vt(t,e),n=e,s=kt,i=It;for(;r!==kt;){let o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==It)throw new Error("invert: does not exist");return Vt(s,e)}function yf(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Bw(t,e){let r=(t.ORDER+It)/Ow,n=t.pow(e,r);return yf(t,n,e),n}function z8(t,e){let r=(t.ORDER-Pw)/Rw,n=t.mul(e,cs),s=t.pow(n,r),i=t.mul(e,s),o=t.mul(t.mul(i,cs),s),a=t.mul(i,t.sub(o,t.ONE));return yf(t,a,e),a}function H8(t){let e=Nn(t),r=Uw(t),n=r(e,e.neg(e.ONE)),s=r(e,n),i=r(e,e.neg(n)),o=(t+j8)/Nw;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,n),h=a.mul(u,s),f=a.mul(u,i),d=a.eql(a.sqr(l),c),p=a.eql(a.sqr(h),c);u=a.cmov(u,l,d),l=a.cmov(f,h,p);let g=a.eql(a.sqr(l),c),w=a.cmov(u,l,g);return yf(a,w,c),w}}function Uw(t){if(t<Dw)throw new Error("sqrt is not defined for small field");let e=t-It,r=0;for(;e%cs===kt;)e/=cs,r++;let n=cs,s=Nn(t);for(;O0(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Bw;let i=s.pow(n,e),o=(e+It)/cs;return function(a,c){if(a.is0(c))return c;if(O0(a,c)!==1)throw new Error("Cannot find square root");let u=r,l=a.mul(a.ONE,i),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let d=1,p=a.sqr(h);for(;!a.eql(p,a.ONE);)if(d++,p=a.sqr(p),d===u)throw new Error("Cannot find square root");let g=It<<BigInt(u-d-1),w=a.pow(l,g);u=d,l=a.sqr(w),h=a.mul(h,l),f=a.mul(f,w)}return f}}function V8(t){return t%Ow===Dw?Bw:t%Rw===Pw?z8:t%Nw===$8?H8(t):Uw(t)}var K8=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function W8(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=K8.reduce((n,s)=>(n[s]="function",n),e);return Tc(t,r),t}function G8(t,e,r){if(r<kt)throw new Error("invalid exponent, negatives unsupported");if(r===kt)return t.ONE;if(r===It)return e;let n=t.ONE,s=e;for(;r>kt;)r&It&&(n=t.mul(n,s)),s=t.sqr(s),r>>=It;return n}function kw(t,e,r=!1){let n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function O0(t,e){let r=(t.ORDER-It)/cs,n=t.pow(e,r),s=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function Fw(t,e){e!==void 0&&en(e);let r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Nn(t,e,r=!1,n={}){if(t<=kt)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,i,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let f=e;f.BITS&&(s=f.BITS),f.sqrt&&(i=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(s=e),n.sqrt&&(i=n.sqrt);let{nBitLength:c,nByteLength:u}=Fw(t,s);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l,h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:u,MASK:ho(c),ZERO:kt,ONE:It,allowedLengths:a,create:f=>Vt(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return kt<=f&&f<t},is0:f=>f===kt,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&It)===It,neg:f=>Vt(-f,t),eql:(f,d)=>f===d,sqr:f=>Vt(f*f,t),add:(f,d)=>Vt(f+d,t),sub:(f,d)=>Vt(f-d,t),mul:(f,d)=>Vt(f*d,t),pow:(f,d)=>G8(h,f,d),div:(f,d)=>Vt(f*D0(d,t),t),sqrN:f=>f*f,addN:(f,d)=>f+d,subN:(f,d)=>f-d,mulN:(f,d)=>f*d,inv:f=>D0(f,t),sqrt:i||(f=>(l||(l=V8(t)),l(h,f))),toBytes:f=>r?mf(f,u):gf(f,u),fromBytes:(f,d=!0)=>{if(a){if(!a.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);let g=new Uint8Array(u);g.set(f,r?0:g.length-f.length),f=g}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let p=r?pc(f):Ac(f);if(o&&(p=Vt(p,t)),!d&&!h.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:f=>kw(h,f),cmov:(f,d,p)=>p?d:f});return Object.freeze(h)}function Lw(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function Mw(t){let e=Lw(t);return e+Math.ceil(e/2)}function Y8(t,e,r=!1){let n=t.length,s=Lw(e),i=Mw(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);let o=r?pc(t):Ac(t),a=Vt(o,e-It)+It;return r?mf(a,s):gf(a,s)}var Js=BigInt(0),us=BigInt(1);function gc(t,e){let r=e.negate();return t?r:e}function _h(t,e){let r=kw(t.Fp,e.map(n=>n.Z));return e.map((n,s)=>t.fromAffine(n.toAffine(r[s])))}function qw(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ah(t,e){qw(t,e);let r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,i=ho(t),o=BigInt(t);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function P0(t,e,r){let{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r,a=Number(t&s),c=t>>o;a>n&&(a-=i,c+=us);let u=e*n,l=u+Math.abs(a)-1,h=a===0,f=a<0,d=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:d,offsetF:u}}function J8(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function X8(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}var Th=new WeakMap,jw=new WeakMap;function Ch(t){return jw.get(t)||1}function R0(t){if(t!==Js)throw new Error("invalid wNAF")}var Kh=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let s=e;for(;r>Js;)r&us&&(n=n.add(s)),s=s.double(),r>>=us;return n}precomputeWindow(e,r){let{windows:n,windowSize:s}=Ah(r,this.bits),i=[],o=e,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let u=1;u<s;u++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE,o=Ah(e,this.bits);for(let a=0;a<o.windows;a++){let{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:f,offsetF:d}=P0(n,a,o);n=c,l?i=i.add(gc(f,r[d])):s=s.add(gc(h,r[u]))}return R0(n),{p:s,f:i}}wNAFUnsafe(e,r,n,s=this.ZERO){let i=Ah(e,this.bits);for(let o=0;o<i.windows&&n!==Js;o++){let{nextN:a,offset:c,isZero:u,isNeg:l}=P0(n,o,i);if(n=a,!u){let h=r[c];s=s.add(l?h.negate():h)}}return R0(n),s}getPrecomputes(e,r,n){let s=Th.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(s=n(s)),Th.set(r,s))),s}cached(e,r,n){let s=Ch(e);return this.wNAF(s,this.getPrecomputes(s,e,n),r)}unsafe(e,r,n,s){let i=Ch(e);return i===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),r,s)}createCache(e,r){qw(r,this.bits),jw.set(e,r),Th.delete(e)}hasCache(e){return Ch(e)!==1}};function Z8(t,e,r,n){let s=e,i=t.ZERO,o=t.ZERO;for(;r>Js||n>Js;)r&us&&(i=i.add(s)),n&us&&(o=o.add(s)),s=s.double(),r>>=us,n>>=us;return{p1:i,p2:o}}function Q8(t,e,r,n){J8(r,t),X8(n,e);let s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");let o=t.ZERO,a=Cw(BigInt(s)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let u=ho(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c,f=o;for(let d=h;d>=0;d-=c){l.fill(o);for(let g=0;g<i;g++){let w=n[g],P=Number(w>>BigInt(d)&u);l[P]=l[P].add(r[g])}let p=o;for(let g=l.length-1,w=o;g>0;g--)w=w.add(l[g]),p=p.add(w);if(f=f.add(p),d!==0)for(let g=0;g<c;g++)f=f.double()}return f}function N0(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return W8(e),e}else return Nn(t,{isLE:r})}function eT(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(let a of["p","n","h"]){let c=e[a];if(!(typeof c=="bigint"&&c>Js))throw new Error(`CURVE.${a} must be positive bigint`)}let s=N0(e.p,r.Fp,n),i=N0(e.n,r.Fn,n),o=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(let a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),uw("HashToScalar-");var Zi=BigInt(0),Hs=BigInt(1),ac=BigInt(2);function tT(t){return Tc(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(M({},t))}function rT(t){let e=tT(t),{P:r,type:n,adjustScalarBytes:s,powPminus2:i,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");let c=o||fs,u=a?255:448,l=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),d=a?ac**BigInt(254):ac**BigInt(447),p=a?BigInt(8)*ac**BigInt(251)-Hs:BigInt(4)*ac**BigInt(445)-Hs,g=d+p+Hs,w=E=>Vt(E,r),P=R(h);function R(E){return mf(w(E),l)}function x(E){let v=lt("u coordinate",E,l);return a&&(v[31]&=127),w(pc(v))}function I(E){return pc(s(lt("scalar",E,l)))}function C(E,v){let A=U(x(v),I(E));if(A===Zi)throw new Error("invalid private or public key received");return R(A)}function B(E){return C(E,P)}function k(E,v,A){let y=w(E*(v-A));return v=w(v-y),A=w(A+y),{x_2:v,x_3:A}}function U(E,v){Vh("u",E,Zi,r),Vh("scalar",v,d,g);let A=v,y=E,m=Hs,_=Zi,O=E,S=Hs,T=Zi;for(let L=BigInt(u-1);L>=Zi;L--){let K=A>>L&Hs;T^=K,{x_2:m,x_3:O}=k(T,m,O),{x_2:_,x_3:S}=k(T,_,S),T=K;let H=m+_,z=w(H*H),G=m-_,J=w(G*G),ne=z-J,Y=O+S,se=O-S,_e=w(se*H),Fe=w(Y*G),$e=_e+Fe,bt=_e-Fe;O=w($e*$e),S=w(y*w(bt*bt)),m=w(z*J),_=w(ne*(z+w(f*ne)))}({x_2:m,x_3:O}=k(T,m,O)),{x_2:_,x_3:S}=k(T,_,S);let F=i(_);return w(m*F)}let N={secretKey:l,publicKey:l,seed:l},j=(E=c(l))=>(vr(E,N.seed),E);function b(E){let v=j(E);return{secretKey:v,publicKey:B(v)}}return{keygen:b,getSharedSecret:(E,v)=>C(E,v),getPublicKey:E=>B(E),scalarMult:C,scalarMultBase:B,utils:{randomSecretKey:j,randomPrivateKey:j},GuBytes:P.slice(),lengths:N}}var nT=BigInt(1),B0=BigInt(2),sT=BigInt(3),iT=BigInt(5),oT=BigInt(8),$w=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),aT={p:$w,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:oT,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function cT(t){let e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=$w,o=t*t%i*t%i,a=gr(o,B0,i)*o%i,c=gr(a,nT,i)*t%i,u=gr(c,iT,i)*c%i,l=gr(u,e,i)*u%i,h=gr(l,r,i)*l%i,f=gr(h,n,i)*h%i,d=gr(f,s,i)*f%i,p=gr(d,s,i)*f%i,g=gr(p,e,i)*u%i;return{pow_p_5_8:gr(g,B0,i)*t%i,b2:o}}function uT(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}var lT=Nn(aT.p,{isLE:!0}),Wh=(()=>{let t=lT.ORDER;return rT({P:t,type:"x25519",powPminus2:e=>{let{pow_p_5_8:r,b2:n}=cT(e);return Vt(gr(r,sT,t)*n,t)},adjustScalarBytes:uT})})(),U0=(t,e)=>(t+(t>=0?e:-e)/zw)/e;function hT(t,e,r){let[[n,s],[i,o]]=e,a=U0(o*t,r),c=U0(-s*t,r),u=t-a*n-c*i,l=-a*s-c*o,h=u<Zr,f=l<Zr;h&&(u=-u),f&&(l=-l);let d=ho(Math.ceil(Cw(r)/2))+Ws;if(u<Zr||u>=d||l<Zr||l>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}function Gh(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Dh(t,e){let r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return dc(r.lowS,"lowS"),dc(r.prehash,"prehash"),r.format!==void 0&&Gh(r.format),r}var Yh=class extends Error{constructor(e=""){super(e)}},Xr={Err:Yh,_tlv:{encode:(t,e)=>{let{Err:r}=Xr;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");let n=e.length/2,s=oc(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");let i=n>127?oc(s.length/2|128):"";return oc(t)+i+s+e},decode(t,e){let{Err:r}=Xr,n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");let s=e[n++],i=!!(s&128),o=0;if(!i)o=s;else{let c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");let u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}let a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){let{Err:e}=Xr;if(t<Zr)throw new e("integer: negative integers are not allowed");let r=oc(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){let{Err:e}=Xr;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Ac(t)}},toSig(t){let{Err:e,_int:r,_tlv:n}=Xr,s=lt("signature",t),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,i),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){let{_tlv:e,_int:r}=Xr,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),i=n+s;return e.encode(48,i)}},Zr=BigInt(0),Ws=BigInt(1),zw=BigInt(2),cc=BigInt(3),fT=BigInt(4);function Vs(t,e){let{BYTES:r}=t,n;if(typeof e=="bigint")n=e;else{let s=lt("private key",e);try{n=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function dT(t,e={}){let r=eT("weierstrass",t,e),{Fp:n,Fn:s}=r,i=r.CURVE,{h:o,n:a}=i;Tc(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let u=Vw(n,s);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(E,v,A){let{x:y,y:m}=v.toAffine(),_=n.toBytes(y);if(dc(A,"isCompressed"),A){l();let O=!n.isOdd(m);return Cn(Hw(O),_)}else return Cn(Uint8Array.of(4),_,n.toBytes(m))}function f(E){as(E,void 0,"Point");let{publicKey:v,publicKeyUncompressed:A}=u,y=E.length,m=E[0],_=E.subarray(1);if(y===v&&(m===2||m===3)){let O=n.fromBytes(_);if(!n.isValid(O))throw new Error("bad point: is not on curve, wrong x");let S=g(O),T;try{T=n.sqrt(S)}catch(L){let K=L instanceof Error?": "+L.message:"";throw new Error("bad point: is not on curve, sqrt error"+K)}l();let F=n.isOdd(T);return(m&1)===1!==F&&(T=n.neg(T)),{x:O,y:T}}else if(y===A&&m===4){let O=n.BYTES,S=n.fromBytes(_.subarray(0,O)),T=n.fromBytes(_.subarray(O,O*2));if(!w(S,T))throw new Error("bad point: is not on curve");return{x:S,y:T}}else throw new Error(`bad point: got length ${y}, expected compressed=${v} or uncompressed=${A}`)}let d=e.toBytes||h,p=e.fromBytes||f;function g(E){let v=n.sqr(E),A=n.mul(v,E);return n.add(n.add(A,n.mul(E,i.a)),i.b)}function w(E,v){let A=n.sqr(v),y=g(E);return n.eql(A,y)}if(!w(i.Gx,i.Gy))throw new Error("bad curve params: generator point");let P=n.mul(n.pow(i.a,cc),fT),R=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(P,R)))throw new Error("bad curve params: a or b");function x(E,v,A=!1){if(!n.isValid(v)||A&&n.is0(v))throw new Error(`bad point coordinate ${E}`);return v}function I(E){if(!(E instanceof N))throw new Error("ProjectivePoint expected")}function C(E){if(!c||!c.basises)throw new Error("no endo");return hT(E,c.basises,s.ORDER)}let B=C0((E,v)=>{let{X:A,Y:y,Z:m}=E;if(n.eql(m,n.ONE))return{x:A,y};let _=E.is0();v==null&&(v=_?n.ONE:n.inv(m));let O=n.mul(A,v),S=n.mul(y,v),T=n.mul(m,v);if(_)return{x:n.ZERO,y:n.ZERO};if(!n.eql(T,n.ONE))throw new Error("invZ was invalid");return{x:O,y:S}}),k=C0(E=>{if(E.is0()){if(e.allowInfinityPoint&&!n.is0(E.Y))return;throw new Error("bad point: ZERO")}let{x:v,y:A}=E.toAffine();if(!n.isValid(v)||!n.isValid(A))throw new Error("bad point: x or y not field elements");if(!w(v,A))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(E,v,A,y,m){return A=new N(n.mul(A.X,E),A.Y,A.Z),v=gc(y,v),A=gc(m,A),v.add(A)}class N{constructor(v,A,y){this.X=x("x",v),this.Y=x("y",A,!0),this.Z=x("z",y),Object.freeze(this)}static CURVE(){return i}static fromAffine(v){let{x:A,y}=v||{};if(!v||!n.isValid(A)||!n.isValid(y))throw new Error("invalid affine point");if(v instanceof N)throw new Error("projective point not allowed");return n.is0(A)&&n.is0(y)?N.ZERO:new N(A,y,n.ONE)}static fromBytes(v){let A=N.fromAffine(p(as(v,void 0,"point")));return A.assertValidity(),A}static fromHex(v){return N.fromBytes(lt("pointHex",v))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(v=8,A=!0){return b.createCache(this,v),A||this.multiply(cc),this}assertValidity(){k(this)}hasEvenY(){let{y:v}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(v)}equals(v){I(v);let{X:A,Y:y,Z:m}=this,{X:_,Y:O,Z:S}=v,T=n.eql(n.mul(A,S),n.mul(_,m)),F=n.eql(n.mul(y,S),n.mul(O,m));return T&&F}negate(){return new N(this.X,n.neg(this.Y),this.Z)}double(){let{a:v,b:A}=i,y=n.mul(A,cc),{X:m,Y:_,Z:O}=this,S=n.ZERO,T=n.ZERO,F=n.ZERO,L=n.mul(m,m),K=n.mul(_,_),H=n.mul(O,O),z=n.mul(m,_);return z=n.add(z,z),F=n.mul(m,O),F=n.add(F,F),S=n.mul(v,F),T=n.mul(y,H),T=n.add(S,T),S=n.sub(K,T),T=n.add(K,T),T=n.mul(S,T),S=n.mul(z,S),F=n.mul(y,F),H=n.mul(v,H),z=n.sub(L,H),z=n.mul(v,z),z=n.add(z,F),F=n.add(L,L),L=n.add(F,L),L=n.add(L,H),L=n.mul(L,z),T=n.add(T,L),H=n.mul(_,O),H=n.add(H,H),L=n.mul(H,z),S=n.sub(S,L),F=n.mul(H,K),F=n.add(F,F),F=n.add(F,F),new N(S,T,F)}add(v){I(v);let{X:A,Y:y,Z:m}=this,{X:_,Y:O,Z:S}=v,T=n.ZERO,F=n.ZERO,L=n.ZERO,K=i.a,H=n.mul(i.b,cc),z=n.mul(A,_),G=n.mul(y,O),J=n.mul(m,S),ne=n.add(A,y),Y=n.add(_,O);ne=n.mul(ne,Y),Y=n.add(z,G),ne=n.sub(ne,Y),Y=n.add(A,m);let se=n.add(_,S);return Y=n.mul(Y,se),se=n.add(z,J),Y=n.sub(Y,se),se=n.add(y,m),T=n.add(O,S),se=n.mul(se,T),T=n.add(G,J),se=n.sub(se,T),L=n.mul(K,Y),T=n.mul(H,J),L=n.add(T,L),T=n.sub(G,L),L=n.add(G,L),F=n.mul(T,L),G=n.add(z,z),G=n.add(G,z),J=n.mul(K,J),Y=n.mul(H,Y),G=n.add(G,J),J=n.sub(z,J),J=n.mul(K,J),Y=n.add(Y,J),z=n.mul(G,Y),F=n.add(F,z),z=n.mul(se,Y),T=n.mul(ne,T),T=n.sub(T,z),z=n.mul(ne,G),L=n.mul(se,L),L=n.add(L,z),new N(T,F,L)}subtract(v){return this.add(v.negate())}is0(){return this.equals(N.ZERO)}multiply(v){let{endo:A}=e;if(!s.isValidNot0(v))throw new Error("invalid scalar: out of range");let y,m,_=O=>b.cached(this,O,S=>_h(N,S));if(A){let{k1neg:O,k1:S,k2neg:T,k2:F}=C(v),{p:L,f:K}=_(S),{p:H,f:z}=_(F);m=K.add(z),y=U(A.beta,L,H,O,T)}else{let{p:O,f:S}=_(v);y=O,m=S}return _h(N,[y,m])[0]}multiplyUnsafe(v){let{endo:A}=e,y=this;if(!s.isValid(v))throw new Error("invalid scalar: out of range");if(v===Zr||y.is0())return N.ZERO;if(v===Ws)return y;if(b.hasCache(this))return this.multiply(v);if(A){let{k1neg:m,k1:_,k2neg:O,k2:S}=C(v),{p1:T,p2:F}=Z8(N,y,_,S);return U(A.beta,T,F,m,O)}else return b.unsafe(y,v)}multiplyAndAddUnsafe(v,A,y){let m=this.multiplyUnsafe(A).add(v.multiplyUnsafe(y));return m.is0()?void 0:m}toAffine(v){return B(this,v)}isTorsionFree(){let{isTorsionFree:v}=e;return o===Ws?!0:v?v(N,this):b.unsafe(this,a).is0()}clearCofactor(){let{clearCofactor:v}=e;return o===Ws?this:v?v(N,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(v=!0){return dc(v,"isCompressed"),this.assertValidity(),d(N,this,v)}toHex(v=!0){return Ks(this.toBytes(v))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(v=!0){return this.toBytes(v)}_setWindowSize(v){this.precompute(v)}static normalizeZ(v){return _h(N,v)}static msm(v,A){return Q8(N,s,v,A)}static fromPrivateKey(v){return N.BASE.multiply(Vs(s,v))}}N.BASE=new N(i.Gx,i.Gy,n.ONE),N.ZERO=new N(n.ZERO,n.ONE,n.ZERO),N.Fp=n,N.Fn=s;let j=s.BITS,b=new Kh(N,e.endo?Math.ceil(j/2):j);return N.BASE.precompute(8),N}function Hw(t){return Uint8Array.of(t?2:3)}function Vw(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function pT(t,e={}){let{Fn:r}=t,n=e.randomBytes||fs,s=Object.assign(Vw(t.Fp,r),{seed:Mw(r.ORDER)});function i(f){try{return!!Vs(r,f)}catch{return!1}}function o(f,d){let{publicKey:p,publicKeyUncompressed:g}=s;try{let w=f.length;return d===!0&&w!==p||d===!1&&w!==g?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=n(s.seed)){return Y8(as(f,s.seed,"seed"),r.ORDER)}function c(f,d=!0){return t.BASE.multiply(Vs(r,f)).toBytes(d)}function u(f){let d=a(f);return{secretKey:d,publicKey:c(d)}}function l(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;let{secretKey:d,publicKey:p,publicKeyUncompressed:g}=s;if(r.allowedLengths||d===p)return;let w=lt("key",f).length;return w===p||w===g}function h(f,d,p=!0){if(l(f)===!0)throw new Error("first arg must be private key");if(l(d)===!1)throw new Error("second arg must be public key");let g=Vs(r,f);return t.fromHex(d).multiply(g).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:u,Point:t,utils:{isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:i,randomPrivateKey:a,normPrivateKeyToScalar:f=>Vs(r,f),precompute(f=8,d=t.BASE){return d.precompute(f,!1)}},lengths:s})}function gT(t,e,r={}){Ec(e),Tc(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let n=r.randomBytes||fs,s=r.hmac||((A,...y)=>Ic(e,A,Cn(...y))),{Fp:i,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:d}=pT(t,r),p={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function w(A){let y=a>>Ws;return A>y}function P(A,y){if(!o.isValidNot0(y))throw new Error(`invalid signature ${A}: out of range 1..Point.Fn.ORDER`);return y}function R(A,y){Gh(y);let m=d.signature,_=y==="compact"?m:y==="recovered"?m+1:void 0;return as(A,_,`${y} signature`)}class x{constructor(y,m,_){this.r=P("r",y),this.s=P("s",m),_!=null&&(this.recovery=_),Object.freeze(this)}static fromBytes(y,m=g){R(y,m);let _;if(m==="der"){let{r:F,s:L}=Xr.toSig(as(y));return new x(F,L)}m==="recovered"&&(_=y[0],m="compact",y=y.subarray(1));let O=o.BYTES,S=y.subarray(0,O),T=y.subarray(O,O*2);return new x(o.fromBytes(S),o.fromBytes(T),_)}static fromHex(y,m){return this.fromBytes(lc(y),m)}addRecoveryBit(y){return new x(this.r,this.s,y)}recoverPublicKey(y){let m=i.ORDER,{r:_,s:O,recovery:S}=this;if(S==null||![0,1,2,3].includes(S))throw new Error("recovery id invalid");if(a*zw<m&&S>1)throw new Error("recovery id is ambiguous for h>1 curve");let T=S===2||S===3?_+a:_;if(!i.isValid(T))throw new Error("recovery id 2 or 3 invalid");let F=i.toBytes(T),L=t.fromBytes(Cn(Hw((S&1)===0),F)),K=o.inv(T),H=C(lt("msgHash",y)),z=o.create(-H*K),G=o.create(O*K),J=t.BASE.multiplyUnsafe(z).add(L.multiplyUnsafe(G));if(J.is0())throw new Error("point at infinify");return J.assertValidity(),J}hasHighS(){return w(this.s)}toBytes(y=g){if(Gh(y),y==="der")return lc(Xr.hexFromSig(this));let m=o.toBytes(this.r),_=o.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Cn(Uint8Array.of(this.recovery),m,_)}return Cn(m,_)}toHex(y){return Ks(this.toBytes(y))}assertValidity(){}static fromCompact(y){return x.fromBytes(lt("sig",y),"compact")}static fromDER(y){return x.fromBytes(lt("sig",y),"der")}normalizeS(){return this.hasHighS()?new x(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Ks(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Ks(this.toBytes("compact"))}}let I=r.bits2int||function(A){if(A.length>8192)throw new Error("input is too large");let y=Ac(A),m=A.length*8-c;return m>0?y>>BigInt(m):y},C=r.bits2int_modN||function(A){return o.create(I(A))},B=ho(c);function k(A){return Vh("num < 2^"+c,A,Zr,B),o.toBytes(A)}function U(A,y){return as(A,void 0,"message"),y?as(e(A),void 0,"prehashed message"):A}function N(A,y,m){if(["recovered","canonical"].some(G=>G in m))throw new Error("sign() legacy options not supported");let{lowS:_,prehash:O,extraEntropy:S}=Dh(m,p);A=U(A,O);let T=C(A),F=Vs(o,y),L=[k(F),k(T)];if(S!=null&&S!==!1){let G=S===!0?n(d.secretKey):S;L.push(lt("extraEntropy",G))}let K=Cn(...L),H=T;function z(G){let J=I(G);if(!o.isValidNot0(J))return;let ne=o.inv(J),Y=t.BASE.multiply(J).toAffine(),se=o.create(Y.x);if(se===Zr)return;let _e=o.create(ne*o.create(H+se*F));if(_e===Zr)return;let Fe=(Y.x===se?0:2)|Number(Y.y&Ws),$e=_e;return _&&w(_e)&&($e=o.neg(_e),Fe^=1),new x(se,$e,Fe)}return{seed:K,k2sig:z}}function j(A,y,m={}){A=lt("message",A);let{seed:_,k2sig:O}=N(A,y,m);return q8(e.outputLen,o.BYTES,s)(_,O)}function b(A){let y,m=typeof A=="string"||vc(A),_=!m&&A!==null&&typeof A=="object"&&typeof A.r=="bigint"&&typeof A.s=="bigint";if(!m&&!_)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(_)y=new x(A.r,A.s);else if(m){try{y=x.fromBytes(lt("sig",A),"der")}catch(O){if(!(O instanceof Xr.Err))throw O}if(!y)try{y=x.fromBytes(lt("sig",A),"compact")}catch{return!1}}return y||!1}function E(A,y,m,_={}){let{lowS:O,prehash:S,format:T}=Dh(_,p);if(m=lt("publicKey",m),y=U(lt("message",y),S),"strict"in _)throw new Error("options.strict was renamed to lowS");let F=T===void 0?b(A):x.fromBytes(lt("sig",A),T);if(F===!1)return!1;try{let L=t.fromBytes(m);if(O&&F.hasHighS())return!1;let{r:K,s:H}=F,z=C(y),G=o.inv(H),J=o.create(z*G),ne=o.create(K*G),Y=t.BASE.multiplyUnsafe(J).add(L.multiplyUnsafe(ne));return Y.is0()?!1:o.create(Y.x)===K}catch{return!1}}function v(A,y,m={}){let{prehash:_}=Dh(m,p);return y=U(y,_),x.fromBytes(A,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:d,Point:t,sign:j,verify:E,recoverPublicKey:v,Signature:x,hash:e})}function mT(t){let e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0,s=Nn(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),i={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function yT(t){let{CURVE:e,curveOpts:r}=mT(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function wT(t,e){let r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,Fw(r.Fn.ORDER,r.Fn.BITS))})}function bT(t){let{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:s}=yT(t),i=dT(e,r),o=gT(i,n,s);return wT(t,o)}function Jh(t,e){let r=n=>bT(pe(M({},t),{hash:n}));return pe(M({},r(e)),{create:r})}var Kw={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Ww={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Gw={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},vT=Nn(Kw.p),ET=Nn(Ww.p),xT=Nn(Gw.p),ST=Jh(pe(M({},Kw),{Fp:vT,lowS:!1}),xc);Jh(pe(M({},Ww),{Fp:ET,lowS:!1}),q3),Jh(pe(M({},Gw),{Fp:xT,lowS:!1,allowedPrivateKeyLengths:[130,131,132]}),M3);var IT=ST,Yw="base10",ht="base16",ft="base64pad",nn="base64url",fo="utf8",Jw=0,Sr=1,Xs=2,_T=0,k0=1,to=12,wf=32;function Xw(){let t=Wh.utils.randomPrivateKey(),e=Wh.getPublicKey(t);return{privateKey:Xe(t,ht),publicKey:Xe(e,ht)}}function Cc(){let t=fs(wf);return Xe(t,ht)}function Zw(t,e){let r=Wh.getSharedSecret(Nt(t,ht),Nt(e,ht)),n=L8(_c,r,void 0,void 0,wf);return Xe(n,ht)}function Zs(t){let e=_c(Nt(t,ht));return Xe(e,ht)}function Ft(t){let e=_c(Nt(t,fo));return Xe(e,ht)}function Qw(t){return Nt(`${t}`,Yw)}function Pn(t){return Number(Xe(t,Yw))}function eb(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function tb(t){let e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function rb(t){let e=Qw(typeof t.type<"u"?t.type:Jw);if(Pn(e)===Sr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");let r=typeof t.senderPublicKey<"u"?Nt(t.senderPublicKey,ht):void 0,n=typeof t.iv<"u"?Nt(t.iv,ht):fs(to),s=Nt(t.symKey,ht),i=Aw(s,n).encrypt(Nt(t.message,fo)),o=ob({type:e,sealed:i,iv:n,senderPublicKey:r});return t.encoding===nn?eb(o):o}function nb(t){let e=Nt(t.symKey,ht),{sealed:r,iv:n}=Qs({encoded:t.encoded,encoding:t.encoding}),s=Aw(e,n).decrypt(r);if(s===null)throw new Error("Failed to decrypt");return Xe(s,fo)}function sb(t,e){let r=Qw(Xs),n=fs(to),s=Nt(t,fo),i=ob({type:r,sealed:s,iv:n});return e===nn?eb(i):i}function ib(t,e){let{sealed:r}=Qs({encoded:t,encoding:e});return Xe(r,fo)}function ob(t){if(Pn(t.type)===Xs)return Xe(ss([t.type,t.sealed]),ft);if(Pn(t.type)===Sr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Xe(ss([t.type,t.senderPublicKey,t.iv,t.sealed]),ft)}return Xe(ss([t.type,t.iv,t.sealed]),ft)}function Qs(t){let e=(t.encoding||ft)===nn?tb(t.encoded):t.encoded,r=Nt(e,ft),n=r.slice(_T,k0),s=k0;if(Pn(n)===Sr){let c=s+wf,u=c+to,l=r.slice(s,c),h=r.slice(c,u),f=r.slice(u);return{type:n,sealed:f,iv:h,senderPublicKey:l}}if(Pn(n)===Xs){let c=r.slice(s),u=fs(to);return{type:n,sealed:c,iv:u}}let i=s+to,o=r.slice(s,i),a=r.slice(i);return{type:n,sealed:a,iv:o}}function ab(t,e){let r=Qs({encoded:t,encoding:e?.encoding});return bf({type:Pn(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Xe(r.senderPublicKey,ht):void 0,receiverPublicKey:e?.receiverPublicKey})}function bf(t){let e=t?.type||Jw;if(e===Sr){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function vf(t){return t.type===Sr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Ef(t){return t.type===Xs}function AT(t){let e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return ss([new Uint8Array([4]),e,r])}function cb(t,e){let[r,n,s]=t.split("."),i=Buffer.from(tb(s),"base64");if(i.length!==64)throw new Error("Invalid signature length");let o=i.slice(0,32),a=i.slice(32,64),c=`${r}.${n}`,u=_c(c),l=AT(e);if(!IT.verify(ss([o,a]),u,l))throw new Error("Invalid signature");return Oi(t).payload}var TT="irn";function po(t){return t?.relay||{protocol:TT}}function ds(t){let e=zy[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var CT=Object.defineProperty,DT=Object.defineProperties,OT=Object.getOwnPropertyDescriptors,F0=Object.getOwnPropertySymbols,PT=Object.prototype.hasOwnProperty,RT=Object.prototype.propertyIsEnumerable,L0=(t,e,r)=>e in t?CT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Oh=(t,e)=>{for(var r in e||(e={}))PT.call(e,r)&&L0(t,r,e[r]);if(F0)for(var r of F0(e))RT.call(e,r)&&L0(t,r,e[r]);return t},NT=(t,e)=>DT(t,OT(e));function BT(t,e="-"){let r={},n="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(n)){let i=s.replace(n,""),o=t[s];r[i]=o}}),r}function xf(t){if(!t.includes("wc:")){let u=rw(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;let e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),s=t.substring(e+1,r).split("@"),i=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(i),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:UT(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:BT(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function UT(t){return t.startsWith("//")?t.substring(2):t}function kT(t,e="-"){let r="relay",n={};return Object.keys(t).forEach(s=>{let i=s,o=r+e+i;t[i]&&(n[o]=t[i])}),n}function Sf(t){let e=new URLSearchParams,r=Oh(Oh(NT(Oh({},kT(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!==void 0&&e.append(n,String(s))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function go(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var FT=Object.defineProperty,LT=Object.defineProperties,MT=Object.getOwnPropertyDescriptors,M0=Object.getOwnPropertySymbols,qT=Object.prototype.hasOwnProperty,jT=Object.prototype.propertyIsEnumerable,q0=(t,e,r)=>e in t?FT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$T=(t,e)=>{for(var r in e||(e={}))qT.call(e,r)&&q0(t,r,e[r]);if(M0)for(var r of M0(e))jT.call(e,r)&&q0(t,r,e[r]);return t},zT=(t,e)=>LT(t,MT(e));function ei(t){let e=[];return t.forEach(r=>{let[n,s]=r.split(":");e.push(`${n}:${s}`)}),e}function HT(t){let e=[];return Object.values(t).forEach(r=>{e.push(...ei(r.accounts))}),e}function VT(t,e){let r=[];return Object.values(t).forEach(n=>{ei(n.accounts).includes(e)&&r.push(...n.methods)}),r}function KT(t,e){let r=[];return Object.values(t).forEach(n=>{ei(n.accounts).includes(e)&&r.push(...n.events)}),r}function mo(t){return t.includes(":")}function ps(t){return mo(t)?t.split(":")[0]:t}function j0(t){var e,r,n;let s={};if(!rr(t))return s;for(let[i,o]of Object.entries(t)){let a=mo(i)?[i]:o.chains,c=o.methods||[],u=o.events||[],l=ps(i);s[l]=zT($T({},s[l]),{chains:yr(a,(e=s[l])==null?void 0:e.chains),methods:yr(c,(r=s[l])==null?void 0:r.methods),events:yr(u,(n=s[l])==null?void 0:n.events)})}return s}function WT(t){let e={};return t?.forEach(r=>{var n;let[s,i]=r.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(r),(n=e[s].chains)==null||n.push(`${s}:${i}`)}),e}function If(t,e){e=e.map(n=>n.replace("did:pkh:",""));let r=WT(e);for(let[n,s]of Object.entries(r))s.methods?s.methods=yr(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return r}function ub(t,e){var r,n,s,i,o,a;let c=j0(t),u=j0(e),l={},h=Object.keys(c).concat(Object.keys(u));for(let f of h)l[f]={chains:yr((r=c[f])==null?void 0:r.chains,(n=u[f])==null?void 0:n.chains),methods:yr((s=c[f])==null?void 0:s.methods,(i=u[f])==null?void 0:i.methods),events:yr((o=c[f])==null?void 0:o.events,(a=u[f])==null?void 0:a.events)};return l}var GT={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},YT={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function $(t,e){let{message:r,code:n}=YT[t];return{message:e?`${r} ${e}`:r,code:n}}function we(t,e){let{message:r,code:n}=GT[t];return{message:e?`${r} ${e}`:r,code:n}}function Ir(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function rr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ne(t){return typeof t>"u"}function Oe(t,e){return e&&Ne(t)?!0:typeof t=="string"&&!!t.trim().length}function _f(t,e){return e&&Ne(t)?!0:typeof t=="number"&&!isNaN(t)}function lb(t,e){let{requiredNamespaces:r}=e,n=Object.keys(t.namespaces),s=Object.keys(r),i=!0;return os(s,n)?(n.forEach(o=>{let{accounts:a,methods:c,events:u}=t.namespaces[o],l=ei(a),h=r[o];(!os(K0(o,h),l)||!os(h.methods,c)||!os(h.events,u))&&(i=!1)}),i):!1}function mc(t){return Oe(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function JT(t){if(Oe(t,!1)&&t.includes(":")){let e=t.split(":");if(e.length===3){let r=e[0]+":"+e[1];return!!e[2]&&mc(r)}}return!1}function hb(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(Oe(t,!1)){if(e(t))return!0;let r=rw(t);return e(r)}}catch{}return!1}function fb(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function db(t){return t?.topic}function pb(t,e){let r=null;return Oe(t?.publicKey,!1)||(r=$("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function $0(t){let e=!0;return Ir(t)?t.length&&(e=t.every(r=>Oe(r,!1))):e=!1,e}function XT(t,e,r){let n=null;return Ir(e)&&e.length?e.forEach(s=>{n||mc(s)||(n=we("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):mc(t)||(n=we("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function ZT(t,e,r){let n=null;return Object.entries(t).forEach(([s,i])=>{if(n)return;let o=XT(s,K0(s,i),`${e} ${r}`);o&&(n=o)}),n}function QT(t,e){let r=null;return Ir(t)?t.forEach(n=>{r||JT(n)||(r=we("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=we("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function eC(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;let s=QT(n?.accounts,`${e} namespace`);s&&(r=s)}),r}function tC(t,e){let r=null;return $0(t?.methods)?$0(t?.events)||(r=we("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=we("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function gb(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;let s=tC(n,`${e}, namespace`);s&&(r=s)}),r}function mb(t,e,r){let n=null;if(t&&rr(t)){let s=gb(t,e);s&&(n=s);let i=ZT(t,e,r);i&&(n=i)}else n=$("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return n}function Dc(t,e){let r=null;if(t&&rr(t)){let n=gb(t,e);n&&(r=n);let s=eC(t,e);s&&(r=s)}else r=$("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Af(t){return Oe(t.protocol,!0)}function yb(t,e){let r=!1;return e&&!t?r=!0:t&&Ir(t)&&t.length&&t.forEach(n=>{r=Af(n)}),r}function wb(t){return typeof t=="number"}function dt(t){return typeof t<"u"&&typeof t!==null}function bb(t){return!(!t||typeof t!="object"||!t.code||!_f(t.code,!1)||!t.message||!Oe(t.message,!1))}function vb(t){return!(Ne(t)||!Oe(t.method,!1))}function Eb(t){return!(Ne(t)||Ne(t.result)&&Ne(t.error)||!_f(t.id,!1)||!Oe(t.jsonrpc,!1))}function xb(t){return!(Ne(t)||!Oe(t.name,!1))}function Tf(t,e){return!(!mc(e)||!HT(t).includes(e))}function Sb(t,e,r){return Oe(r,!1)?VT(t,e).includes(r):!1}function Ib(t,e,r){return Oe(r,!1)?KT(t,e).includes(r):!1}function Cf(t,e,r){let n=null,s=rC(t),i=nC(e),o=Object.keys(s),a=Object.keys(i),c=z0(Object.keys(t)),u=z0(Object.keys(e)),l=c.filter(h=>!u.includes(h));return l.length&&(n=$("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),os(o,a)||(n=$("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||n)return;let f=ei(e[h].accounts);f.includes(h)||(n=$("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{n||(os(s[h].methods,i[h].methods)?os(s[h].events,i[h].events)||(n=$("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):n=$("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),n}function rC(t){let e={};return Object.keys(t).forEach(r=>{var n;r.includes(":")?e[r]=t[r]:(n=t[r].chains)==null||n.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function z0(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function nC(t){let e={};return Object.keys(t).forEach(r=>{r.includes(":")?e[r]=t[r]:ei(t[r].accounts)?.forEach(s=>{e[s]={accounts:t[r].accounts.filter(i=>i.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}),e}function _b(t,e){return _f(t,!1)&&t<=e.max&&t>=e.min}function Df(){let t=oo();return new Promise(e=>{switch(t){case Ut.browser:e(sC());break;case Ut.reactNative:e(iC());break;case Ut.node:e(oC());break;default:e(!0)}})}function sC(){return hs()&&navigator?.onLine}async function iC(){return tn()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function oC(){return!0}function Ab(t){switch(oo()){case Ut.browser:aC(t);break;case Ut.reactNative:cC(t);break;case Ut.node:break}}function aC(t){!tn()&&hs()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function cC(t){tn()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function Tb(){var t;return hs()&&(0,br.getDocument)()?((t=(0,br.getDocument)())==null?void 0:t.visibilityState)==="visible":!0}var Ph={},Rn=class{static get(e){return Ph[e]}static set(e,r){Ph[e]=r}static delete(e){delete Ph[e]}};function uC(t){let e=Fs.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function lC({publicKey:t,signature:e,payload:r}){var n;let s=Xh(r.method),i=128|parseInt(((n=r.version)==null?void 0:n.toString())||"4"),o=dC(r.address),a=r.era==="00"?new Uint8Array([0]):Xh(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");let c=parseInt(r.nonce,16),u=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${fC(r.tip)}`),h=gC(l),f=new Uint8Array([0,...t,o,...e,...a,...u,...h,...s]),d=pC(f.length+1);return new Uint8Array([...d,i,...f])}function hC(t){let e=Xh(t),r=(0,V0.blake2b)(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function Xh(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function fC(t){return t.startsWith("0x")?t.slice(2):t}function dC(t){let e=Fs.decode(t)[0];return e===42?0:e===60?2:1}function pC(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){let e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){let e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function gC(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){let e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){let e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function Cb(t){let e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=uC(t.transaction.address),n=lC({publicKey:r,signature:e,payload:t.transaction}),s=Buffer.from(n).toString("hex");return hC(s)}function ti({logger:t,name:e}){let r=typeof t=="string"?Ro({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}var Wb=Be(qr());var We={};ze(We,{DEFAULT_ERROR:()=>wo,IBaseJsonRpcProvider:()=>Lc,IEvents:()=>Eo,IJsonRpcConnection:()=>kf,IJsonRpcProvider:()=>xo,INTERNAL_ERROR:()=>Oc,INVALID_PARAMS:()=>Rb,INVALID_REQUEST:()=>Ob,METHOD_NOT_FOUND:()=>Pb,PARSE_ERROR:()=>Db,RESERVED_ERROR_CODES:()=>Of,SERVER_ERROR:()=>yo,SERVER_ERROR_CODE_RANGE:()=>Pc,STANDARD_ERROR_MAP:()=>Bn,formatErrorMessage:()=>Vb,formatJsonRpcError:()=>on,formatJsonRpcRequest:()=>pt,formatJsonRpcResult:()=>sn,getBigIntRpcId:()=>sr,getError:()=>Nc,getErrorByCode:()=>Bc,isHttpUrl:()=>Mc,isJsonRpcError:()=>gt,isJsonRpcPayload:()=>Lf,isJsonRpcRequest:()=>ri,isJsonRpcResponse:()=>Fn,isJsonRpcResult:()=>Wt,isJsonRpcValidationInvalid:()=>VC,isLocalhostUrl:()=>Ff,isNodeJs:()=>Hb,isReservedErrorCode:()=>Rc,isServerErrorCode:()=>mC,isValidDefaultRoute:()=>kc,isValidErrorCode:()=>Nb,isValidLeadingWildcardRoute:()=>qC,isValidRoute:()=>MC,isValidTrailingWildcardRoute:()=>jC,isValidWildcardRoute:()=>Fc,isWsUrl:()=>qc,parseConnectionError:()=>bo,payloadId:()=>nr,validateJsonRpcError:()=>yC});var Db="PARSE_ERROR",Ob="INVALID_REQUEST",Pb="METHOD_NOT_FOUND",Rb="INVALID_PARAMS",Oc="INTERNAL_ERROR",yo="SERVER_ERROR",Of=[-32700,-32600,-32601,-32602,-32603],Pc=[-32e3,-32099],Bn={[Db]:{code:-32700,message:"Parse error"},[Ob]:{code:-32600,message:"Invalid Request"},[Pb]:{code:-32601,message:"Method not found"},[Rb]:{code:-32602,message:"Invalid params"},[Oc]:{code:-32603,message:"Internal error"},[yo]:{code:-32e3,message:"Server error"}},wo=yo;function mC(t){return t<=Pc[0]&&t>=Pc[1]}function Rc(t){return Of.includes(t)}function Nb(t){return typeof t=="number"}function Nc(t){return Object.keys(Bn).includes(t)?Bn[t]:Bn[wo]}function Bc(t){let e=Object.values(Bn).find(r=>r.code===t);return e||Bn[wo]}function yC(t){if(typeof t.error.code>"u")return{valid:!1,error:"Missing code for JSON-RPC error"};if(typeof t.error.message>"u")return{valid:!1,error:"Missing message for JSON-RPC error"};if(!Nb(t.error.code))return{valid:!1,error:`Invalid error code type for JSON-RPC: ${t.error.code}`};if(Rc(t.error.code)){let e=Bc(t.error.code);if(e.message!==Bn[wo].message&&t.error.message===e.message)return{valid:!1,error:`Invalid error code message for JSON-RPC: ${t.error.code}`}}return{valid:!0}}function bo(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var _t={};ze(_t,{isNodeJs:()=>Hb});var zb=Be(Uf());Mt(_t,Be(Uf()));var Hb=zb.isNode;Mt(We,_t);function nr(t=3){let e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function sr(t=6){return BigInt(nr(t))}function pt(t,e,r){return{id:r||nr(),jsonrpc:"2.0",method:t,params:e}}function sn(t,e){return{id:t,jsonrpc:"2.0",result:e}}function on(t,e,r){return{id:t,jsonrpc:"2.0",error:Vb(e,r)}}function Vb(t,e){return typeof t>"u"?Nc(Oc):(typeof t=="string"&&(t=Object.assign(Object.assign({},Nc(yo)),{message:t})),typeof e<"u"&&(t.data=e),Rc(t.code)&&(t=Bc(t.code)),t)}function MC(t){return t.includes("*")?Fc(t):!/\W/g.test(t)}function kc(t){return t==="*"}function Fc(t){return kc(t)?!0:!(!t.includes("*")||t.split("*").length!==2||t.split("*").filter(e=>e.trim()==="").length!==1)}function qC(t){return!kc(t)&&Fc(t)&&!t.split("*")[0].trim()}function jC(t){return!kc(t)&&Fc(t)&&!t.split("*")[1].trim()}var Eo=class{},kf=class extends Eo{constructor(e){super()}},Lc=class extends Eo{constructor(){super()}},xo=class extends Lc{constructor(e){super()}};var $C="^https?:",zC="^wss?:";function HC(t){let e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Kb(t,e){let r=HC(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Mc(t){return Kb(t,$C)}function qc(t){return Kb(t,zC)}function Ff(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Lf(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function ri(t){return Lf(t)&&"method"in t}function Fn(t){return Lf(t)&&(Wt(t)||gt(t))}function Wt(t){return"result"in t}function gt(t){return"error"in t}function VC(t){return"error"in t&&t.valid===!1}var gs=class extends xo{constructor(e){super(e),this.events=new Wb.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(pt(e.method,e.params||[],e.id||sr().toString()),r)}async requestStrict(e,r){return new Promise(async(n,s)=>{if(!this.connection.connected)try{await this.open()}catch(i){s(i)}this.events.on(`${e.id}`,i=>{gt(i)?s(i.error):n(i.result)});try{await this.connection.send(e,r)}catch(i){s(i)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Fn(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};var Zb=Be(qr());var KC=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:Yb(),WC=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Jb=t=>t.split("?")[0],Xb=10,GC=KC(),jc=class{constructor(e){if(this.url=e,this.events=new Zb.EventEmitter,this.registering=!1,!qc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Qt(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!qc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){let r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,s)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),s(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{let s=(0,We.isReactNative)()?void 0:{rejectUnauthorized:!Ff(e)},i=new GC(e,[],s);WC()?i.onerror=o=>{let a=o;n(this.emitError(a.error))}:i.on("error",o=>{n(this.emitError(o))}),i.onopen=()=>{this.onOpen(i),r(i)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;let r=typeof e.data=="string"?Zt(e.data):e.data;this.events.emit("payload",r)}onError(e,r){let n=this.parseError(r),s=n.message||n.toString(),i=on(e,s);this.events.emit("payload",i)}parseError(e,r=this.url){return bo(e,Jb(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Xb&&this.events.setMaxListeners(Xb)}emitError(e){let r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${Jb(this.url)}`));return this.events.emit("register_error",r),r}};var S1=Be(ga(),1);var I1="wc",_1=2,zc="core",Fr=`${I1}@2:${zc}:`,YC={name:zc,logger:"error"},JC={database:":memory:"},XC="crypto",Qb="client_ed25519_seed",ZC=X.ONE_DAY,QC="keychain",eD="0.3",tD="messages",rD="0.3",nD=X.SIX_HOURS,sD="publisher",wd="irn",iD="error",A1="wss://relay.walletconnect.org",oD="relayer",Pe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},aD="_subscription",ir={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},cD=.1;var $f="2.22.3";var xe={link_mode:"link_mode",relay:"relay"},$c={inbound:"inbound",outbound:"outbound"},uD="0.3",lD="WALLETCONNECT_CLIENT_ID",e1="WALLETCONNECT_LINK_MODE_APPS",Yt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"};var hD="subscription",fD="0.3",t9=X.FIVE_SECONDS*1e3,dD="pairing",pD="0.3";var So={wc_pairingDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:X.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:X.ONE_DAY,prompt:!1,tag:0},res:{ttl:X.ONE_DAY,prompt:!1,tag:0}}},Ln={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},_r={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},gD="history",mD="0.3",yD="expirer",Jt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},wD="0.3";var bD="verify-api",vD="https://verify.walletconnect.com",T1="https://verify.walletconnect.org",ii=T1,ED=`${ii}/v3`,xD=[vD,T1],SD="echo",ID="https://echo.walletconnect.com";var Ar={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},kr={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},ar={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Mn={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},qn={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},oi={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},_D=.1,AD="event-client",TD=86400,CD="https://pulse.walletconnect.org/batch";function DD(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,P=0,R=p.length;P!==R&&p[P]===0;)P++,g++;for(var x=(R-P)*l+1>>>0,I=new Uint8Array(x);P!==R;){for(var C=p[P],B=0,k=x-1;(C!==0||B<w)&&k!==-1;k--,B++)C+=256*I[k]>>>0,I[k]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");w=B,P++}for(var U=x-w;U!==x&&I[U]===0;)U++;for(var N=c.repeat(g);U<x;++U)N+=t.charAt(I[U]);return N}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,P=0;p[g]===c;)w++,g++;for(var R=(p.length-g)*u+1>>>0,x=new Uint8Array(R);p[g];){var I=r[p.charCodeAt(g)];if(I===255)return;for(var C=0,B=R-1;(I!==0||C<P)&&B!==-1;B--,C++)I+=a*x[B]>>>0,x[B]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");P=C,g++}if(p[g]!==" "){for(var k=R-P;k!==R&&x[k]===0;)k++;for(var U=new Uint8Array(w+(R-k)),N=w;k!==R;)U[N++]=x[k++];return U}}}function d(p){var g=f(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var OD=DD,PD=OD,C1=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},RD=t=>new TextEncoder().encode(t),ND=t=>new TextDecoder().decode(t),zf=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Hf=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return D1(this,e)}},Vf=class{constructor(e){this.decoders=e}or(e){return D1(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},D1=(t,e)=>new Vf(M(M({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e})),Kf=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new zf(e,r,n),this.decoder=new Hf(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Hc=({name:t,prefix:e,encode:r,decode:n})=>new Kf(t,e,r,n),Co=({prefix:t,name:e,alphabet:r})=>{let{encode:n,decode:s}=PD(r,e);return Hc({prefix:t,name:e,encode:n,decode:i=>C1(s(i))})},BD=(t,e,r,n)=>{let s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*r/8|0),a=0,c=0,u=0;for(let l=0;l<i;++l){let h=s[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},UD=(t,e,r)=>{let n=e[e.length-1]==="=",s=(1<<r)-1,i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},tt=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Hc({prefix:e,name:t,encode(s){return UD(s,n,r)},decode(s){return BD(s,n,r,t)}}),kD=Hc({prefix:"\0",name:"identity",encode:t=>ND(t),decode:t=>RD(t)}),FD=Object.freeze({__proto__:null,identity:kD}),LD=tt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),MD=Object.freeze({__proto__:null,base2:LD}),qD=tt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),jD=Object.freeze({__proto__:null,base8:qD}),$D=Co({prefix:"9",name:"base10",alphabet:"0123456789"}),zD=Object.freeze({__proto__:null,base10:$D}),HD=tt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),VD=tt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),KD=Object.freeze({__proto__:null,base16:HD,base16upper:VD}),WD=tt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),GD=tt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),YD=tt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),JD=tt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),XD=tt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ZD=tt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),QD=tt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),eO=tt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),tO=tt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),rO=Object.freeze({__proto__:null,base32:WD,base32upper:GD,base32pad:YD,base32padupper:JD,base32hex:XD,base32hexupper:ZD,base32hexpad:QD,base32hexpadupper:eO,base32z:tO}),nO=Co({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),sO=Co({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),iO=Object.freeze({__proto__:null,base36:nO,base36upper:sO}),oO=Co({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),aO=Co({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),cO=Object.freeze({__proto__:null,base58btc:oO,base58flickr:aO}),uO=tt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),lO=tt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),hO=tt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),fO=tt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),dO=Object.freeze({__proto__:null,base64:uO,base64pad:lO,base64url:hO,base64urlpad:fO}),O1=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),pO=O1.reduce((t,e,r)=>(t[r]=e,t),[]),gO=O1.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function mO(t){return t.reduce((e,r)=>(e+=pO[r],e),"")}function yO(t){let e=[];for(let r of t){let n=gO[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}var wO=Hc({prefix:"\u{1F680}",name:"base256emoji",encode:mO,decode:yO}),bO=Object.freeze({__proto__:null,base256emoji:wO}),vO=P1,t1=128,EO=127,xO=~EO,SO=Math.pow(2,31);function P1(t,e,r){e=e||[],r=r||0;for(var n=r;t>=SO;)e[r++]=t&255|t1,t/=128;for(;t&xO;)e[r++]=t&255|t1,t>>>=7;return e[r]=t|0,P1.bytes=r-n+1,e}var IO=Wf,_O=128,r1=127;function Wf(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw Wf.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&r1)<<s:(o&r1)*Math.pow(2,s),s+=7}while(o>=_O);return Wf.bytes=i-n,r}var AO=Math.pow(2,7),TO=Math.pow(2,14),CO=Math.pow(2,21),DO=Math.pow(2,28),OO=Math.pow(2,35),PO=Math.pow(2,42),RO=Math.pow(2,49),NO=Math.pow(2,56),BO=Math.pow(2,63),UO=function(t){return t<AO?1:t<TO?2:t<CO?3:t<DO?4:t<OO?5:t<PO?6:t<RO?7:t<NO?8:t<BO?9:10},kO={encode:vO,decode:IO,encodingLength:UO},R1=kO,n1=(t,e,r=0)=>(R1.encode(t,e,r),e),s1=t=>R1.encodingLength(t),Gf=(t,e)=>{let r=e.byteLength,n=s1(t),s=n+s1(r),i=new Uint8Array(s+r);return n1(t,i,0),n1(r,i,n),i.set(e,s),new Yf(t,r,e,i)},Yf=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}},N1=({name:t,code:e,encode:r})=>new Jf(t,e,r),Jf=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?Gf(this.code,r):r.then(n=>Gf(this.code,n))}else throw Error("Unknown type, must be binary type")}},B1=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),FO=N1({name:"sha2-256",code:18,encode:B1("SHA-256")}),LO=N1({name:"sha2-512",code:19,encode:B1("SHA-512")}),MO=Object.freeze({__proto__:null,sha256:FO,sha512:LO}),U1=0,qO="identity",k1=C1,jO=t=>Gf(U1,k1(t)),$O={code:U1,name:qO,encode:k1,digest:jO},zO=Object.freeze({__proto__:null,identity:$O});new TextEncoder,new TextDecoder;var i1=M(M(M(M(M(M(M(M(M(M({},FD),MD),jD),zD),KD),rO),iO),cO),dO),bO);M(M({},MO),zO);function F1(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function HO(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?F1(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function L1(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}var o1=L1("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Mf=L1("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=HO(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),VO=M({utf8:o1,"utf-8":o1,hex:i1.base16,latin1:Mf,ascii:Mf,binary:Mf},i1);function KO(t,e="utf8"){let r=VO[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?F1(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var WO=Object.defineProperty,GO=(t,e,r)=>e in t?WO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ur=(t,e,r)=>GO(t,typeof e!="symbol"?e+"":e,r),Xf=class{constructor(e,r){this.core=e,this.logger=r,Ur(this,"keychain",new Map),Ur(this,"name",QC),Ur(this,"version",eD),Ur(this,"initialized",!1),Ur(this,"storagePrefix",Fr),Ur(this,"init",async()=>{if(!this.initialized){let n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),Ur(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),Ur(this,"set",async(n,s)=>{this.isInitialized(),this.keychain.set(n,s),await this.persist()}),Ur(this,"get",n=>{this.isInitialized();let s=this.keychain.get(n);if(typeof s>"u"){let{message:i}=$("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(i)}return s}),Ur(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Ct(r,this.name)}get context(){return vt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,yc(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?wc(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}},YO=Object.defineProperty,JO=(t,e,r)=>e in t?YO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ge=(t,e,r)=>JO(t,typeof e!="symbol"?e+"":e,r),Zf=class{constructor(e,r,n){this.core=e,this.logger=r,Ge(this,"name",XC),Ge(this,"keychain"),Ge(this,"randomSessionIdentifier",Cc()),Ge(this,"initialized",!1),Ge(this,"clientId"),Ge(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Ge(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),Ge(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;let s=await this.getClientSeed(),i=Xu(s),o=Ju(i.publicKey);return this.clientId=o,o}),Ge(this,"generateKeyPair",()=>{this.isInitialized();let s=Xw();return this.setPrivateKey(s.publicKey,s.privateKey)}),Ge(this,"signJWT",async s=>{this.isInitialized();let i=await this.getClientSeed(),o=Xu(i),a=this.randomSessionIdentifier;return await em(a,s,ZC,o)}),Ge(this,"generateSharedKey",(s,i,o)=>{this.isInitialized();let a=this.getPrivateKey(s),c=Zw(a,i);return this.setSymKey(c,o)}),Ge(this,"setSymKey",async(s,i)=>{this.isInitialized();let o=i||Zs(s);return await this.keychain.set(o,s),o}),Ge(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),Ge(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),Ge(this,"encode",async(s,i,o)=>{this.isInitialized();let a=bf(o),c=Qt(i);if(Ef(a))return sb(c,o?.encoding);if(vf(a)){let f=a.senderPublicKey,d=a.receiverPublicKey;s=await this.generateSharedKey(f,d)}let u=this.getSymKey(s),{type:l,senderPublicKey:h}=a;return rb({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o?.encoding})}),Ge(this,"decode",async(s,i,o)=>{this.isInitialized();let a=ab(i,o);if(Ef(a)){let c=ib(i,o?.encoding);return Zt(c)}if(vf(a)){let c=a.receiverPublicKey,u=a.senderPublicKey;s=await this.generateSharedKey(c,u)}try{let c=this.getSymKey(s),u=nb({symKey:c,encoded:i,encoding:o?.encoding});return Zt(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Ge(this,"getPayloadType",(s,i=ft)=>{let o=Qs({encoded:s,encoding:i});return Pn(o.type)}),Ge(this,"getPayloadSenderPublicKey",(s,i=ft)=>{let o=Qs({encoded:s,encoding:i});return o.senderPublicKey?Xe(o.senderPublicKey,ht):void 0}),this.core=e,this.logger=Ct(r,this.name),this.keychain=n||new Xf(this.core,this.logger)}get context(){return vt(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Qb)}catch{e=Cc(),await this.keychain.set(Qb,e)}return KO(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}},XO=Object.defineProperty,ZO=Object.defineProperties,QO=Object.getOwnPropertyDescriptors,a1=Object.getOwnPropertySymbols,eP=Object.prototype.hasOwnProperty,tP=Object.prototype.propertyIsEnumerable,Qf=(t,e,r)=>e in t?XO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rP=(t,e)=>{for(var r in e||(e={}))eP.call(e,r)&&Qf(t,r,e[r]);if(a1)for(var r of a1(e))tP.call(e,r)&&Qf(t,r,e[r]);return t},nP=(t,e)=>ZO(t,QO(e)),Gt=(t,e,r)=>Qf(t,typeof e!="symbol"?e+"":e,r),ed=class extends Yo{constructor(e,r){super(e,r),this.logger=e,this.core=r,Gt(this,"messages",new Map),Gt(this,"messagesWithoutClientAck",new Map),Gt(this,"name",tD),Gt(this,"version",rD),Gt(this,"initialized",!1),Gt(this,"storagePrefix",Fr),Gt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);let s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),Gt(this,"set",async(n,s,i)=>{this.isInitialized();let o=Ft(s),a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(n,a),i===$c.inbound){let c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,nP(rP({},c),{[o]:s}))}return await this.persist(),o}),Gt(this,"get",n=>{this.isInitialized();let s=this.messages.get(n);return typeof s>"u"&&(s={}),s}),Gt(this,"getWithoutAck",n=>{this.isInitialized();let s={};for(let i of n){let o=this.messagesWithoutClientAck.get(i)||{};s[i]=Object.values(o)}return s}),Gt(this,"has",(n,s)=>{this.isInitialized();let i=this.get(n),o=Ft(s);return typeof i[o]<"u"}),Gt(this,"ack",async(n,s)=>{this.isInitialized();let i=this.messagesWithoutClientAck.get(n);if(typeof i>"u")return;let o=Ft(s);delete i[o],Object.keys(i).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,i),await this.persist()}),Gt(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Ct(e,this.name),this.core=r}get context(){return vt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,yc(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,yc(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?wc(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?wc(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}},sP=Object.defineProperty,iP=Object.defineProperties,oP=Object.getOwnPropertyDescriptors,c1=Object.getOwnPropertySymbols,aP=Object.prototype.hasOwnProperty,cP=Object.prototype.propertyIsEnumerable,td=(t,e,r)=>e in t?sP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ni=(t,e)=>{for(var r in e||(e={}))aP.call(e,r)&&td(t,r,e[r]);if(c1)for(var r of c1(e))cP.call(e,r)&&td(t,r,e[r]);return t},u1=(t,e)=>iP(t,oP(e)),or=(t,e,r)=>td(t,typeof e!="symbol"?e+"":e,r),rd=class extends Jo{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,or(this,"events",new an.EventEmitter),or(this,"name",sD),or(this,"queue",new Map),or(this,"publishTimeout",(0,X.toMiliseconds)(X.ONE_MINUTE)),or(this,"initialPublishTimeout",(0,X.toMiliseconds)(X.ONE_SECOND*15)),or(this,"needsTransportRestart",!1),or(this,"publish",async(n,s,i)=>{var o,a,c,u,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:i}});let h=i?.ttl||nD,f=i?.prompt||!1,d=i?.tag||0,p=i?.id||sr().toString(),g=ds(po().protocol),w={id:p,method:i?.publishMethod||g.publish,params:ni({topic:n,message:s,ttl:h,prompt:f,tag:d,attestation:i?.attestation},i?.tvf)},P=`Failed to publish payload, please try again. id:${p} tag:${d}`;try{Ne((o=w.params)==null?void 0:o.prompt)&&((a=w.params)==null||delete a.prompt),Ne((c=w.params)==null?void 0:c.tag)&&((u=w.params)==null||delete u.tag);let R=new Promise(async x=>{let I=({id:B})=>{var k;((k=w.id)==null?void 0:k.toString())===B.toString()&&(this.removeRequestFromQueue(B),this.relayer.events.removeListener(Pe.publish,I),x())};this.relayer.events.on(Pe.publish,I);let C=xr(new Promise((B,k)=>{this.rpcPublish(w,i).then(B).catch(U=>{this.logger.warn(U,U?.message),k(U)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${p} tag:${d}`);try{await C,this.events.removeListener(Pe.publish,I)}catch(B){this.queue.set(p,{request:w,opts:i,attempt:1}),this.logger.warn(B,B?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,topic:n,message:s,opts:i}}),await xr(R,this.publishTimeout,P)}catch(R){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(R),(l=i?.internal)!=null&&l.throwOnFailedPublish)throw R}finally{this.queue.delete(p)}}),or(this,"publishCustom",async n=>{var s,i,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});let{payload:u,opts:l={}}=n,{attestation:h,tvf:f,publishMethod:d,prompt:p,tag:g,ttl:w=X.FIVE_MINUTES}=l,P=l.id||sr().toString(),R=ds(po().protocol),x=d||R.publish,I={id:P,method:x,params:ni(u1(ni({},u),{ttl:w,prompt:p,tag:g,attestation:h}),f)},C=`Failed to publish custom payload, please try again. id:${P} tag:${g}`;try{Ne((s=I.params)==null?void 0:s.prompt)&&((i=I.params)==null||delete i.prompt),Ne((o=I.params)==null?void 0:o.tag)&&((a=I.params)==null||delete a.tag);let B=new Promise(async k=>{let U=({id:j})=>{var b;((b=I.id)==null?void 0:b.toString())===j.toString()&&(this.removeRequestFromQueue(j),this.relayer.events.removeListener(Pe.publish,U),k())};this.relayer.events.on(Pe.publish,U);let N=xr(new Promise((j,b)=>{this.rpcPublish(I,l).then(j).catch(E=>{this.logger.warn(E,E?.message),b(E)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${x} id:${P} tag:${g}`);try{await N,this.events.removeListener(Pe.publish,U)}catch(j){this.queue.set(P,{request:I,opts:l,attempt:1}),this.logger.warn(j,j?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:P,payload:u,opts:l}}),await xr(B,this.publishTimeout,C)}catch(B){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(B),(c=l?.internal)!=null&&c.throwOnFailedPublish)throw B}finally{this.queue.delete(P)}}),or(this,"on",(n,s)=>{this.events.on(n,s)}),or(this,"once",(n,s)=>{this.events.once(n,s)}),or(this,"off",(n,s)=>{this.events.off(n,s)}),or(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.relayer=e,this.logger=Ct(r,this.name),this.registerEventListeners()}get context(){return vt(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});let n=await this.relayer.request(e);return this.relayer.events.emit(Pe.publish,ni(ni({},e),r)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var n;let s=e.attempt+1;this.queue.set(r,u1(ni({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(ln.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Pe.connection_stalled);return}this.checkQueue()}),this.relayer.on(Pe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}},uP=Object.defineProperty,lP=(t,e,r)=>e in t?uP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,si=(t,e,r)=>lP(t,typeof e!="symbol"?e+"":e,r),nd=class{constructor(){si(this,"map",new Map),si(this,"set",(e,r)=>{let n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),si(this,"get",e=>this.map.get(e)||[]),si(this,"exists",(e,r)=>this.get(e).includes(r)),si(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;let n=this.get(e);if(!this.exists(e,r))return;let s=n.filter(i=>i!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),si(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}},hP=Object.defineProperty,fP=Object.defineProperties,dP=Object.getOwnPropertyDescriptors,l1=Object.getOwnPropertySymbols,pP=Object.prototype.hasOwnProperty,gP=Object.prototype.propertyIsEnumerable,sd=(t,e,r)=>e in t?hP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Io=(t,e)=>{for(var r in e||(e={}))pP.call(e,r)&&sd(t,r,e[r]);if(l1)for(var r of l1(e))gP.call(e,r)&&sd(t,r,e[r]);return t},qf=(t,e)=>fP(t,dP(e)),be=(t,e,r)=>sd(t,typeof e!="symbol"?e+"":e,r),id=class extends Qo{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,be(this,"subscriptions",new Map),be(this,"topicMap",new nd),be(this,"events",new an.EventEmitter),be(this,"name",hD),be(this,"version",fD),be(this,"pending",new Map),be(this,"cached",[]),be(this,"initialized",!1),be(this,"storagePrefix",Fr),be(this,"subscribeTimeout",(0,X.toMiliseconds)(X.ONE_MINUTE)),be(this,"initialSubscribeTimeout",(0,X.toMiliseconds)(X.ONE_SECOND*15)),be(this,"clientId"),be(this,"batchSubscribeTopicsLimit",500),be(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),be(this,"subscribe",async(n,s)=>{var i;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}});try{let o=po(s),a={topic:n,relay:o,transportType:s?.transportType};(i=s?.internal)!=null&&i.skipSubscribe||this.pending.set(n,a);let c=await this.rpcSubscribe(n,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),be(this,"unsubscribe",async(n,s)=>{this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(n,s.id,s):await this.unsubscribeByTopic(n,s)}),be(this,"isSubscribed",n=>new Promise(s=>{s(this.topicMap.topics.includes(n))})),be(this,"isKnownTopic",n=>new Promise(s=>{s(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(i=>i.topic===n))})),be(this,"on",(n,s)=>{this.events.on(n,s)}),be(this,"once",(n,s)=>{this.events.once(n,s)}),be(this,"off",(n,s)=>{this.events.off(n,s)}),be(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),be(this,"start",async()=>{await this.onConnect()}),be(this,"stop",async()=>{await this.onDisconnect()}),be(this,"restart",async()=>{await this.restore(),await this.onRestart()}),be(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;let n=[];this.pending.forEach(s=>{n.push(s)}),await this.batchSubscribe(n)}),be(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(ln.pulse,async()=>{await this.checkPending()}),this.events.on(Yt.created,async n=>{let s=Yt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()}),this.events.on(Yt.deleted,async n=>{let s=Yt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()})}),this.relayer=e,this.logger=Ct(r,this.name),this.clientId=""}get context(){return vt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){let n=this.topicMap.get(e);await Promise.all(n.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{let s=po(n);await this.restartToComplete({topic:e,id:r,relay:s}),await this.rpcUnsubscribe(e,r,s);let i=we("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,n){var s,i;let o=await this.getSubscriptionId(e);if((s=n?.internal)!=null&&s.skipSubscribe)return o;(!n||n?.transportType===xe.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});let a={method:ds(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});let c=(i=n?.internal)==null?void 0:i.throwOnFailedPublish;try{if(n?.transportType===xe.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},(0,X.toMiliseconds)(X.ONE_SECOND)),o;let u=new Promise(async h=>{let f=d=>{d.topic===e&&(this.events.removeListener(Yt.created,f),h(d.id))};this.events.on(Yt.created,f);try{let d=await xr(new Promise((p,g)=>{this.relayer.request(a).catch(w=>{this.logger.warn(w,w?.message),g(w)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Yt.created,f),h(d)}catch{}}),l=await xr(u,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(u){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Pe.connection_stalled),c)throw u}return null}async rpcBatchSubscribe(e){if(!e.length)return;let r=e[0].relay,n={method:ds(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await xr(new Promise(s=>{this.relayer.request(n).catch(i=>this.logger.warn(i)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Pe.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;let r=e[0].relay,n={method:ds(r.protocol).batchFetchMessages,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let s;try{s=await await xr(new Promise((i,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(i)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Pe.connection_stalled)}return s}rpcUnsubscribe(e,r,n){let s={method:ds(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,qf(Io({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Io({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Io({},r)),this.topicMap.set(r.topic,e),this.events.emit(Yt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let r=this.subscriptions.get(e);if(!r){let{message:n}=$("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});let n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(Yt.deleted,qf(Io({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Yt.sync)}async onRestart(){if(this.cached.length){let e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){let s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Yt.resubscribed)}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var n;return r.topic===((n=this.subscriptions.get(r.id))==null?void 0:n.topic)})){let{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>qf(Io({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await nw((0,X.toMiliseconds)(X.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Ft(e+await this.getClientId())}},mP=Object.defineProperty,h1=Object.getOwnPropertySymbols,yP=Object.prototype.hasOwnProperty,wP=Object.prototype.propertyIsEnumerable,od=(t,e,r)=>e in t?mP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,f1=(t,e)=>{for(var r in e||(e={}))yP.call(e,r)&&od(t,r,e[r]);if(h1)for(var r of h1(e))wP.call(e,r)&&od(t,r,e[r]);return t},fe=(t,e,r)=>od(t,typeof e!="symbol"?e+"":e,r),ad=class extends Xo{constructor(e){var r;super(e),fe(this,"protocol","wc"),fe(this,"version",2),fe(this,"core"),fe(this,"logger"),fe(this,"events",new an.EventEmitter),fe(this,"provider"),fe(this,"messages"),fe(this,"subscriber"),fe(this,"publisher"),fe(this,"name",oD),fe(this,"transportExplicitlyClosed",!1),fe(this,"initialized",!1),fe(this,"connectionAttemptInProgress",!1),fe(this,"relayUrl"),fe(this,"projectId"),fe(this,"packageName"),fe(this,"bundleId"),fe(this,"hasExperiencedNetworkDisruption",!1),fe(this,"pingTimeout"),fe(this,"heartBeatTimeout",(0,X.toMiliseconds)(X.THIRTY_SECONDS+X.FIVE_SECONDS)),fe(this,"reconnectTimeout"),fe(this,"connectPromise"),fe(this,"reconnectInProgress",!1),fe(this,"requestsInFlight",[]),fe(this,"connectTimeout",(0,X.toMiliseconds)(X.ONE_SECOND*15)),fe(this,"request",async n=>{var s,i;this.logger.debug("Publishing Request Payload");let o=n.id||sr().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:n.method,topic:(s=n.params)==null?void 0:s.topic},"relayer.request - publishing...");let a=`${o}:${((i=n.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(a);let c=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(u=>u!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),fe(this,"resetPingTimeout",()=>{io()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,s,i,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(i=(s=(n=this.provider)==null?void 0:n.connection)==null?void 0:s.socket)==null?void 0:i.terminate)==null||o.call(i)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),fe(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),fe(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(Pe.connect)}),fe(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),fe(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(Pe.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),fe(this,"registerProviderListeners",()=>{this.provider.on(ir.payload,this.onPayloadHandler),this.provider.on(ir.connect,this.onConnectHandler),this.provider.on(ir.disconnect,this.onDisconnectHandler),this.provider.on(ir.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=ti({logger:(r=e.logger)!=null?r:iD,name:this.name}),this.messages=new ed(this.logger,e.core),this.subscriber=new id(this,this.logger),this.publisher=new rd(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||A1,W0()?this.packageName=Zh():G0()&&(this.bundleId=Zh()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return vt(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:xe.relay},$c.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var n,s,i;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();let o=typeof((n=r?.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(s=r?.internal)==null?void 0:s.throwOnFailedPublish,a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",c,u=l=>{l.topic===e&&(this.subscriber.off(Yt.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(Yt.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,f1({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await xr(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Df())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}let r=e.sort((n,s)=>n.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(let n of r)try{await this.onMessageEvent(n)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+s?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){let{topic:n}=e;if(!r.sessionExists){let s=Ae(X.FIVE_MINUTES),i={topic:n,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,i)}this.events.emit(Pe.message,e),await this.recordMessageEvent(e,$c.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,s)=>{let i=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(ir.disconnect,i),await xr(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(ir.disconnect,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{let c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(ir.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(ir.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();let s=n;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,(0,X.toMiliseconds)(r*1))),r++}}startPingTimeout(){var e,r,n,s,i;if(io())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((i=(s=(n=this.provider)==null?void 0:n.connection)==null?void 0:s.socket)==null||i.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new gs(new jc(J0({sdkVersion:$f,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){let{topic:n,message:s}=e;await this.messages.set(n,s,r)}async shouldIgnoreMessageEvent(e){let{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;let s=this.messages.has(r,n);return s&&this.logger.warn(`Ignoring duplicate message: ${n}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ri(e)){if(!e.method.endsWith(aD))return;let r=e.params,{topic:n,message:s,publishedAt:i,attestation:o}=r.data,a={topic:n,message:s,publishedAt:i,transportType:xe.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(f1({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Fn(e)&&this.events.emit(Pe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,$c.inbound),this.events.emit(Pe.message,e))}async acknowledgePayload(e){let r=sn(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ir.payload,this.onPayloadHandler),this.provider.off(ir.connect,this.onConnectHandler),this.provider.off(ir.disconnect,this.onDisconnectHandler),this.provider.off(ir.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Df();Ab(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(ln.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&Tb())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Pe.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,X.toMiliseconds)(cD)))))}isInitialized(){if(!this.initialized){let{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function bP(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function d1(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function p1(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}var vP="[object RegExp]",EP="[object String]",xP="[object Number]",SP="[object Boolean]",g1="[object Arguments]",IP="[object Symbol]",_P="[object Date]",AP="[object Map]",TP="[object Set]",CP="[object Array]",DP="[object Function]",OP="[object ArrayBuffer]",jf="[object Object]",PP="[object Error]",RP="[object DataView]",NP="[object Uint8Array]",BP="[object Uint8ClampedArray]",UP="[object Uint16Array]",kP="[object Uint32Array]",FP="[object BigUint64Array]",LP="[object Int8Array]",MP="[object Int16Array]",qP="[object Int32Array]",jP="[object BigInt64Array]",$P="[object Float32Array]",zP="[object Float64Array]";function HP(){}function m1(t){if(!t||typeof t!="object")return!1;let e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function VP(t,e,r){return Ao(t,e,void 0,void 0,void 0,void 0,r)}function Ao(t,e,r,n,s,i,o){let a=o(t,e,r,n,s,i);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return To(t,e,i,o)}return To(t,e,i,o)}function To(t,e,r,n){if(Object.is(t,e))return!0;let s=p1(t),i=p1(e);if(s===g1&&(s=jf),i===g1&&(i=jf),s!==i)return!1;switch(s){case EP:return t.toString()===e.toString();case xP:{let c=t.valueOf(),u=e.valueOf();return bP(c,u)}case SP:case _P:case IP:return Object.is(t.valueOf(),e.valueOf());case vP:return t.source===e.source&&t.flags===e.flags;case DP:return t===e}r=r??new Map;let o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(s){case AP:{if(t.size!==e.size)return!1;for(let[c,u]of t.entries())if(!e.has(c)||!Ao(u,e.get(c),c,t,e,r,n))return!1;return!0}case TP:{if(t.size!==e.size)return!1;let c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){let h=c[l],f=u.findIndex(d=>Ao(h,d,void 0,t,e,r,n));if(f===-1)return!1;u.splice(f,1)}return!0}case CP:case NP:case BP:case UP:case kP:case FP:case LP:case MP:case qP:case jP:case $P:case zP:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Ao(t[c],e[c],c,t,e,r,n))return!1;return!0}case OP:return t.byteLength!==e.byteLength?!1:To(new Uint8Array(t),new Uint8Array(e),r,n);case RP:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:To(new Uint8Array(t),new Uint8Array(e),r,n);case PP:return t.name===e.name&&t.message===e.message;case jf:{if(!(To(t.constructor,e.constructor,r,n)||m1(t)&&m1(e)))return!1;let c=[...Object.keys(t),...d1(t)],u=[...Object.keys(e),...d1(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){let h=c[l],f=t[h];if(!Object.hasOwn(e,h))return!1;let d=e[h];if(!Ao(f,d,h,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function KP(t,e){return VP(t,e,HP)}var WP=Object.defineProperty,y1=Object.getOwnPropertySymbols,GP=Object.prototype.hasOwnProperty,YP=Object.prototype.propertyIsEnumerable,cd=(t,e,r)=>e in t?WP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,w1=(t,e)=>{for(var r in e||(e={}))GP.call(e,r)&&cd(t,r,e[r]);if(y1)for(var r of y1(e))YP.call(e,r)&&cd(t,r,e[r]);return t},Lt=(t,e,r)=>cd(t,typeof e!="symbol"?e+"":e,r),Lr=class extends Zo{constructor(e,r,n,s=Fr,i=void 0){super(e,r,n,s),this.core=e,this.logger=r,this.name=n,Lt(this,"map",new Map),Lt(this,"version",uD),Lt(this,"cached",[]),Lt(this,"initialized",!1),Lt(this,"getKey"),Lt(this,"storagePrefix",Fr),Lt(this,"recentlyDeleted",[]),Lt(this,"recentlyDeletedLimit",200),Lt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ne(o)?this.map.set(this.getKey(o),o):fb(o)?this.map.set(o.id,o):db(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Lt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Lt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Lt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>KP(a[c],o[c]))):this.values)),Lt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});let c=w1(w1({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Lt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Ct(r,this.name),this.storagePrefix=s,this.getKey=i}get context(){return vt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){let{message:s}=$("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}let{message:n}=$("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}},JP=Object.defineProperty,XP=(t,e,r)=>e in t?JP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oe=(t,e,r)=>XP(t,typeof e!="symbol"?e+"":e,r),ud=class{constructor(e,r){this.core=e,this.logger=r,oe(this,"name",dD),oe(this,"version",pD),oe(this,"events",new an.default),oe(this,"pairings"),oe(this,"initialized",!1),oe(this,"storagePrefix",Fr),oe(this,"ignoredPayloadTypes",[Sr]),oe(this,"registeredMethods",[]),oe(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),oe(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),oe(this,"create",async n=>{this.isInitialized();let s=Cc(),i=await this.core.crypto.setSymKey(s),o=Ae(X.FIVE_MINUTES),a={protocol:wd},c={topic:i,expiry:o,relay:a,active:!1,methods:n?.methods},u=Sf({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:s,relay:a,expiryTimestamp:o,methods:n?.methods});return this.events.emit(Ln.create,c),this.core.expirer.set(i,o),await this.pairings.set(i,c),await this.core.relayer.subscribe(i,{transportType:n?.transportType,internal:n?.internal}),{topic:i,uri:u}}),oe(this,"pair",async n=>{this.isInitialized();let s=this.core.eventClient.createEvent({properties:{topic:n?.uri,trace:[Ar.pairing_started]}});this.isValidPair(n,s);let{topic:i,symKey:o,relay:a,expiryTimestamp:c,methods:u}=xf(n.uri);s.props.properties.topic=i,s.addTrace(Ar.pairing_uri_validation_success),s.addTrace(Ar.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(i)){if(l=this.pairings.get(i),s.addTrace(Ar.existing_pairing),l.active)throw s.setError(kr.active_pairing_already_exists),new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);s.addTrace(Ar.pairing_not_expired)}let h=c||Ae(X.FIVE_MINUTES),f={topic:i,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(i,h),await this.pairings.set(i,f),s.addTrace(Ar.store_new_pairing),n.activatePairing&&await this.activate({topic:i}),this.events.emit(Ln.create,f),s.addTrace(Ar.emit_inactive_pairing),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(o,i),s.addTrace(Ar.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(kr.no_internet_connection)}try{await this.core.relayer.subscribe(i,{relay:a})}catch(d){throw s.setError(kr.subscribe_pairing_topic_failure),d}return s.addTrace(Ar.subscribe_pairing_topic_success),f}),oe(this,"activate",async({topic:n})=>{this.isInitialized();let s=Ae(X.FIVE_MINUTES);this.core.expirer.set(n,s),await this.pairings.update(n,{active:!0,expiry:s})}),oe(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:s}=n;if(this.pairings.keys.includes(s)){let i=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=rn();this.events.once(he("pairing_ping",i),({error:u})=>{u?c(u):a()}),await o()}}),oe(this,"updateExpiry",async({topic:n,expiry:s})=>{this.isInitialized(),await this.pairings.update(n,{expiry:s})}),oe(this,"updateMetadata",async({topic:n,metadata:s})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:s})}),oe(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),oe(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);let{topic:s}=n;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",we("USER_DISCONNECTED")),await this.deletePairing(s))}),oe(this,"formatUriFromPairing",n=>{this.isInitialized();let{topic:s,relay:i,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(s);return Sf({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:i,expiryTimestamp:o,methods:a})}),oe(this,"sendRequest",async(n,s,i)=>{let o=pt(s,i),a=await this.core.crypto.encode(n,o),c=So[s].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),oe(this,"sendResult",async(n,s,i)=>{let o=sn(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,u=So[c].res;await this.core.relayer.publish(s,a,u),await this.core.history.resolve(o)}),oe(this,"sendError",async(n,s,i)=>{let o=on(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,u=So[c]?So[c].res:So.unregistered_method.res;await this.core.relayer.publish(s,a,u),await this.core.history.resolve(o)}),oe(this,"deletePairing",async(n,s)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,we("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),s?Promise.resolve():this.core.expirer.del(n)])}),oe(this,"cleanup",async()=>{let n=this.pairings.getAll().filter(s=>Kt(s.expiry));await Promise.all(n.map(s=>this.deletePairing(s.topic)))}),oe(this,"onRelayEventRequest",async n=>{let{topic:s,payload:i}=n;switch(i.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,i);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,i);default:return await this.onUnknownRpcMethodRequest(s,i)}}),oe(this,"onRelayEventResponse",async n=>{let{topic:s,payload:i}=n,o=(await this.core.history.get(s,i.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,i);default:return this.onUnknownRpcMethodResponse(o)}}),oe(this,"onPairingPingRequest",async(n,s)=>{let{id:i}=s;try{this.isValidPing({topic:n}),await this.sendResult(i,n,!0),this.events.emit(Ln.ping,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),oe(this,"onPairingPingResponse",(n,s)=>{let{id:i}=s;setTimeout(()=>{Wt(s)?this.events.emit(he("pairing_ping",i),{}):gt(s)&&this.events.emit(he("pairing_ping",i),{error:s.error})},500)}),oe(this,"onPairingDeleteRequest",async(n,s)=>{let{id:i}=s;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Ln.delete,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),oe(this,"onUnknownRpcMethodRequest",async(n,s)=>{let{id:i,method:o}=s;try{if(this.registeredMethods.includes(o))return;let a=we("WC_METHOD_UNSUPPORTED",o);await this.sendError(i,n,a),this.logger.error(a)}catch(a){await this.sendError(i,n,a),this.logger.error(a)}}),oe(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(we("WC_METHOD_UNSUPPORTED",n))}),oe(this,"isValidPair",(n,s)=>{var i;if(!dt(n)){let{message:a}=$("MISSING_OR_INVALID",`pair() params: ${n}`);throw s.setError(kr.malformed_pairing_uri),new Error(a)}if(!hb(n.uri)){let{message:a}=$("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw s.setError(kr.malformed_pairing_uri),new Error(a)}let o=xf(n?.uri);if(!((i=o?.relay)!=null&&i.protocol)){let{message:a}=$("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(kr.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){let{message:a}=$("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(kr.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&(0,X.toMiliseconds)(o?.expiryTimestamp)<Date.now()){s.setError(kr.pairing_expired);let{message:a}=$("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),oe(this,"isValidPing",async n=>{if(!dt(n)){let{message:i}=$("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}let{topic:s}=n;await this.isValidPairingTopic(s)}),oe(this,"isValidDisconnect",async n=>{if(!dt(n)){let{message:i}=$("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}let{topic:s}=n;await this.isValidPairingTopic(s)}),oe(this,"isValidPairingTopic",async n=>{if(!Oe(n,!1)){let{message:s}=$("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(s)}if(!this.pairings.keys.includes(n)){let{message:s}=$("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(s)}if(Kt(this.pairings.get(n).expiry)){await this.deletePairing(n);let{message:s}=$("EXPIRED",`pairing topic: ${n}`);throw new Error(s)}}),this.core=e,this.logger=Ct(r,this.name),this.pairings=new Lr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return vt(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Pe.message,async e=>{let{topic:r,message:n,transportType:s}=e;if(this.pairings.keys.includes(r)&&s!==xe.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{let i=await this.core.crypto.decode(r,n);ri(i)?(this.core.history.set(r,i),await this.onRelayEventRequest({topic:r,payload:i})):Fn(i)&&(await this.core.history.resolve(i),await this.onRelayEventResponse({topic:r,payload:i}),this.core.history.delete(r,i.id)),await this.core.relayer.messages.ack(r,n)}catch(i){this.logger.error(i)}})}registerExpirerEvents(){this.core.expirer.on(Jt.expired,async e=>{let{topic:r}=bc(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Ln.expire,{topic:r}))})}},ZP=Object.defineProperty,QP=(t,e,r)=>e in t?ZP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,et=(t,e,r)=>QP(t,typeof e!="symbol"?e+"":e,r),ld=class extends Go{constructor(e,r){super(e,r),this.core=e,this.logger=r,et(this,"records",new Map),et(this,"events",new an.EventEmitter),et(this,"name",gD),et(this,"version",mD),et(this,"cached",[]),et(this,"initialized",!1),et(this,"storagePrefix",Fr),et(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),et(this,"set",(n,s,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:s,chainId:i}),this.records.has(s.id))return;let o={id:s.id,topic:n,request:{method:s.method,params:s.params||null},chainId:i,expiry:Ae(X.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(_r.created,o)}),et(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;let s=await this.getRecord(n.id);typeof s.response>"u"&&(s.response=gt(n)?{error:n.error}:{result:n.result},this.records.set(s.id,s),this.persist(),this.events.emit(_r.updated,s))}),et(this,"get",async(n,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:s}),await this.getRecord(s))),et(this,"delete",(n,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(i=>{if(i.topic===n){if(typeof s<"u"&&i.id!==s)return;this.records.delete(i.id),this.events.emit(_r.deleted,i)}}),this.persist()}),et(this,"exists",async(n,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===n:!1)),et(this,"on",(n,s)=>{this.events.on(n,s)}),et(this,"once",(n,s)=>{this.events.once(n,s)}),et(this,"off",(n,s)=>{this.events.off(n,s)}),et(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=Ct(r,this.name)}get context(){return vt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;let n={topic:r.topic,request:pt(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let r=this.records.get(e);if(!r){let{message:n}=$("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(_r.sync)}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(_r.created,e=>{let r=_r.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(_r.updated,e=>{let r=_r.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(_r.deleted,e=>{let r=_r.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(ln.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{(0,X.toMiliseconds)(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(_r.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}},e6=Object.defineProperty,t6=(t,e,r)=>e in t?e6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mt=(t,e,r)=>t6(t,typeof e!="symbol"?e+"":e,r),hd=class extends ea{constructor(e,r){super(e,r),this.core=e,this.logger=r,mt(this,"expirations",new Map),mt(this,"events",new an.EventEmitter),mt(this,"name",yD),mt(this,"version",wD),mt(this,"cached",[]),mt(this,"initialized",!1),mt(this,"storagePrefix",Fr),mt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),mt(this,"has",n=>{try{let s=this.formatTarget(n);return typeof this.getExpiration(s)<"u"}catch{return!1}}),mt(this,"set",(n,s)=>{this.isInitialized();let i=this.formatTarget(n),o={target:i,expiry:s};this.expirations.set(i,o),this.checkExpiry(i,o),this.events.emit(Jt.created,{target:i,expiration:o})}),mt(this,"get",n=>{this.isInitialized();let s=this.formatTarget(n);return this.getExpiration(s)}),mt(this,"del",n=>{if(this.isInitialized(),this.has(n)){let s=this.formatTarget(n),i=this.getExpiration(s);this.expirations.delete(s),this.events.emit(Jt.deleted,{target:s,expiration:i})}}),mt(this,"on",(n,s)=>{this.events.on(n,s)}),mt(this,"once",(n,s)=>{this.events.once(n,s)}),mt(this,"off",(n,s)=>{this.events.off(n,s)}),mt(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=Ct(r,this.name)}get context(){return vt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Z0(e);if(typeof e=="number")return Q0(e);let{message:r}=$("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Jt.sync)}async restore(){try{let e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let r=this.expirations.get(e);if(!r){let{message:n}=$("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){let{expiry:n}=r;(0,X.toMiliseconds)(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Jt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(ln.pulse,()=>this.checkExpirations()),this.events.on(Jt.created,e=>{let r=Jt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Jt.expired,e=>{let r=Jt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Jt.deleted,e=>{let r=Jt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}},r6=Object.defineProperty,n6=(t,e,r)=>e in t?r6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ke=(t,e,r)=>n6(t,typeof e!="symbol"?e+"":e,r),fd=class extends ta{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,ke(this,"name",bD),ke(this,"abortController"),ke(this,"isDevEnv"),ke(this,"verifyUrlV3",ED),ke(this,"storagePrefix",Fr),ke(this,"version",_1),ke(this,"publicKey"),ke(this,"fetchPromise"),ke(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,X.toMiliseconds)((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),ke(this,"register",async s=>{if(!hs()||this.isDevEnv)return;let i=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${i}&id=${o}&decryptedId=${a}`;try{let u=(0,S1.getDocument)(),l=this.startAbortTimer(X.ONE_SECOND*5),h=await new Promise((f,d)=>{let p=()=>{window.removeEventListener("message",w),u.body.removeChild(g),d("attestation aborted")};this.abortController.signal.addEventListener("abort",p);let g=u.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});let w=P=>{if(P.data&&typeof P.data=="string")try{let R=JSON.parse(P.data);if(R.type==="verify_attestation"){if(Oi(R.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",w),f(R.attestation===null?"":R.attestation)}}catch(R){this.logger.warn(R)}};u.body.appendChild(g),window.addEventListener("message",w,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(u){this.logger.warn(u)}return""}),ke(this,"resolve",async s=>{if(this.isDevEnv)return"";let{attestationId:i,hash:o,encryptedId:a}=s;if(i===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(i){if(Oi(i).payload.id!==a)return;let u=await this.isValidJwtAttestation(i);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;let c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)}),ke(this,"fetchAttestation",async(s,i)=>{this.logger.debug(`resolving attestation: ${s} from url: ${i}`);let o=this.startAbortTimer(X.ONE_SECOND*5),a=await fetch(`${i}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),ke(this,"getVerifyUrl",s=>{let i=s||ii;return xD.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${ii}`),i=ii),i}),ke(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let s=this.startAbortTimer(X.FIVE_SECONDS),i=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await i.json()}catch(s){this.logger.warn(s)}}),ke(this,"persistPublicKey",async s=>{this.logger.debug(s,"persisting public key to local storage"),await this.store.setItem(this.storeKey,s),this.publicKey=s}),ke(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),ke(this,"isValidJwtAttestation",async s=>{let i=await this.getPublicKey();try{if(i)return this.validateAttestation(s,i)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),ke(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),ke(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async i=>{let o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),i(o))});let s=await this.fetchPromise;return this.fetchPromise=void 0,s}),ke(this,"validateAttestation",(s,i)=>{let o=cb(s,i.publicKey),a={hasExpired:(0,X.toMiliseconds)(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Ct(r,this.name),this.abortController=new AbortController,this.isDevEnv=ao(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return vt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,X.toMiliseconds)(e))}},s6=Object.defineProperty,i6=(t,e,r)=>e in t?s6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,b1=(t,e,r)=>i6(t,typeof e!="symbol"?e+"":e,r),dd=class extends ra{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,b1(this,"context",SD),b1(this,"registerDeviceToken",async n=>{let{clientId:s,token:i,notificationType:o,enableEncrypted:a=!1}=n,c=`${ID}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:i,always_raw:a})})}),this.logger=Ct(r,this.context)}},o6=Object.defineProperty,v1=Object.getOwnPropertySymbols,a6=Object.prototype.hasOwnProperty,c6=Object.prototype.propertyIsEnumerable,pd=(t,e,r)=>e in t?o6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_o=(t,e)=>{for(var r in e||(e={}))a6.call(e,r)&&pd(t,r,e[r]);if(v1)for(var r of v1(e))c6.call(e,r)&&pd(t,r,e[r]);return t},Ye=(t,e,r)=>pd(t,typeof e!="symbol"?e+"":e,r),gd=class extends na{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,Ye(this,"context",AD),Ye(this,"storagePrefix",Fr),Ye(this,"storageVersion",_D),Ye(this,"events",new Map),Ye(this,"shouldPersist",!1),Ye(this,"init",async()=>{if(!ao())try{let s={eventId:rf(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:ef(this.core.relayer.protocol,this.core.relayer.version,$f)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),Ye(this,"createEvent",s=>{let{event:i="ERROR",type:o="",properties:{topic:a,trace:c}}=s,u=rf(),l=this.core.projectId||"",h=Date.now(),f=_o({eventId:u,timestamp:h,props:{event:i,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,f),this.shouldPersist=!0),f}),Ye(this,"getEvent",s=>{let{eventId:i,topic:o}=s;if(i)return this.events.get(i);let a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return _o(_o({},a),this.setMethods(a.eventId))}),Ye(this,"deleteEvent",s=>{let{eventId:i}=s;this.events.delete(i),this.shouldPersist=!0}),Ye(this,"setEventListeners",()=>{this.core.heartbeat.on(ln.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{(0,X.fromMiliseconds)(Date.now())-(0,X.fromMiliseconds)(s.timestamp)>TD&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),Ye(this,"setMethods",s=>({addTrace:i=>this.addTrace(s,i),setError:i=>this.setError(s,i)})),Ye(this,"addTrace",(s,i)=>{let o=this.events.get(s);o&&(o.props.properties.trace.push(i),this.events.set(s,o),this.shouldPersist=!0)}),Ye(this,"setError",(s,i)=>{let o=this.events.get(s);o&&(o.props.type=i,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),Ye(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ye(this,"restore",async()=>{try{let s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(i=>{this.events.set(i.eventId,_o(_o({},i),this.setMethods(i.eventId)))})}catch(s){this.logger.warn(s)}}),Ye(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;let s=[];for(let[i,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(let i of s)this.events.delete(i.eventId),this.shouldPersist=!0}catch(i){this.logger.warn(i)}}),Ye(this,"sendEvent",async s=>{let i=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${CD}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${$f}${i}`,{method:"POST",body:JSON.stringify(s)})}),Ye(this,"getAppDomain",()=>Qh().url),this.logger=Ct(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}},u6=Object.defineProperty,E1=Object.getOwnPropertySymbols,l6=Object.prototype.hasOwnProperty,h6=Object.prototype.propertyIsEnumerable,md=(t,e,r)=>e in t?u6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,x1=(t,e)=>{for(var r in e||(e={}))l6.call(e,r)&&md(t,r,e[r]);if(E1)for(var r of E1(e))h6.call(e,r)&&md(t,r,e[r]);return t},Ee=(t,e,r)=>md(t,typeof e!="symbol"?e+"":e,r),yd=class t extends Wo{constructor(e){var r;super(e),Ee(this,"protocol",I1),Ee(this,"version",_1),Ee(this,"name",zc),Ee(this,"relayUrl"),Ee(this,"projectId"),Ee(this,"customStoragePrefix"),Ee(this,"events",new an.EventEmitter),Ee(this,"logger"),Ee(this,"heartbeat"),Ee(this,"relayer"),Ee(this,"crypto"),Ee(this,"storage"),Ee(this,"history"),Ee(this,"expirer"),Ee(this,"pairing"),Ee(this,"verify"),Ee(this,"echoClient"),Ee(this,"linkModeSupportedApps"),Ee(this,"eventClient"),Ee(this,"initialized",!1),Ee(this,"logChunkController"),Ee(this,"on",(a,c)=>this.events.on(a,c)),Ee(this,"once",(a,c)=>this.events.once(a,c)),Ee(this,"off",(a,c)=>this.events.off(a,c)),Ee(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),Ee(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;let l={topic:a,message:c,publishedAt:Date.now(),transportType:xe.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});let n=this.getGlobalCore(e?.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||A1,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";let s=dp({level:typeof e?.logger=="string"&&e.logger?e.logger:YC.logger,name:zc}),{logger:i,chunkLoggerController:o}=Ro({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ct(i,this.name),this.heartbeat=new zo,this.crypto=new Zf(this,this.logger,e?.keychain),this.history=new ld(this,this.logger),this.expirer=new hd(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Ko(x1(x1({},JC),e?.storageOptions)),this.relayer=new ad({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new ud(this,this.logger),this.verify=new fd(this,this.logger,this.storage),this.echoClient=new dd(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new gd(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){let r=new t(e);await r.initialize();let n=await r.crypto.getClientId();return await r.storage.setItem(lD,n),r}get context(){return vt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(e1,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(e1)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;let n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}},M1=yd;var ie=Be(As(),1);var z1="wc",H1=2,V1="client",Rd=`${z1}@${H1}:${V1}:`,bd={name:V1,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"};var q1="WALLETCONNECT_DEEPLINK_CHOICE";var f6="proposal";var j1="Proposal expired",d6="session",ai=ie.SEVEN_DAYS,p6="engine",rt={wc_sessionPropose:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1114},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:ie.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:ie.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1119}}},vd={min:ie.FIVE_MINUTES,max:ie.SEVEN_DAYS},Mr={idle:"IDLE",active:"ACTIVE"},g6={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},m6="request",y6=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],w6="wc";var b6="auth",v6="authKeys",E6="pairingTopics",x6="requests",Wc=`${w6}@${1.5}:${b6}:`,Vc=`${Wc}:PUB_KEY`,S6=Object.defineProperty,I6=Object.defineProperties,_6=Object.getOwnPropertyDescriptors,$1=Object.getOwnPropertySymbols,A6=Object.prototype.hasOwnProperty,T6=Object.prototype.propertyIsEnumerable,xd=(t,e,r)=>e in t?S6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ge=(t,e)=>{for(var r in e||(e={}))A6.call(e,r)&&xd(t,r,e[r]);if($1)for(var r of $1(e))T6.call(e,r)&&xd(t,r,e[r]);return t},yt=(t,e)=>I6(t,_6(e)),q=(t,e,r)=>xd(t,typeof e!="symbol"?e+"":e,r),Sd=class extends ia{constructor(e){super(e),q(this,"name",p6),q(this,"events",new Kc.default),q(this,"initialized",!1),q(this,"requestQueue",{state:Mr.idle,queue:[]}),q(this,"sessionRequestQueue",{state:Mr.idle,queue:[]}),q(this,"emittedSessionRequests",new uc({limit:500})),q(this,"requestQueueDelay",ie.ONE_SECOND),q(this,"expectedPairingMethodMap",new Map),q(this,"recentlyDeletedMap",new Map),q(this,"recentlyDeletedLimit",200),q(this,"relayMessageCache",[]),q(this,"pendingSessions",new Map),q(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(rt)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,ie.toMiliseconds)(this.requestQueueDelay)))}),q(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let n=yt(ge({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n),n.optionalNamespaces=ub(n.requiredNamespaces,n.optionalNamespaces),n.requiredNamespaces={};let{pairingTopic:s,requiredNamespaces:i,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=n,l=s,h,f=!1;try{if(l){let B=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),f=B.active}}catch(B){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),B}if(!l||!f){let{topic:B,uri:k}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});l=B,h=k}if(!l){let{message:B}=$("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(B)}let d=await this.client.core.crypto.generateKeyPair(),p=rt.wc_sessionPropose.req.ttl||ie.FIVE_MINUTES,g=Ae(p),w=yt(ge(ge({requiredNamespaces:i,optionalNamespaces:o,relays:u??[{protocol:wd}],proposer:{publicKey:d,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:l},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:nr()}),P=he("session_connect",w.id),{reject:R,resolve:x,done:I}=rn(p,j1),C=({id:B})=>{B===w.id&&(this.client.events.off("proposal_expire",C),this.pendingSessions.delete(w.id),this.events.emit(P,{error:{message:j1,code:0}}))};return this.client.events.on("proposal_expire",C),this.events.once(P,({error:B,session:k})=>{this.client.events.off("proposal_expire",C),B?R(B):k&&x(k)}),await this.sendProposeSession({proposal:w,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:w.id}}}),await this.setProposal(w.id,w),{uri:h,approval:I}}),q(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(n){throw this.client.logger.error("pair() failed"),n}}),q(this,"approve",async r=>{var n,s,i;let o=this.client.core.eventClient.createEvent({properties:{topic:(n=r?.id)==null?void 0:n.toString(),trace:[ar.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(N){throw o.setError(Mn.no_internet_connection),N}try{await this.isValidProposalId(r?.id)}catch(N){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(Mn.proposal_not_found),N}try{await this.isValidApprove(r)}catch(N){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Mn.session_approve_namespace_validation_failure),N}let{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:f}=r,d=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});let{pairingTopic:p,proposer:g,requiredNamespaces:w,optionalNamespaces:P}=d,R=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:p});R||(R=(i=this.client.core.eventClient)==null?void 0:i.createEvent({type:ar.session_approve_started,properties:{topic:p,trace:[ar.session_approve_started,ar.session_namespaces_validation_success]}}));let x=await this.client.core.crypto.generateKeyPair(),I=g.publicKey,C=await this.client.core.crypto.generateSharedKey(x,I),B=ge(ge(ge({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:x,metadata:this.client.metadata},expiry:Ae(ai)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),k=xe.relay;R.addTrace(ar.subscribing_session_topic);try{await this.client.core.relayer.subscribe(C,{transportType:k,internal:{skipSubscribe:!0}})}catch(N){throw R.setError(Mn.subscribe_session_topic_failure),N}R.addTrace(ar.subscribe_session_topic_success);let U=yt(ge({},B),{topic:C,requiredNamespaces:w,optionalNamespaces:P,pairingTopic:p,acknowledged:!1,self:B.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:x,transportType:xe.relay});await this.client.session.set(C,U),R.addTrace(ar.store_session);try{await this.sendApproveSession({sessionTopic:C,proposal:d,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:x},sessionSettleRequest:B,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),R.addTrace(ar.session_approve_publish_success)}catch(N){throw this.client.logger.error(N),this.client.session.delete(C,we("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(C),N}return this.client.core.eventClient.deleteEvent({eventId:R.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(C,Ae(ai)),{topic:C,acknowledged:()=>Promise.resolve(this.client.session.get(C))}}),q(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}let{id:n,reason:s}=r,i;try{i=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}i&&await this.sendError({id:n,topic:i,error:s,rpcOpts:rt.wc_sessionPropose.reject}),await this.deleteProposal(n)}),q(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}let{topic:n,namespaces:s}=r,{done:i,resolve:o,reject:a}=rn(),c=nr(),u=sr().toString(),l=this.client.session.get(n).namespaces;return this.events.once(he("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(n,{namespaces:s}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(h=>{this.client.logger.error(h),this.client.session.update(n,{namespaces:l}),a(h)}),{acknowledged:i}}),q(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}let{topic:n}=r,s=nr(),{done:i,resolve:o,reject:a}=rn();return this.events.once(he("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,Ae(ai)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:i}}),q(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}let{chainId:n,request:s,topic:i,expiry:o=rt.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(i);a?.transportType===xe.relay&&await this.confirmOnlineStateOrThrow();let c=nr(),u=sr().toString(),{done:l,resolve:h,reject:f}=rn(o,"Request expired. Please try again.");this.events.once(he("session_request",c),({error:w,result:P})=>{w?f(w):h(P)});let d="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:i,method:d,params:{request:yt(ge({},s),{expiryTimestamp:Ae(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(w=>f(w)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),await l();let g={request:yt(ge({},s),{expiryTimestamp:Ae(o)}),chainId:n};return await Promise.all([new Promise(async w=>{await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:i,method:d,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(P=>f(P)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),w()}),new Promise(async w=>{var P;if(!((P=a.sessionConfig)!=null&&P.disableDeepLink)){let R=await tw(this.client.core.storage,q1);await ew({id:c,topic:i,wcDeepLink:R})}w()}),l()]).then(w=>w[2])}),q(this,"respond",async r=>{var n,s;this.isInitialized();let i=this.client.core.eventClient.createEvent({properties:{topic:r?.topic||((s=(n=r?.response)==null?void 0:n.id)==null?void 0:s.toString()),trace:[ar.session_request_response_started]}});try{await this.isValidRespond(r)}catch(h){throw i.addTrace(h?.message),i.setError(Mn.session_request_response_validation_failure),h}i.addTrace(ar.session_request_response_validation_success);let{topic:o,response:a}=r,{id:c}=a,u=this.client.session.get(o);u.transportType===xe.relay&&await this.confirmOnlineStateOrThrow();let l=this.getAppLinkIfEnabled(u.peer.metadata,u.transportType);try{i.addTrace(ar.session_request_response_publish_started),Wt(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:l}):gt(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:l}),this.cleanupAfterResponse(r)}catch(h){throw i.addTrace(h?.message),i.setError(Mn.session_request_response_publish_failure),h}}),q(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}let{topic:n}=r;if(this.client.session.keys.includes(n)){let s=nr(),i=sr().toString(),{done:o,resolve:a,reject:c}=rn();this.events.once(he("session_ping",s),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:i}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),q(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);let{topic:n,event:s,chainId:i}=r,o=sr().toString(),a=nr();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:s,chainId:i},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),q(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);let{topic:n}=r;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:we("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{let{message:s}=$("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(s)}}),q(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(n=>lb(n,r)))),q(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),q(this,"authenticate",async(r,n)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);let i=n&&this.client.core.linkModeSupportedApps.includes(n)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=i?xe.link_mode:xe.relay;o===xe.relay&&await this.confirmOnlineStateOrThrow();let{chains:a,statement:c="",uri:u,domain:l,nonce:h,type:f,exp:d,nbf:p,methods:g=[],expiry:w}=r,P=[...r.resources||[]],{topic:R,uri:x}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:R,uri:x}});let I=await this.client.core.crypto.generateKeyPair(),C=Zs(I);if(await Promise.all([this.client.auth.authKeys.set(Vc,{responseTopic:C,publicKey:I}),this.client.auth.pairingTopics.set(C,{topic:C,pairingTopic:R})]),await this.client.core.relayer.subscribe(C,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${R}`),g.length>0){let{namespace:S}=Er(a[0]),T=Ew(S,"request",g);lo(P)&&(T=xw(T,P.pop())),P.push(T)}let B=w&&w>rt.wc_sessionAuthenticate.req.ttl?w:rt.wc_sessionAuthenticate.req.ttl,k={authPayload:{type:f??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:d,nbf:p,resources:P},requester:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:Ae(B)},U={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},N={requiredNamespaces:{},optionalNamespaces:U,relays:[{protocol:"irn"}],pairingTopic:R,proposer:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:Ae(rt.wc_sessionPropose.req.ttl),id:nr()},{done:j,resolve:b,reject:E}=rn(B,"Request expired"),v=nr(),A=he("session_connect",N.id),y=he("session_request",v),m=async({error:S,session:T})=>{this.events.off(y,_),S?E(S):T&&b({session:T})},_=async S=>{var T,F,L;if(await this.deletePendingAuthRequest(v,{message:"fulfilled",code:0}),S.error){let Y=we("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return S.error.code===Y.code?void 0:(this.events.off(A,m),E(S.error.message))}await this.deleteProposal(N.id),this.events.off(A,m);let{cacaos:K,responder:H}=S.result,z=[],G=[];for(let Y of K){await lf({cacao:Y,projectId:this.client.core.projectId})||(this.client.logger.error(Y,"Signature verification failed"),E(we("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:se}=Y,_e=lo(se.resources),Fe=[Sc(se.iss)],$e=uo(se.iss);if(_e){let bt=ff(_e),Dr=df(_e);z.push(...bt),Fe.push(...Dr)}for(let bt of Fe)G.push(`${bt}:${$e}`)}let J=await this.client.core.crypto.generateSharedKey(I,H.publicKey),ne;z.length>0&&(ne={topic:J,acknowledged:!0,self:{publicKey:I,metadata:this.client.metadata},peer:H,controller:H.publicKey,expiry:Ae(ai),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:R,namespaces:If([...new Set(z)],[...new Set(G)]),transportType:o},await this.client.core.relayer.subscribe(J,{transportType:o}),await this.client.session.set(J,ne),R&&await this.client.core.pairing.updateMetadata({topic:R,metadata:H.metadata}),ne=this.client.session.get(J)),(T=this.client.metadata.redirect)!=null&&T.linkMode&&(F=H.metadata.redirect)!=null&&F.linkMode&&(L=H.metadata.redirect)!=null&&L.universal&&n&&(this.client.core.addLinkModeSupportedApp(H.metadata.redirect.universal),this.client.session.update(J,{transportType:xe.link_mode})),b({auths:K,session:ne})};this.events.once(A,m),this.events.once(y,_);let O;try{if(i){let S=pt("wc_sessionAuthenticate",k,v);this.client.core.history.set(R,S);let T=await this.client.core.crypto.encode("",S,{type:Xs,encoding:nn});O=go(n,R,T)}else await Promise.all([this.sendRequest({topic:R,method:"wc_sessionAuthenticate",params:k,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:v}),this.sendRequest({topic:R,method:"wc_sessionPropose",params:N,expiry:rt.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:N.id})])}catch(S){throw this.events.off(A,m),this.events.off(y,_),S}return await this.setProposal(N.id,N),await this.setAuthRequest(v,{request:yt(ge({},k),{verifyContext:{}}),pairingTopic:R,transportType:o}),{uri:O??x,response:j}}),q(this,"approveSessionAuthenticate",async r=>{let{id:n,auths:s}=r,i=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[qn.authenticated_session_approve_started]}});try{this.isInitialized()}catch(w){throw i.setError(oi.no_internet_connection),w}let o=this.getPendingAuthRequest(n);if(!o)throw i.setError(oi.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);let a=o.transportType||xe.relay;a===xe.relay&&await this.confirmOnlineStateOrThrow();let c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=Zs(c),h={type:Sr,receiverPublicKey:c,senderPublicKey:u},f=[],d=[];for(let w of s){if(!await lf({cacao:w,projectId:this.client.core.projectId})){i.setError(oi.invalid_cacao);let C=we("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:l,error:C,encodeOpts:h}),new Error(C.message)}i.addTrace(qn.cacaos_verified);let{p:P}=w,R=lo(P.resources),x=[Sc(P.iss)],I=uo(P.iss);if(R){let C=ff(R),B=df(R);f.push(...C),x.push(...B)}for(let C of x)d.push(`${C}:${I}`)}let p=await this.client.core.crypto.generateSharedKey(u,c);i.addTrace(qn.create_authenticated_session_topic);let g;if(f?.length>0){g={topic:p,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Ae(ai),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:If([...new Set(f)],[...new Set(d)]),transportType:a},i.addTrace(qn.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(w){throw i.setError(oi.subscribe_authenticated_session_topic_failure),w}i.addTrace(qn.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),i.addTrace(qn.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}i.addTrace(qn.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:n,result:{cacaos:s,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(w){throw i.setError(oi.authenticated_session_approve_publish_failure),w}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:g}}),q(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();let{id:n,reason:s}=r,i=this.getPendingAuthRequest(n);if(!i)throw new Error(`Could not find pending auth request with id ${n}`);i.transportType===xe.relay&&await this.confirmOnlineStateOrThrow();let o=i.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Zs(o),u={type:Sr,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:s,encodeOpts:u,rpcOpts:rt.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),q(this,"formatAuthMessage",r=>{this.isInitialized();let{request:n,iss:s}=r;return hf(n,s)}),q(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{let r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),q(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{let n=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(i=>{var o,a;return((o=i.peerMetadata)==null?void 0:o.url)&&((a=i.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&i.topic&&i.topic!==n.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),q(this,"deleteSession",async r=>{var n;let{topic:s,expirerHasDeleted:i=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,we("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),i||this.client.core.expirer.del(s),this.client.core.storage.removeItem(q1).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===s&&this.deletePendingSessionRequest(u.id,we("USER_DISCONNECTED"))}),s===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=Mr.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),q(this,"deleteProposal",async(r,n)=>{if(n)try{let s=this.client.proposal.get(r);this.client.core.eventClient.getEvent({topic:s.pairingTopic})?.setError(Mn.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,we("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),q(this,"deletePendingSessionRequest",async(r,n,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==r),s&&(this.sessionRequestQueue.state=Mr.idle,this.client.events.emit("session_request_expire",{id:r}))}),q(this,"deletePendingAuthRequest",async(r,n,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,n),s?Promise.resolve():this.client.core.expirer.del(r)])}),q(this,"setExpiry",async(r,n)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,n),await this.client.session.update(r,{expiry:n}))}),q(this,"setProposal",async(r,n)=>{this.client.core.expirer.set(r,Ae(rt.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,n)}),q(this,"setAuthRequest",async(r,n)=>{let{request:s,pairingTopic:i,transportType:o=xe.relay}=n;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:i,verifyContext:s.verifyContext,transportType:o})}),q(this,"setPendingSessionRequest",async r=>{let{id:n,topic:s,params:i,verifyContext:o}=r,a=i.request.expiryTimestamp||Ae(rt.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:s,params:i,verifyContext:o})}),q(this,"sendRequest",async r=>{let{topic:n,method:s,params:i,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:h,publishOpts:f={}}=r,d=pt(s,i,c),p,g=!!l;try{let R=g?nn:ft;p=await this.client.core.crypto.encode(n,d,{encoding:R})}catch(R){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),R}let w;if(y6.includes(s)){let R=Ft(JSON.stringify(d)),x=Ft(p);w=await this.client.core.verify.register({id:x,decryptedId:R})}let P=ge(ge({},rt[s].req),f);if(P.attestation=w,o&&(P.ttl=o),a&&(P.id=a),this.client.core.history.set(n,d),g){let R=go(l,n,p);await global.Linking.openURL(R,this.client.name)}else P.tvf=yt(ge({},h),{correlationId:d.id}),u?(P.internal=yt(ge({},P.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,p,P)):this.client.core.relayer.publish(n,p,P).catch(R=>this.client.logger.error(R));return d.id}),q(this,"sendProposeSession",async r=>{let{proposal:n,publishOpts:s}=r,i=pt("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,i);let o=await this.client.core.crypto.encode(n.pairingTopic,i,{encoding:ft}),a=Ft(JSON.stringify(i)),c=Ft(o),u=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:yt(ge({},s),{publishMethod:"wc_proposeSession",attestation:u})})}),q(this,"sendApproveSession",async r=>{let{sessionTopic:n,pairingProposalResponse:s,proposal:i,sessionSettleRequest:o,publishOpts:a}=r,c=sn(i.id,s),u=await this.client.core.crypto.encode(i.pairingTopic,c,{encoding:ft}),l=pt("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(n,l,{encoding:ft});this.client.core.history.set(n,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:i.pairingTopic,sessionProposalResponse:u,sessionSettlementRequest:h},opts:yt(ge({},a),{publishMethod:"wc_approveSession"})})}),q(this,"sendResult",async r=>{let{id:n,topic:s,result:i,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,u=sn(n,i),l,h=c&&typeof(global==null?void 0:global.Linking)<"u";try{let p=h?nn:ft;l=await this.client.core.crypto.encode(s,u,yt(ge({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),p}let f,d;try{f=await this.client.core.history.get(s,n);let p=f.request;try{d=this.getTVFParams(n,p.params,i)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g?.message}`)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${n}) failed`),p}if(h){let p=go(c,s,l);await global.Linking.openURL(p,this.client.name)}else{let p=f.request.method,g=rt[p].res;g.tvf=yt(ge({},d),{correlationId:n}),o?(g.internal=yt(ge({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,l,g)):this.client.core.relayer.publish(s,l,g).catch(w=>this.client.logger.error(w))}await this.client.core.history.resolve(u)}),q(this,"sendError",async r=>{let{id:n,topic:s,error:i,encodeOpts:o,rpcOpts:a,appLink:c}=r,u=on(n,i),l,h=c&&typeof(global==null?void 0:global.Linking)<"u";try{let d=h?nn:ft;l=await this.client.core.crypto.encode(s,u,yt(ge({},o||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),d}let f;try{f=await this.client.core.history.get(s,n)}catch(d){throw this.client.logger.error(`sendError() -> history.get(${s}, ${n}) failed`),d}if(h){let d=go(c,s,l);await global.Linking.openURL(d,this.client.name)}else{let d=f.request.method,p=a||rt[d].res;this.client.core.relayer.publish(s,l,p)}await this.client.core.history.resolve(u)}),q(this,"cleanup",async()=>{let r=[],n=[];this.client.session.getAll().forEach(s=>{let i=!1;Kt(s.expiry)&&(i=!0),this.client.core.crypto.keychain.has(s.topic)||(i=!0),i&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Kt(s.expiryTimestamp)&&n.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...n.map(s=>this.deleteProposal(s))])}),q(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),q(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),q(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Mr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Mr.active;let r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=Mr.idle}),q(this,"processRequest",async r=>{let{topic:n,payload:s,attestation:i,transportType:o,encryptedId:a}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:s,attestation:i,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,s);case"wc_sessionPing":return await this.onSessionPingRequest(n,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),q(this,"onRelayEventResponse",async r=>{let{topic:n,payload:s,transportType:i}=r,o=(await this.client.core.history.get(n,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,s,i);case"wc_sessionSettle":return this.onSessionSettleResponse(n,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,s);case"wc_sessionExtend":return this.onSessionExtendResponse(n,s);case"wc_sessionPing":return this.onSessionPingResponse(n,s);case"wc_sessionRequest":return this.onSessionRequestResponse(n,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),q(this,"onRelayEventUnknownPayload",r=>{let{topic:n}=r,{message:s}=$("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),q(this,"shouldIgnorePairingRequest",r=>{let{topic:n,requestMethod:s}=r,i=this.expectedPairingMethodMap.get(n);return!i||i.includes(s)?!1:!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),q(this,"onSessionProposeRequest",async r=>{let{topic:n,payload:s,attestation:i,encryptedId:o}=r,{params:a,id:c}=s;try{let u=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u?.setError(kr.proposal_listener_not_found)),this.isValidConnect(ge({},s.params));let l=a.expiryTimestamp||Ae(rt.wc_sessionPropose.req.ttl),h=ge({id:c,pairingTopic:n,expiryTimestamp:l,attestation:i,encryptedId:o},a);await this.setProposal(c,h);let f=await this.getVerifyContext({attestationId:i,hash:Ft(JSON.stringify(s)),encryptedId:o,metadata:h.proposer.metadata});u?.addTrace(Ar.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(u){await this.sendError({id:c,topic:n,error:u,rpcOpts:rt.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),q(this,"onSessionProposeResponse",async(r,n,s)=>{let{id:i}=n;if(Wt(n)){let{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});let a=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});let c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});let u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});let l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(i,{sessionTopic:l,pairingTopic:r,proposalId:i,publicKey:c});let h=await this.client.core.relayer.subscribe(l,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(gt(n)){await this.deleteProposal(i);let o=he("session_connect",i);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),q(this,"onSessionSettleRequest",async(r,n)=>{let{id:s,params:i}=n;try{this.isValidSessionSettleRequest(i);let{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:f}=n.params,d=[...this.pendingSessions.values()].find(w=>w.sessionTopic===r);if(!d)return this.client.logger.error(`Pending session not found for topic ${r}`);let p=this.client.proposal.get(d.proposalId),g=yt(ge(ge(ge({topic:r,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:xe.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(he("session_connect",d.proposalId),{session:g}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:n.id,topic:r,result:!0})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),q(this,"onSessionSettleResponse",async(r,n)=>{let{id:s}=n;Wt(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(he("session_approve",s),{})):gt(n)&&(await this.client.session.delete(r,we("USER_DISCONNECTED")),this.events.emit(he("session_approve",s),{error:n.error}))}),q(this,"onSessionUpdateRequest",async(r,n)=>{let{params:s,id:i}=n;try{let o=`${r}_session_update`,a=Rn.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:r,error:we("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ge({topic:r},s));try{Rn.set(o,i),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:i,topic:r,result:!0})}catch(c){throw Rn.delete(o),c}this.client.events.emit("session_update",{id:i,topic:r,params:s})}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),q(this,"isRequestOutOfSync",(r,n)=>n.toString().slice(0,-3)<r.toString().slice(0,-3)),q(this,"onSessionUpdateResponse",(r,n)=>{let{id:s}=n,i=he("session_update",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Wt(n)?this.events.emit(he("session_update",s),{}):gt(n)&&this.events.emit(he("session_update",s),{error:n.error})}),q(this,"onSessionExtendRequest",async(r,n)=>{let{id:s}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ae(ai)),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(i){await this.sendError({id:s,topic:r,error:i}),this.client.logger.error(i)}}),q(this,"onSessionExtendResponse",(r,n)=>{let{id:s}=n,i=he("session_extend",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Wt(n)?this.events.emit(he("session_extend",s),{}):gt(n)&&this.events.emit(he("session_extend",s),{error:n.error})}),q(this,"onSessionPingRequest",async(r,n)=>{let{id:s}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(i){await this.sendError({id:s,topic:r,error:i}),this.client.logger.error(i)}}),q(this,"onSessionPingResponse",(r,n)=>{let{id:s}=n,i=he("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners 2176`);Wt(n)?this.events.emit(he("session_ping",s),{}):gt(n)&&this.events.emit(he("session_ping",s),{error:n.error})},500)}),q(this,"onSessionDeleteRequest",async(r,n)=>{let{id:s}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(i=>{this.client.core.relayer.once(Pe.publish,async()=>{i(await this.deleteSession({topic:r,id:s}))})}),this.sendResult({id:s,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:we("USER_DISCONNECTED")})]).catch(i=>this.client.logger.error(i))}catch(i){this.client.logger.error(i)}}),q(this,"onSessionRequest",async r=>{var n,s,i;let{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=r,{id:h,params:f}=a;try{await this.isValidRequest(ge({topic:o},f));let d=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:Ft(JSON.stringify(pt("wc_sessionRequest",f,h))),encryptedId:u,metadata:d.peer.metadata,transportType:l}),g={id:h,topic:o,params:f,verifyContext:p};await this.setPendingSessionRequest(g),l===xe.link_mode&&(n=d.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((s=d.peer.metadata.redirect)==null?void 0:s.universal),(i=this.client.signConfig)!=null&&i.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(d){await this.sendError({id:h,topic:o,error:d}),this.client.logger.error(d)}}),q(this,"onSessionRequestResponse",(r,n)=>{let{id:s}=n,i=he("session_request",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Wt(n)?this.events.emit(he("session_request",s),{result:n.result}):gt(n)&&this.events.emit(he("session_request",s),{error:n.error})}),q(this,"onSessionEventRequest",async(r,n)=>{let{id:s,params:i}=n;try{let o=`${r}_session_event_${i.event.name}`,a=Rn.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(ge({topic:r},i)),this.client.events.emit("session_event",{id:s,topic:r,params:i}),Rn.set(o,s)}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),q(this,"onSessionAuthenticateResponse",(r,n)=>{let{id:s}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:n}),Wt(n)?this.events.emit(he("session_request",s),{result:n.result}):gt(n)&&this.events.emit(he("session_request",s),{error:n.error})}),q(this,"onSessionAuthenticateRequest",async r=>{var n;let{topic:s,payload:i,attestation:o,encryptedId:a,transportType:c}=r;try{let{requester:u,authPayload:l,expiryTimestamp:h}=i.params,f=await this.getVerifyContext({attestationId:o,hash:Ft(JSON.stringify(i)),encryptedId:a,metadata:u.metadata,transportType:c}),d={requester:u,pairingTopic:s,id:i.id,authPayload:l,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(i.id,{request:d,pairingTopic:s,transportType:c}),c===xe.link_mode&&(n=u.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:i.params,id:i.id,verifyContext:f})}catch(u){this.client.logger.error(u);let l=i.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(i.params.requester.metadata,c),d={type:Sr,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:i.id,topic:s,error:u,encodeOpts:d,rpcOpts:rt.wc_sessionAuthenticate.autoReject,appLink:f})}}),q(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),q(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Mr.idle,this.processSessionRequestQueue()},(0,ie.toMiliseconds)(this.requestQueueDelay))}),q(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:n})=>{let s=this.client.core.history.pending;s.length>0&&s.filter(i=>i.topic===r&&i.request.method==="wc_sessionRequest").forEach(i=>{let o=i.request.id,a=he("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(he("session_request",i.request.id),{error:n})})}),q(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Mr.active){this.client.logger.info("session request queue is already active.");return}let r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(n){this.client.logger.error(n)}}),q(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=Mr.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),q(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;let n=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);n&&this.onSessionProposeRequest({topic:r.topic,payload:pt("wc_sessionPropose",yt(ge({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),q(this,"isValidConnect",async r=>{if(!dt(r)){let{message:u}=$("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}let{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:i,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Ne(n)||await this.isValidPairingTopic(n),!yb(c,!0)){let{message:u}=$("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(s&&!Ne(s)&&rr(s)!==0){let u="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(u):this.client.logger.warn(u),this.validateNamespaces(s,"requiredNamespaces")}if(i&&!Ne(i)&&rr(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),o&&!Ne(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ne(a)){this.validateSessionProps(a,"scopedProperties");let u=Object.keys(s||{}).concat(Object.keys(i||{}));if(!Object.keys(a).every(l=>u.includes(l.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),q(this,"validateNamespaces",(r,n)=>{let s=mb(r,"connect()",n);if(s)throw new Error(s.message)}),q(this,"isValidApprove",async r=>{if(!dt(r))throw new Error($("MISSING_OR_INVALID",`approve() params: ${r}`).message);let{id:n,namespaces:s,relayProtocol:i,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);let c=this.client.proposal.get(n),u=Dc(s,"approve()");if(u)throw new Error(u.message);let l=Cf(c.requiredNamespaces,s,"approve()");if(l)throw new Error(l.message);if(!Oe(i,!0)){let{message:h}=$("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}if(o&&!Ne(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ne(a)){this.validateSessionProps(a,"scopedProperties");let h=new Set(Object.keys(s));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),q(this,"isValidReject",async r=>{if(!dt(r)){let{message:i}=$("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(i)}let{id:n,reason:s}=r;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!bb(s)){let{message:i}=$("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(i)}}),q(this,"isValidSessionSettleRequest",r=>{if(!dt(r)){let{message:u}=$("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(u)}let{relay:n,controller:s,namespaces:i,expiry:o}=r;if(!Af(n)){let{message:u}=$("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}let a=pb(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);let c=Dc(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Kt(o)){let{message:u}=$("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),q(this,"isValidUpdate",async r=>{if(!dt(r)){let{message:c}=$("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}let{topic:n,namespaces:s}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);let i=this.client.session.get(n),o=Dc(s,"update()");if(o)throw new Error(o.message);let a=Cf(i.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),q(this,"isValidExtend",async r=>{if(!dt(r)){let{message:s}=$("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}let{topic:n}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),q(this,"isValidRequest",async r=>{if(!dt(r)){let{message:c}=$("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}let{topic:n,request:s,chainId:i,expiry:o}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);let{namespaces:a}=this.client.session.get(n);if(!Tf(a,i)){let{message:c}=$("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(c)}if(!vb(s)){let{message:c}=$("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!Sb(a,i,s.method)){let{message:c}=$("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!_b(o,vd)){let{message:c}=$("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${vd.min} and ${vd.max}`);throw new Error(c)}}),q(this,"isValidRespond",async r=>{var n;if(!dt(r)){let{message:a}=$("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}let{topic:s,response:i}=r;try{await this.isValidSessionTopic(s)}catch(a){throw(n=r?.response)!=null&&n.id&&this.cleanupAfterResponse(r),a}if(!Eb(i)){let{message:a}=$("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(a)}let o=this.client.pendingRequest.get(i.id);if(o.topic!==s){let{message:a}=$("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${i.id}, expected topic: ${o.topic}, received topic: ${s}`);throw new Error(a)}}),q(this,"isValidPing",async r=>{if(!dt(r)){let{message:s}=$("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}let{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),q(this,"isValidEmit",async r=>{if(!dt(r)){let{message:a}=$("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}let{topic:n,event:s,chainId:i}=r;await this.isValidSessionTopic(n);let{namespaces:o}=this.client.session.get(n);if(!Tf(o,i)){let{message:a}=$("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(a)}if(!xb(s)){let{message:a}=$("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!Ib(o,i,s.name)){let{message:a}=$("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),q(this,"isValidDisconnect",async r=>{if(!dt(r)){let{message:s}=$("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}let{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),q(this,"isValidAuthenticate",r=>{let{chains:n,uri:s,domain:i,nonce:o}=r;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!Oe(s,!1))throw new Error("uri is required parameter");if(!Oe(i,!1))throw new Error("domain is required parameter");if(!Oe(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>Er(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:a}=Er(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),q(this,"getVerifyContext",async r=>{let{attestationId:n,hash:s,encryptedId:i,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||ii,validation:"UNKNOWN",origin:o.url||""}};try{if(a===xe.link_mode){let l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}let u=await this.client.core.verify.resolve({attestationId:n,hash:s,encryptedId:i,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),q(this,"validateSessionProps",(r,n)=>{Object.values(r).forEach((s,i)=>{if(s==null){let{message:o}=$("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${s} for key ${Object.keys(r)[i]}`);throw new Error(o)}})}),q(this,"getPendingAuthRequest",r=>{let n=this.client.auth.requests.get(r);return typeof n=="object"?n:void 0}),q(this,"addToRecentlyDeleted",(r,n)=>{if(this.recentlyDeletedMap.set(r,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0,i=this.recentlyDeletedLimit/2;for(let o of this.recentlyDeletedMap.keys()){if(s++>=i)break;this.recentlyDeletedMap.delete(o)}}}),q(this,"checkRecentlyDeleted",r=>{let n=this.recentlyDeletedMap.get(r);if(n){let{message:s}=$("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${r}`);throw new Error(s)}}),q(this,"isLinkModeEnabled",(r,n)=>{var s,i,o,a,c,u,l,h,f;return!r||n!==xe.link_mode?!1:((i=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:i.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=r?.redirect)==null?void 0:l.universal)!==void 0&&((h=r?.redirect)==null?void 0:h.universal)!==""&&((f=r?.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),q(this,"getAppLinkIfEnabled",(r,n)=>{var s;return this.isLinkModeEnabled(r,n)?(s=r?.redirect)==null?void 0:s.universal:void 0}),q(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;let n=tf(r,"topic")||"",s=decodeURIComponent(tf(r,"wc_ev")||""),i=this.client.session.keys.includes(n);i&&this.client.session.update(n,{transportType:xe.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:s,sessionExists:i})}),q(this,"registerLinkModeListeners",async()=>{var r;if(ao()||tn()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){let n=global==null?void 0:global.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);let s=await n.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),q(this,"getTVFParams",(r,n,s)=>{var i,o,a;if(!((i=n.request)!=null&&i.method))return{};let c={correlationId:r,rpcMethods:[n.request.method],chainId:n.chainId};try{let u=this.extractTxHashesFromResult(n.request,s);c.txHashes=u,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(u){this.client.logger.warn(u,"Error getting TVF params")}return c}),q(this,"isValidContractData",r=>{var n;if(!r)return!1;try{let s=r?.data||((n=r?.[0])==null?void 0:n.data);if(!s.startsWith("0x"))return!1;let i=s.slice(2);return/^[0-9a-fA-F]*$/.test(i)?i.length%2===0:!1}catch{}return!1}),q(this,"extractTxHashesFromResult",(r,n)=>{var s;try{if(!n)return[];let i=r.method,o=g6[i];if(i==="sui_signTransaction")return[yw(n.transactionBytes)];if(i==="near_signTransaction")return[af(n)];if(i==="near_signTransactions")return n.map(c=>af(c));if(i==="xrpl_signTransactionFor"||i==="xrpl_signTransaction")return[(s=n.tx_json)==null?void 0:s.hash];if(i==="polkadot_signTransaction")return[Cb({transaction:r.params.transactionPayload,signature:n.signature})];if(i==="algo_signTxn")return Ir(n)?n.map(c=>cf(c)):[cf(n)];if(i==="cosmos_signDirect")return[ww(n)];if(i==="wallet_sendCalls")return bw(n);if(typeof n=="string")return[n];let a=n[o.key];if(Ir(a))return i==="solana_signAllTransactions"?a.map(c=>mw(c)):a;if(typeof a=="string")return[a]}catch(i){this.client.logger.warn(i,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(let[n,s]of Object.entries(r))for(let i of s)try{await this.onProviderMessageEvent({topic:n,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${i}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){let{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Pe.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:r,message:n,attestation:s,transportType:i}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Vc)?this.client.auth.authKeys.get(Vc):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(r,n,{receiverPublicKey:o,encoding:i===xe.link_mode?nn:ft});ri(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:s,transportType:i,encryptedId:Ft(n)})):Fn(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:i}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:i}),await this.client.core.relayer.messages.ack(r,n)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Jt.expired,async e=>{let{topic:r,id:n}=bc(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,$("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,$("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ln.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Ln.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Oe(e,!1)){let{message:r}=$("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:r}=$("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Kt(this.client.core.pairing.pairings.get(e).expiry)){let{message:r}=$("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Oe(e,!1)){let{message:r}=$("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:r}=$("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Kt(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:r}=$("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){let{message:r}=$("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Oe(e,!1)){let{message:r}=$("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{let{message:r}=$("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!wb(e)){let{message:r}=$("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){let{message:r}=$("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Kt(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:r}=$("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}},Id=class extends Lr{constructor(e,r){super(e,r,f6,Rd),this.core=e,this.logger=r}},_d=class extends Lr{constructor(e,r){super(e,r,d6,Rd),this.core=e,this.logger=r}},Ad=class extends Lr{constructor(e,r){super(e,r,m6,Rd,n=>n.id),this.core=e,this.logger=r}},Td=class extends Lr{constructor(e,r){super(e,r,v6,Wc,()=>Vc),this.core=e,this.logger=r}},Cd=class extends Lr{constructor(e,r){super(e,r,E6,Wc),this.core=e,this.logger=r}},Dd=class extends Lr{constructor(e,r){super(e,r,x6,Wc,n=>n.id),this.core=e,this.logger=r}},C6=Object.defineProperty,D6=(t,e,r)=>e in t?C6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ed=(t,e,r)=>D6(t,typeof e!="symbol"?e+"":e,r),Od=class{constructor(e,r){this.core=e,this.logger=r,Ed(this,"authKeys"),Ed(this,"pairingTopics"),Ed(this,"requests"),this.authKeys=new Td(this.core,this.logger),this.pairingTopics=new Cd(this.core,this.logger),this.requests=new Dd(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}},O6=Object.defineProperty,P6=(t,e,r)=>e in t?O6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ae=(t,e,r)=>P6(t,typeof e!="symbol"?e+"":e,r),Pd=class t extends sa{constructor(e){super(e),ae(this,"protocol",z1),ae(this,"version",H1),ae(this,"name",bd.name),ae(this,"metadata"),ae(this,"core"),ae(this,"logger"),ae(this,"events",new Kc.EventEmitter),ae(this,"engine"),ae(this,"session"),ae(this,"proposal"),ae(this,"pendingRequest"),ae(this,"auth"),ae(this,"signConfig"),ae(this,"on",(n,s)=>this.events.on(n,s)),ae(this,"once",(n,s)=>this.events.once(n,s)),ae(this,"off",(n,s)=>this.events.off(n,s)),ae(this,"removeListener",(n,s)=>this.events.removeListener(n,s)),ae(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),ae(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"update",async n=>{try{return await this.engine.update(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"request",async n=>{try{return await this.engine.request(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"find",n=>{try{return this.engine.find(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),ae(this,"authenticate",async(n,s)=>{try{return await this.engine.authenticate(n,s)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),this.name=e?.name||bd.name,this.metadata=Y0(e?.metadata),this.signConfig=e?.signConfig;let r=ti({logger:e?.logger||bd.logger,name:this.name});this.logger=r,this.core=e?.core||new M1(e),this.session=new _d(this.core,this.logger),this.proposal=new Id(this.core,this.logger),this.pendingRequest=new Ad(this.core,this.logger),this.engine=new Sd(this),this.auth=new Od(this.core,this.logger)}static async init(e){let r=new t(e);return await r.initialize(),r}get context(){return vt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var K1=Pd;var tv=Be(qr()),Nd=Be(G1());var R6=Object.defineProperty,N6=Object.defineProperties,B6=Object.getOwnPropertyDescriptors,Y1=Object.getOwnPropertySymbols,U6=Object.prototype.hasOwnProperty,k6=Object.prototype.propertyIsEnumerable,J1=(t,e,r)=>e in t?R6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,X1=(t,e)=>{for(var r in e||(e={}))U6.call(e,r)&&J1(t,r,e[r]);if(Y1)for(var r of Y1(e))k6.call(e,r)&&J1(t,r,e[r]);return t},Z1=(t,e)=>N6(t,B6(e)),F6={Accept:"application/json","Content-Type":"application/json"},L6="POST",Q1={headers:F6,method:L6},ev=10,ui=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new tv.EventEmitter,this.isAvailable=!1,this.registering=!1,!Mc(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{let r=Qt(e),n=await(await(0,Nd.default)(this.url,Z1(X1({},Q1),{body:r}))).json();this.onPayload({data:n})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!Mc(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){let r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,s)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),s(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));n()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){let r=Qt({id:1,jsonrpc:"2.0",method:"test",params:[]});await(0,Nd.default)(e,Z1(X1({},Q1),{body:r}))}this.onOpen()}catch(r){let n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;let r=typeof e.data=="string"?Zt(e.data):e.data;this.events.emit("payload",r)}onError(e,r){let n=this.parseError(r),s=n.message||n.toString(),i=on(e,s);this.events.emit("payload",i)}parseError(e,r=this.url){return bo(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>ev&&this.events.setMaxListeners(ev)}};var xv=Be(qr(),1);function Kd(t){return t==null||typeof t!="object"&&typeof t!="function"}function Sv(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Iv(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}var M6="[object RegExp]",_v="[object String]",Av="[object Number]",Tv="[object Boolean]",Cv="[object Arguments]",q6="[object Symbol]",j6="[object Date]",$6="[object Map]",z6="[object Set]",H6="[object Array]",V6="[object ArrayBuffer]",K6="[object Object]",W6="[object DataView]",G6="[object Uint8Array]",Y6="[object Uint8ClampedArray]",J6="[object Uint16Array]",X6="[object Uint32Array]",Z6="[object Int8Array]",Q6="[object Int16Array]",eR="[object Int32Array]",tR="[object Float32Array]",rR="[object Float64Array]";function Wd(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function nR(t,e){return hi(t,void 0,t,new Map,e)}function hi(t,e,r,n=new Map,s=void 0){let i=s?.(t,e,r,n);if(i!=null)return i;if(Kd(t))return t;if(n.has(t))return n.get(t);if(Array.isArray(t)){let o=new Array(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=hi(t[a],a,r,n,s);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){let o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){let o=new Map;n.set(t,o);for(let[a,c]of t)o.set(a,hi(c,a,r,n,s));return o}if(t instanceof Set){let o=new Set;n.set(t,o);for(let a of t)o.add(hi(a,void 0,r,n,s));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(Wd(t)){let o=new(Object.getPrototypeOf(t)).constructor(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=hi(t[a],a,r,n,s);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){let o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return n.set(t,o),ys(o,t,r,n,s),o}if(typeof File<"u"&&t instanceof File){let o=new File([t],t.name,{type:t.type});return n.set(t,o),ys(o,t,r,n,s),o}if(t instanceof Blob){let o=new Blob([t],{type:t.type});return n.set(t,o),ys(o,t,r,n,s),o}if(t instanceof Error){let o=new t.constructor;return n.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,ys(o,t,r,n,s),o}if(typeof t=="object"&&sR(t)){let o=Object.create(Object.getPrototypeOf(t));return n.set(t,o),ys(o,t,r,n,s),o}return t}function ys(t,e,r=t,n,s){let i=[...Object.keys(e),...Sv(e)];for(let o=0;o<i.length;o++){let a=i[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=hi(e[a],a,r,n,s))}}function sR(t){switch(Iv(t)){case Cv:case H6:case V6:case W6:case Tv:case j6:case tR:case rR:case Z6:case Q6:case eR:case $6:case Av:case K6:case M6:case z6:case _v:case q6:case G6:case Y6:case J6:case X6:return!0;default:return!1}}function iR(t,e){return nR(t,(r,n,s,i)=>{let o=e?.(r,n,s,i);if(o!=null)return o;if(typeof t=="object")switch(Object.prototype.toString.call(t)){case Av:case _v:case Tv:{let a=new t.constructor(t?.valueOf());return ys(a,t),a}case Cv:{let a={};return ys(a,t),a.length=t.length,a[Symbol.iterator]=t[Symbol.iterator],a}default:return}})}function rv(t){return iR(t)}function nv(t){return t!==null&&typeof t=="object"&&Iv(t)==="[object Arguments]"}function sv(t){return typeof t=="object"&&t!==null}function oR(){}function aR(t){return Wd(t)}function cR(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){let r=t[Symbol.toStringTag];return r==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${r}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function uR(t){if(Kd(t))return t;if(Array.isArray(t)||Wd(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);let e=Object.getPrototypeOf(t),r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){let n=new r(t);return n.lastIndex=t.lastIndex,n}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){let n=new r(t.message);return n.stack=t.stack,n.name=t.name,n.cause=t.cause,n}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){let n=Object.create(e);return Object.assign(n,t)}return t}function lR(t,...e){let r=e.slice(0,-1),n=e[e.length-1],s=t;for(let i=0;i<r.length;i++){let o=r[i];s=qd(s,o,n,new Map)}return s}function qd(t,e,r,n){if(Kd(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(n.has(e))return uR(n.get(e));if(n.set(e,t),Array.isArray(e)){e=e.slice();for(let i=0;i<e.length;i++)e[i]=e[i]??void 0}let s=[...Object.keys(e),...Sv(e)];for(let i=0;i<s.length;i++){let o=s[i],a=e[o],c=t[o];if(nv(a)&&(a=M({},a)),nv(c)&&(c=M({},c)),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=rv(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){let l=[],h=Reflect.ownKeys(c);for(let f=0;f<h.length;f++){let d=h[f];l[d]=c[d]}c=l}else c=[];let u=r(c,a,o,t,e,n);u!=null?t[o]=u:Array.isArray(a)||sv(c)&&sv(a)?t[o]=qd(c,a,r,n):c==null&&cR(a)?t[o]=qd({},a,r,n):c==null&&aR(a)?t[o]=rv(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function hR(t,...e){return lR(t,...e,oR)}var iv="error",fR="wss://relay.walletconnect.org",dR="wc",Dv="universal_provider",Jc=`${dR}@2:${Dv}:`,Ov="https://rpc.walletconnect.org/v1/",Pv="generic",pR=`${Ov}bundler`,fi="call_status",gR=86400,Gd={DEFAULT_CHAIN_CHANGED:"default_chain_changed"},mR=Object.defineProperty,yR=Object.defineProperties,wR=Object.getOwnPropertyDescriptors,ov=Object.getOwnPropertySymbols,bR=Object.prototype.hasOwnProperty,vR=Object.prototype.propertyIsEnumerable,av=(t,e,r)=>e in t?mR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xc=(t,e)=>{for(var r in e||(e={}))bR.call(e,r)&&av(t,r,e[r]);if(ov)for(var r of ov(e))vR.call(e,r)&&av(t,r,e[r]);return t},ER=(t,e)=>yR(t,wR(e));function Rv(t,e,r){var n;let s=Er(t);return((n=e.rpcMap)==null?void 0:n[s.reference])||`${Ov}?chainId=${s.namespace}:${s.reference}&projectId=${r}`}function xR(t){return t.includes(":")?t.split(":")[1]:t}function Nv(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function SR(t,e){let r=Object.keys(e.namespaces).filter(s=>s.includes(t));if(!r.length)return[];let n=[];return r.forEach(s=>{let i=e.namespaces[s].accounts;n.push(...i)}),n}function cv(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>{var n,s;return((n=r?.chains)==null?void 0:n.length)&&((s=r?.chains)==null?void 0:s.length)>0}))}function Zc(t={},e={}){let r=cv(uv(t)),n=cv(uv(e));return hR(r,n)}function uv(t){var e,r,n,s,i;let o={};if(!rr(t))return o;for(let[a,c]of Object.entries(t)){let u=mo(a)?[a]:c.chains,l=c.methods||[],h=c.events||[],f=c.rpcMap||{},d=ps(a);o[d]=ER(Xc(Xc({},o[d]),c),{chains:yr(u,(e=o[d])==null?void 0:e.chains),methods:yr(l,(r=o[d])==null?void 0:r.methods),events:yr(h,(n=o[d])==null?void 0:n.events)}),(rr(f)||rr(((s=o[d])==null?void 0:s.rpcMap)||{}))&&(o[d].rpcMap=Xc(Xc({},f),(i=o[d])==null?void 0:i.rpcMap))}return o}function lv(t){return t.includes(":")?t.split(":")[2]:t}function hv(t){let e={};for(let[r,n]of Object.entries(t)){let s=n.methods||[],i=n.events||[],o=n.accounts||[],a=mo(r)?[r]:n.chains?n.chains:Nv(n.accounts);e[r]={chains:a,methods:s,events:i,accounts:o}}return e}function Bd(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function IR(t){try{let e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}var Bv={},di=t=>Bv[t],Ud=(t,e)=>{Bv[t]=e},_R=Object.defineProperty,fv=Object.getOwnPropertySymbols,AR=Object.prototype.hasOwnProperty,TR=Object.prototype.propertyIsEnumerable,dv=(t,e,r)=>e in t?_R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pv=(t,e)=>{for(var r in e||(e={}))AR.call(e,r)&&dv(t,r,e[r]);if(fv)for(var r of fv(e))TR.call(e,r)&&dv(t,r,e[r]);return t},gv="eip155",CR=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],DR=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,kd=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,mv=t=>Object.keys(t).filter(e=>CR.includes(e)).reduce((e,r)=>(e[r]=OR(t[r]),e),{}),OR=t=>typeof t=="string"&&IR(t)?JSON.parse(t):t,PR=(t,e,r)=>{let{sessionProperties:n={},scopedProperties:s={}}=t,i={};if(!rr(s)&&!rr(n))return;let o=mv(n);for(let a of r){let c=DR(a);if(!c)continue;i[kd(c)]=o;let u=s?.[`${gv}:${c}`];if(u){let l=u?.[`${gv}:${c}:${e}`];i[kd(c)]=pv(pv({},i[kd(c)]),mv(l||u))}}for(let[a,c]of Object.entries(i))Object.keys(c).length===0&&delete i[a];return Object.keys(i).length>0?i:void 0},RR=Object.defineProperty,NR=(t,e,r)=>e in t?RR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,BR=(t,e,r)=>NR(t,typeof e!="symbol"?e+"":e,r),Fd,jd=class t{constructor(e){BR(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,r){return await this.storage.setItem(e,r)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return Fd||(Fd=new t(e)),Fd}},UR=Object.defineProperty,kR=Object.defineProperties,FR=Object.getOwnPropertyDescriptors,yv=Object.getOwnPropertySymbols,LR=Object.prototype.hasOwnProperty,MR=Object.prototype.propertyIsEnumerable,wv=(t,e,r)=>e in t?UR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qR=(t,e)=>{for(var r in e||(e={}))LR.call(e,r)&&wv(t,r,e[r]);if(yv)for(var r of yv(e))MR.call(e,r)&&wv(t,r,e[r]);return t},jR=(t,e)=>kR(t,FR(e));async function $R(t,e){let r=Er(t.result.capabilities.caip345.caip2),n=t.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(n.map(h=>zR(r.reference,h,e))),i=s.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);s.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));let o=!i.length||i.some(h=>!h),a=i.every(h=>h?.status==="0x1"),c=i.every(h=>h?.status==="0x0"),u=i.some(h=>h?.status==="0x0"),l;return o?l=100:a?l=200:c?l=500:u&&(l=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:i,status:l}}async function zR(t,e,r){return await r(parseInt(t)).request(pt("eth_getTransactionReceipt",[e]))}async function HR({sendCalls:t,storage:e}){let r=await e.getItem(fi);await e.setItem(fi,jR(qR({},r),{[t.result.id]:{request:t.request,result:t.result,expiry:Ae(gR)}}))}async function VR({resultId:t,storage:e}){let r=await e.getItem(fi);if(r){delete r[t],await e.setItem(fi,r);for(let n in r)Kt(r[n].expiry)&&delete r[n];await e.setItem(fi,r)}}async function KR({resultId:t,storage:e}){let r=await e.getItem(fi),n=r?.[t];if(n&&!Kt(n.expiry))return n;await VR({resultId:t,storage:e})}var WR=Object.defineProperty,GR=Object.defineProperties,YR=Object.getOwnPropertyDescriptors,bv=Object.getOwnPropertySymbols,JR=Object.prototype.hasOwnProperty,XR=Object.prototype.propertyIsEnumerable,$d=(t,e,r)=>e in t?WR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ld=(t,e)=>{for(var r in e||(e={}))JR.call(e,r)&&$d(t,r,e[r]);if(bv)for(var r of bv(e))XR.call(e,r)&&$d(t,r,e[r]);return t},Md=(t,e)=>GR(t,YR(e)),ms=(t,e,r)=>$d(t,typeof e!="symbol"?e+"":e,r),zd=class{constructor(e){ms(this,"name","eip155"),ms(this,"client"),ms(this,"chainId"),ms(this,"namespace"),ms(this,"httpProviders"),ms(this,"events"),ms(this,"storage"),this.namespace=e.namespace,this.events=di("events"),this.client=di("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=jd.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r);let n=this.chainId;this.chainId=parseInt(e),this.events.emit(Gd.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){let n=r||Rv(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new gs(new ui(n,di("disableProviderPing")))}setHttpProvider(e,r){let n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProviders(){let e={};return this.namespace.chains.forEach(r=>{var n;let s=parseInt(xR(r));e[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(e){let r=e||this.chainId;return this.httpProviders[r]||(this.httpProviders=Md(Ld({},this.httpProviders),{[r]:this.createHttpProvider(r)}),this.httpProviders[r])}async handleSwitchChain(e){var r,n;let s=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;let i=parseInt(s,16);if(this.isChainApproved(i))this.setDefaultChain(`${i}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${i}`);else throw new Error(`Failed to switch to chain 'eip155:${i}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,n,s,i,o;let a=(n=(r=e.request)==null?void 0:r.params)==null?void 0:n[0],c=((i=(s=e.request)==null?void 0:s.params)==null?void 0:i[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");let u=this.client.session.get(e.topic),l=((o=u?.sessionProperties)==null?void 0:o.capabilities)||{},h=`${a}${c.join(",")}`,f=l?.[h];if(f)return f;let d;try{d=PR(u,a,c)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(d)return d;let p=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Md(Ld({},u.sessionProperties||{}),{capabilities:Md(Ld({},l||{}),{[h]:p})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return p}async getCallStatus(e){var r,n,s;let i=this.client.session.get(e.topic),o=(r=i.sessionProperties)==null?void 0:r.bundler_name;if(o){let u=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(u,e)}catch(l){console.warn("Failed to fetch call status from bundler",l,u)}}let a=(n=i.sessionProperties)==null?void 0:n.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(u){console.warn("Failed to fetch call status from custom bundler",u,a)}let c=await KR({resultId:(s=e.request.params)==null?void 0:s[0],storage:this.storage});if(c)try{return await $R(c,this.getHttpProvider.bind(this))}catch(u){console.warn("Failed to fetch call status from stored send calls",u,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var n;let s=new URL(e),i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(pt("eth_getUserOperationReceipt",[(n=r.request.params)==null?void 0:n[0]]))});if(!i.ok)throw new Error(`Failed to fetch user operation receipt - ${i.status}`);return await i.json()}getBundlerUrl(e,r){return`${pR}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}async sendCalls(e){var r,n,s;let i=await this.client.request(e),o=(r=e.request.params)==null?void 0:r[0],a=i?.id,c=i?.capabilities||{},u=(n=c?.caip345)==null?void 0:n.caip2,l=(s=c?.caip345)==null?void 0:s.transactionHashes;return!a||!u||!(l!=null&&l.length)||await HR({sendCalls:{request:o,result:i},storage:this.storage}),i}},ZR=Object.defineProperty,QR=(t,e,r)=>e in t?ZR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,li=(t,e,r)=>QR(t,typeof e!="symbol"?e+"":e,r),Hd=class{constructor(e){li(this,"name",Pv),li(this,"client"),li(this,"httpProviders"),li(this,"events"),li(this,"namespace"),li(this,"chainId"),this.namespace=e.namespace,this.events=di("events"),this.client=di("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r);let n=this.chainId;this.chainId=e,this.events.emit(Gd.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return Er(e).namespace}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;let n={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(s=>{var i,o;let a=Er(s),c=(o=(i=this.namespace)==null?void 0:i.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];n[a.reference]=this.createHttpProvider(s,c)}),n}getHttpProvider(e){let r=Er(e).reference,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return n}setHttpProvider(e,r){let n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){let n=r||Rv(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new gs(new ui(n,di("disableProviderPing")))}},e4=Object.defineProperty,t4=Object.defineProperties,r4=Object.getOwnPropertyDescriptors,vv=Object.getOwnPropertySymbols,n4=Object.prototype.hasOwnProperty,s4=Object.prototype.propertyIsEnumerable,Vd=(t,e,r)=>e in t?e4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Do=(t,e)=>{for(var r in e||(e={}))n4.call(e,r)&&Vd(t,r,e[r]);if(vv)for(var r of vv(e))s4.call(e,r)&&Vd(t,r,e[r]);return t},Qc=(t,e)=>t4(t,r4(e)),cr=(t,e,r)=>Vd(t,typeof e!="symbol"?e+"":e,r),Ev=class t{constructor(e){cr(this,"client"),cr(this,"namespaces"),cr(this,"optionalNamespaces"),cr(this,"sessionProperties"),cr(this,"scopedProperties"),cr(this,"events",new xv.default),cr(this,"rpcProviders",{}),cr(this,"session"),cr(this,"providerOpts"),cr(this,"logger"),cr(this,"uri"),cr(this,"disableProviderPing",!1);var r,n;this.providerOpts=e,this.logger=ti({logger:(r=e.logger)!=null?r:iv,name:(n=this.providerOpts.name)!=null?n:Dv}),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){let r=new t(e);return await r.initialize(),r}async request(e,r,n){let[s,i]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Do({},e),chainId:`${s}:${i}`,topic:this.session.topic,expiry:n})}sendAsync(e,r,n,s){let i=new Date().getTime();this.request(e,n,s).then(o=>r(null,sn(i,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:we("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();let{uri:n,response:s}=await this.client.authenticate(e,r);n&&(this.uri=n,this.events.emit("display_uri",n));let i=await s();if(this.session=i.session,this.session){let o=hv(this.session.namespaces);this.namespaces=Zc(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return i}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){let{uri:r,approval:n}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});r&&(this.uri=r,this.events.emit("display_uri",r));let s=await n();this.session=s;let i=hv(s.namespaces);return this.namespaces=Zc(this.namespaces,i),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;let[n,s]=this.validateChain(e);this.getProvider(n).setDefaultChain(s,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");let r=this.client.pairing.getAll();if(!Ir(r))return;for(let n of r)e.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}catch(r){this.logger.warn(r,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await K1.init({core:this.providerOpts.core,logger:this.providerOpts.logger||iv,relayUrl:this.providerOpts.relayUrl||fR,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(n){throw this.logger.error(n,"Failed to get session"),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{let n=this.client.session.getAll();this.session=n[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");let e=[...new Set(Object.keys(this.session.namespaces).map(r=>ps(r)))];Ud("client",this.client),Ud("events",this.events),Ud("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;let n=SR(r,this.session);if(n?.length===0)return;let s=Nv(n),i=Zc(this.namespaces,this.optionalNamespaces),o=Qc(Do({},i[r]),{accounts:n,chains:s});switch(r){case"eip155":this.rpcProviders[r]=new zd({namespace:o});break;default:this.rpcProviders[r]=new Hd({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;let{topic:n}=e;n===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;let{params:n,topic:s}=e;if(s!==((r=this.session)==null?void 0:r.topic))return;let{event:i}=n;if(i.name==="accountsChanged"){let o=i.data;o&&Ir(o)&&this.events.emit("accountsChanged",o.map(lv))}else if(i.name==="chainChanged"){let o=n.chainId,a=n.event.data,c=ps(o),u=Bd(o)!==Bd(a)?`${c}:${Bd(a)}`:o;this.onChainChanged({currentCaipChainId:u})}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var n,s;if(e!==((n=this.session)==null?void 0:n.topic))return;let{namespaces:i}=r,o=(s=this.client)==null?void 0:s.session.get(e);this.session=Qc(Do({},o),{namespaces:i}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Qc(Do({},we("USER_DISCONNECTED")),{data:e.topic})))}),this.on(Gd.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(Qc(Do({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Pv]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){let{namespaces:r={},optionalNamespaces:n={},sessionProperties:s,scopedProperties:i}=e;this.optionalNamespaces=Zc(r,n),this.sessionProperties=s,this.scopedProperties=i}validateChain(e){let[r,n]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(o=>ps(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];let s=ps(Object.keys(this.namespaces)[0]),i=this.rpcProviders[s].getDefaultChain();return[s,i]}async requestAccounts(){let[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:r,internal:n=!1}){if(!this.namespaces)return;let[s,i]=this.validateChain(e);i&&(this.updateNamespaceChain(s,i),n?(this.events.emit("chainChanged",i),this.emitAccountsChangedOnChainChange({namespace:s,currentCaipChainId:e,previousCaipChainId:r})):this.getProvider(s).setDefaultChain(i),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:r,previousCaipChainId:n}){var s,i;try{if(n===r)return;let o=(i=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:i.accounts;if(!o)return;let a=o.filter(c=>c.includes(`${r}:`)).map(lv);if(!Ir(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn(o,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,r){if(!this.namespaces)return;let n=this.namespaces[e]?e:`${e}:${r}`,s={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[n]?this.namespaces[n]&&(this.namespaces[n].defaultChain=r):this.namespaces[n]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var n;let s=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.setItem(`${Jc}/${e}${s}`,r)}async getFromStore(e){var r;let n=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${Jc}/${e}${n}`)}async deleteFromStore(e){var r;let n=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${Jc}/${e}${n}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;let r=await this.client.core.storage.getKeys();for(let n of r)n.startsWith(Jc)&&await this.client.core.storage.removeItem(n)}catch(r){this.logger.warn(r,"Failed to cleanup storage")}}};var Uv={convertEVMChainIdToCoinType(t){if(t>=2147483648)throw new Error("Invalid chainId");return(2147483648|t)>>>0}};var ur=At({suggestions:[],loading:!1}),i4={state:ur,subscribe(t){return Xt(ur,()=>t(ur))},subscribeKey(t,e){return Tt(ur,t,e)},async resolveName(t){try{return await He.lookupEnsName(t)}catch(e){let r=e;throw new Error(r?.reasons?.[0]?.description||"Error resolving name")}},async isNameRegistered(t){try{return await He.lookupEnsName(t),!0}catch{return!1}},async getSuggestions(t){try{ur.loading=!0,ur.suggestions=[];let e=await He.getEnsNameSuggestions(t);return ur.suggestions=e.suggestions||[],ur.suggestions}catch(e){let r=pi.parseEnsApiError(e,"Error fetching name suggestions");throw new Error(r)}finally{ur.loading=!1}},async getNamesForAddress(t){try{if(!Q.state.activeCaipNetwork)return[];let r=mi.getEnsFromCacheForAddress(t);if(r)return r;let n=await He.reverseLookupEnsName({address:t});return mi.updateEnsCache({address:t,ens:n,timestamp:Date.now()}),n}catch(e){let r=pi.parseEnsApiError(e,"Error fetching names for address");throw new Error(r)}},async registerName(t){let e=Q.state.activeCaipNetwork,r=Q.getAccountData(e?.chainNamespace)?.address,n=Or.getAuthConnector();if(!e)throw new Error("Network not found");if(!r||!n)throw new Error("Address or auth connector not found");ur.loading=!0;try{let s=JSON.stringify({name:t,attributes:{},timestamp:Math.floor(Date.now()/1e3)});me.pushTransactionStack({onCancel(){me.replace("RegisterAccountName")}});let i=await Dt.signMessage(s);ur.loading=!1;let o=e.id;if(!o)throw new Error("Network not found");let a=Uv.convertEVMChainIdToCoinType(Number(o));await He.registerEnsName({coinType:a,address:r,signature:i,message:s}),Q.setAccountProp("profileName",t,e.chainNamespace),mi.updateEnsCache({address:r,ens:[{name:t,registered_at:new Date().toISOString(),updated_at:void 0,addresses:{},attributes:[]}],timestamp:Date.now()}),me.replace("RegisterAccountNameSuccess")}catch(s){let i=pi.parseEnsApiError(s,`Error registering name ${t}`);throw me.replace("RegisterAccountName"),new Error(i)}finally{ur.loading=!1}},validateName(t){return/^[a-zA-Z0-9-]{4,}$/u.test(t)},parseEnsApiError(t,e){return t?.reasons?.[0]?.description||e}},pi=hr(i4);var o4={solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},ws={RPC_ERROR_CODE:{USER_REJECTED:5e3,USER_REJECTED_METHODS:5002},getMethodsByChainNamespace(t){return o4[t]||[]},createDefaultNamespace(t){return{methods:this.getMethodsByChainNamespace(t),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(t,e){if(!e)return M({},t);let r=M({},t),n=new Set;if(e.methods&&Object.keys(e.methods).forEach(s=>n.add(s)),e.chains&&Object.keys(e.chains).forEach(s=>n.add(s)),e.events&&Object.keys(e.events).forEach(s=>n.add(s)),e.rpcMap&&Object.keys(e.rpcMap).forEach(s=>{let[i]=s.split(":");i&&n.add(i)}),n.forEach(s=>{r[s]||(r[s]=this.createDefaultNamespace(s))}),e.methods&&Object.entries(e.methods).forEach(([s,i])=>{r[s]&&(r[s].methods=i)}),e.chains&&Object.entries(e.chains).forEach(([s,i])=>{r[s]&&(r[s].chains=i)}),e.events&&Object.entries(e.events).forEach(([s,i])=>{r[s]&&(r[s].events=i)}),e.rpcMap){let s=new Set;Object.entries(e.rpcMap).forEach(([i,o])=>{let[a,c]=i.split(":");!a||!c||!r[a]||(r[a].rpcMap||(r[a].rpcMap={}),s.has(a)||(r[a].rpcMap={},s.add(a)),r[a].rpcMap[c]=o)})}return r},createNamespaces(t,e){let r=t.reduce((n,s)=>{let{id:i,chainNamespace:o,rpcUrls:a}=s,c=a.default.http[0];n[o]||(n[o]=this.createDefaultNamespace(o));let u=`${o}:${i}`,l=n[o];switch(l.chains.push(u),u){case"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":l.chains.push("solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ");break;case"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1":l.chains.push("solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K");break;default:}return l?.rpcMap&&c&&(l.rpcMap[i]=c),n},{});return this.applyNamespaceOverrides(r,e)},resolveReownName:async t=>{let e=await pi.resolveName(t);return(Object.values(e?.addresses)||[])[0]?.address||!1},getChainsFromNamespaces(t={}){return Object.values(t).flatMap(e=>{let r=e.chains||[],n=e.accounts.map(s=>{let[i,o]=s.split(":");return`${i}:${o}`});return Array.from(new Set([...r,...n]))})},isSessionEventData(t){return typeof t=="object"&&t!==null&&"id"in t&&"topic"in t&&"params"in t&&typeof t.params=="object"&&t.params!==null&&"chainId"in t.params&&"event"in t.params&&typeof t.params.event=="object"&&t.params.event!==null},isUserRejectedRequestError(t){try{if(typeof t=="object"&&t!==null){let e=t,r=typeof e.code=="number",n=r&&e.code===ws.RPC_ERROR_CODE.USER_REJECTED_METHODS,s=r&&e.code===ws.RPC_ERROR_CODE.USER_REJECTED;return n||s}return!1}catch{return!1}},isOriginAllowed(t,e,r){for(let n of[...e,...r])if(n.includes("*")){let i=`^${n.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&").replace(/\\\*/gu,".*")}$`;if(new RegExp(i,"u").test(t))return!0}else try{if(new URL(n).origin===t)return!0}catch{if(n===t)return!0}return!1},listenWcProvider({universalProvider:t,namespace:e,onConnect:r,onDisconnect:n,onAccountsChanged:s,onChainChanged:i,onDisplayUri:o}){r&&t.on("connect",()=>{let a=ws.getWalletConnectAccounts(t,e);r(a)}),n&&t.on("disconnect",()=>{n()}),s&&t.on("accountsChanged",a=>{try{let c=t.session?.namespaces?.[e]?.accounts||[],u=t.rpcProviders?.[e]?.getDefaultChain(),l=a.map(h=>{let f=c.find(g=>g.includes(`${e}:${u}:${h}`));if(!f)return;let{chainId:d,chainNamespace:p}=zn.parseCaipAddress(f);return{address:h,chainId:d,chainNamespace:p}}).filter(h=>h!==void 0);l.length>0&&s(l)}catch(c){console.warn("Failed to parse accounts for namespace on accountsChanged event",e,a,c)}}),i&&t.on("chainChanged",a=>{i(a)}),o&&t.on("display_uri",a=>{o(a)})},getWalletConnectAccounts(t,e){let r=new Set,n=t?.session?.namespaces?.[e]?.accounts?.map(s=>zn.parseCaipAddress(s)).filter(({address:s})=>r.has(s.toLowerCase())?!1:(r.add(s.toLowerCase()),!0));return n&&n.length>0?n:[]}};var a4=[Se.CONNECTOR_ID.AUTH,Se.CONNECTOR_ID.WALLET_CONNECT],Yd=class{constructor(e){this.availableConnectors=[],this.availableConnections=[],this.providerHandlers={},this.eventListeners=new Map,this.getCaipNetworks=r=>Q.getCaipNetworks(r),this.getConnectorId=r=>Or.getConnectorId(r),e&&this.construct(e)}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get connections(){return this.availableConnections}get networks(){return this.getCaipNetworks(this.namespace)}onAuthConnected({accounts:e,chainId:r}){let n=this.getCaipNetworks().filter(s=>s.chainNamespace===this.namespace).find(s=>s.id.toString()===r?.toString());e&&n&&this.addConnection({connectorId:Se.CONNECTOR_ID.AUTH,accounts:e,caipNetwork:n})}setAuthProvider(e){e.onConnect(this.onAuthConnected.bind(this)),e.onSocialConnected(this.onAuthConnected.bind(this)),this.addConnector({id:Se.CONNECTOR_ID.AUTH,type:"AUTH",name:Se.CONNECTOR_NAMES.AUTH,provider:e,imageId:void 0,chain:this.namespace,chains:[]})}addConnector(...e){let r=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(n=>r.has(n.id)?!1:(r.add(n.id),!0)),this.emit("connectors",this.availableConnectors)}addConnection(...e){let r=new Set;this.availableConnections=[...e,...this.availableConnections].filter(n=>r.has(n.connectorId.toLowerCase())?!1:(r.add(n.connectorId.toLowerCase()),!0)),this.emit("connections",this.availableConnections)}deleteConnection(e){this.availableConnections=this.availableConnections.filter(r=>r.connectorId.toLowerCase()!==e.toLowerCase()),this.emit("connections",this.availableConnections)}clearConnections(e=!1){this.availableConnections=[],e&&this.emit("connections",this.availableConnections)}setStatus(e,r){Q.setAccountProp("status",e,r)}on(e,r){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e)?.add(r)}off(e,r){let n=this.eventListeners.get(e);n&&n.delete(r)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,r){let n=this.eventListeners.get(e);n&&n.forEach(s=>s(r))}async connectWalletConnect(e){try{return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}catch(r){throw ws.isUserRejectedRequestError(r)?new hp(r):r}}async switchNetwork(e){let{caipNetwork:r}=e,n=Bo.getProviderId(r.chainNamespace),s=Bo.getProvider(r.chainNamespace);if(!s)throw new Error("Provider not found");if(n==="WALLET_CONNECT"){s.setDefaultChain(r.caipNetworkId);return}if(n==="AUTH"){let i=Or.getAuthConnector()?.provider;if(!i)throw new Error("Auth provider not found");let o=un(r.chainNamespace);await i.switchNetwork({chainId:r.caipNetworkId});let a=await i.getUser({chainId:r.caipNetworkId,preferredAccountType:o});this.emit("switchNetwork",a)}}getWalletConnectConnector(){let e=this.connectors.find(r=>r.id==="walletConnect");if(!e)throw new Error("WalletConnectConnector not found");return e}onConnect(e,r){if(e.length>0){let{address:n,chainId:s}=Le.getAccount(e[0]),i=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===s?.toString()),o=this.connectors.find(a=>a.id===r);n&&(this.emit("accountChanged",{address:n,chainId:s,connector:o}),this.addConnection({connectorId:r,accounts:e.map(a=>{let{address:c}=Le.getAccount(a);return{address:c}}),caipNetwork:i}))}}onAccountsChanged(e,r,n=!0){if(e.length>0){let{address:s}=Le.getAccount(e[0]),i=this.getConnection({connectorId:r,connections:this.connections,connectors:this.connectors});s&&this.getConnectorId(Se.CHAIN.EVM)?.toLowerCase()===r.toLowerCase()&&this.emit("accountChanged",{address:s,chainId:i?.caipNetwork?.id,connector:i?.connector}),this.addConnection({connectorId:r,accounts:e.map(o=>{let{address:a}=Le.getAccount(o);return{address:a}}),caipNetwork:i?.caipNetwork})}else n&&this.onDisconnect(r)}onDisconnect(e){this.removeProviderListeners(e),this.deleteConnection(e),this.getConnectorId(Se.CHAIN.EVM)?.toLowerCase()===e.toLowerCase()&&this.emitFirstAvailableConnection(),this.connections.length===0&&this.emit("disconnect")}onChainChanged(e,r){let n=typeof e=="string"&&e.startsWith("0x")?parseInt(e,16).toString():e.toString(),s=this.getConnection({connectorId:r,connections:this.connections,connectors:this.connectors}),i=this.getCaipNetworks().filter(o=>o.chainNamespace===this.namespace).find(o=>o.id.toString()===n);s&&this.addConnection({connectorId:r,accounts:s.accounts,caipNetwork:i}),this.getConnectorId(Se.CHAIN.EVM)?.toLowerCase()===r.toLowerCase()&&this.emit("switchNetwork",{chainId:n})}listenProviderEvents(e,r){if(a4.includes(e))return;let n=o=>this.onAccountsChanged(o,e),s=o=>this.onChainChanged(o,e),i=()=>this.onDisconnect(e);this.providerHandlers[e]||(r.on("disconnect",i),r.on("accountsChanged",n),r.on("chainChanged",s),this.providerHandlers[e]={provider:r,disconnect:i,accountsChanged:n,chainChanged:s})}removeProviderListeners(e){if(this.providerHandlers[e]){let{provider:r,disconnect:n,accountsChanged:s,chainChanged:i}=this.providerHandlers[e];r.removeListener("disconnect",n),r.removeListener("accountsChanged",s),r.removeListener("chainChanged",i),this.providerHandlers[e]=null}}emitFirstAvailableConnection(){let e=this.getConnection({connections:this.connections,connectors:this.connectors});if(e){let[r]=e.accounts;this.emit("accountChanged",{address:r?.address,chainId:e.caipNetwork?.id,connector:e.connector})}}getConnection({address:e,connectorId:r,connections:n,connectors:s}){if(r){let o=n.find(u=>u.connectorId.toLowerCase()===r.toLowerCase());if(!o)return null;let a=s.find(u=>u.id.toLowerCase()===o.connectorId.toLowerCase()),c=e?o.accounts.find(u=>u.address.toLowerCase()===e.toLowerCase()):o.accounts[0];return pe(M({},o),{account:c,connector:a})}let i=n.find(o=>o.accounts.length>0&&s.some(a=>a.id.toLowerCase()===o.connectorId.toLowerCase()));if(i){let[o]=i.accounts,a=s.find(c=>c.id.toLowerCase()===i.connectorId.toLowerCase());return pe(M({},i),{account:o,connector:a})}return null}};var bs=null,lr={getSIWX(){return Ue.state.siwx},async initializeIfEnabled(t=Q.getActiveCaipAddress()){let e=Ue.state.siwx;if(!(e&&t))return;let[r,n,s]=t.split(":");if(Q.checkIfSupportedNetwork(r,`${r}:${n}`))try{if(Ue.state.remoteFeatures?.emailCapture){let o=Q.getAccountData(r)?.user;await qt.open({view:"DataCapture",data:{email:o?.email??void 0}});return}if(bs&&await bs,(await e.getSessions(`${r}:${n}`,s)).length)return;await qt.open({view:"SIWXSignMessage"})}catch(i){console.error("SIWXUtil:initializeIfEnabled",i),Et.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(i)}),await Dt._getClient()?.disconnect().catch(console.error),me.reset("Connect"),Ce.showError("A problem occurred while trying initialize authentication")}},async isAuthenticated(t=Q.getActiveCaipAddress()){if(!Ue.state.siwx||!t)return!0;let{chainNamespace:r,chainId:n,address:s}=zn.parseCaipAddress(t),i=`${r}:${n}`;return(await lr.getSessions({address:s,caipNetworkId:i})).length>0},async requestSignMessage(){let t=Ue.state.siwx,e=Le.getPlainAddress(Q.getActiveCaipAddress()),r=wi(),n=Dt._getClient();if(!t)throw new Error("SIWX is not enabled");if(!e)throw new Error("No ActiveCaipAddress found");if(!r)throw new Error("No ActiveCaipNetwork or client found");if(!n)throw new Error("No ConnectionController client found");try{let s=await t.createMessage({chainId:r.caipNetworkId,accountAddress:e}),i=s.toString();Or.getConnectorId(r.chainNamespace)===Se.CONNECTOR_ID.AUTH&&me.pushTransactionStack({});let a=await n.signMessage(i);await t.addSession({data:s,message:i,signature:a}),Q.setLastConnectedSIWECaipNetwork(r),qt.close(),Et.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(s){(!qt.state.open||me.state.view==="ApproveTransaction")&&await qt.open({view:"SIWXSignMessage"}),Ce.showError("Error signing message"),Et.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(s)}),console.error("SWIXUtil:requestSignMessage",s)}},async cancelSignMessage(){try{let t=this.getSIWX();if(t?.getRequired?.()){let r=Q.getLastConnectedSIWECaipNetwork();if(r){let n=await t?.getSessions(r?.caipNetworkId,Le.getPlainAddress(Q.getActiveCaipAddress())||"");n&&n.length>0?await Q.switchActiveNetwork(r):await Dt.disconnect()}else await Dt.disconnect()}else qt.close();qt.close(),Et.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(t){console.error("SIWXUtil:cancelSignMessage",t)}},async getAllSessions(){let t=this.getSIWX(),e=Q.getAllRequestedCaipNetworks(),r=[];return await Promise.all(e.map(async n=>{let s=await t?.getSessions(n.caipNetworkId,Le.getPlainAddress(Q.getActiveCaipAddress())||"");s&&r.push(...s)})),r},async getSessions(t){let e=Ue.state.siwx,r=t?.address;if(!r){let s=Q.getActiveCaipAddress();r=Le.getPlainAddress(s)}let n=t?.caipNetworkId;return n||(n=Q.getActiveCaipNetwork()?.caipNetworkId),e&&r&&n?e.getSessions(n,r):[]},async isSIWXCloseDisabled(){let t=this.getSIWX();if(t){let e=me.state.view==="ApproveTransaction",r=me.state.view==="SIWXSignMessage";if(e||r)return t.getRequired?.()&&(await this.getSessions()).length===0}return!1},async authConnectorAuthenticate({authConnector:t,chainId:e,socialUri:r,preferredAccountType:n,chainNamespace:s}){let i=lr.getSIWX(),o=wi();if(!i||!s.includes(Se.CHAIN.EVM)||Ue.state.remoteFeatures?.emailCapture){let h=await t.connect({chainId:e,socialUri:r,preferredAccountType:n});return{address:h.address,chainId:h.chainId,accounts:h.accounts}}let a=`${s}:${e}`,c=await i.createMessage({chainId:a,accountAddress:"<<AccountAddress>>"}),u={accountAddress:c.accountAddress,chainId:c.chainId,domain:c.domain,uri:c.uri,version:c.version,nonce:c.nonce,notBefore:c.notBefore,statement:c.statement,resources:c.resources,requestId:c.requestId,issuedAt:c.issuedAt,expirationTime:c.expirationTime,serializedMessage:c.toString()},l=await t.connect({chainId:e,socialUri:r,siwxMessage:u,preferredAccountType:n});return u.accountAddress=l.address,u.serializedMessage=l.message||"",l.signature&&l.message&&await lr.addEmbeddedWalletSession(u,l.message,l.signature),Q.setLastConnectedSIWECaipNetwork(o),{address:l.address,chainId:l.chainId,accounts:l.accounts}},async addEmbeddedWalletSession(t,e,r){if(bs)return bs;let n=lr.getSIWX();return n?(bs=n.addSession({data:t,message:e,signature:r}).finally(()=>{bs=null}),bs):Promise.resolve()},async universalProviderAuthenticate({universalProvider:t,chains:e,methods:r}){let n=lr.getSIWX(),s=wi(),i=new Set(e.map(u=>u.split(":")[0]));if(!n||i.size!==1||!i.has("eip155"))return!1;let o=await n.createMessage({chainId:wi()?.caipNetworkId||"",accountAddress:""}),a=await t.authenticate({nonce:o.nonce,domain:o.domain,uri:o.uri,exp:o.expirationTime,iat:o.issuedAt,nbf:o.notBefore,requestId:o.requestId,version:o.version,resources:o.resources,statement:o.statement,chainId:o.chainId,methods:r,chains:[o.chainId,...e.filter(u=>u!==o.chainId)]});Ce.showLoading("Authenticating...",{autoClose:!1});let c=pe(M({},a.session.peer.metadata),{name:a.session.peer.metadata.name,icon:a.session.peer.metadata.icons?.[0],type:"WALLET_CONNECT"});if(Q.setAccountProp("connectedWalletInfo",c,Array.from(i)[0]),a?.auths?.length){let u=a.auths.map(l=>{let h=t.client.formatAuthMessage({request:l.p,iss:l.p.iss});return{data:pe(M({},l.p),{accountAddress:l.p.iss.split(":").slice(-1).join(""),chainId:l.p.iss.split(":").slice(2,4).join(":"),uri:l.p.aud,version:l.p.version||o.version,expirationTime:l.p.exp,issuedAt:l.p.iat,notBefore:l.p.nbf}),message:h,signature:l.s.s,cacao:l}});try{await n.setSessions(u),s&&Q.setLastConnectedSIWECaipNetwork(s),Et.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:lr.getSIWXEventProperties()})}catch(l){throw console.error("SIWX:universalProviderAuth - failed to set sessions",l),Et.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:lr.getSIWXEventProperties(l)}),await t.disconnect().catch(console.error),l}finally{Ce.hide()}}return!0},getSIWXEventProperties(t){let e=Q.state.activeChain;if(!e)throw new Error("SIWXUtil:getSIWXEventProperties - namespace is required");return{network:Q.state.activeCaipNetwork?.caipNetworkId||"",isSmartAccount:un(e)===vs.ACCOUNT_TYPES.SMART_ACCOUNT,message:t?Le.parseError(t):void 0}},async clearSessions(){let t=this.getSIWX();t&&await t.setSessions([])}};var Jd=class{constructor({provider:e,namespace:r}){this.id=Se.CONNECTOR_ID.WALLET_CONNECT,this.name="WalletConnect",this.type="WALLET_CONNECT",this.imageId="ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",this.getCaipNetworks=Q.getCaipNetworks.bind(Q),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=r}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){let r=this.getCaipNetworks(),n=Ue.state.universalProviderConfigOverride,s=ws.createNamespaces(r,n);await this.provider.connect({optionalNamespaces:s})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){let e=this.chains.map(r=>r.caipNetworkId);return lr.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:c4})}},c4=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"];var cn={getGasPriceInEther(t,e){let r=e*t;return Number(r)/1e18},getGasPriceInUSD(t,e,r){let n=cn.getGasPriceInEther(e,r);return Ie.bigNumber(t).times(n).toNumber()},getPriceImpact({sourceTokenAmount:t,sourceTokenPriceInUSD:e,toTokenPriceInUSD:r,toTokenAmount:n}){let s=Ie.bigNumber(t).times(e),i=Ie.bigNumber(n).times(r);return s.minus(i).div(s).times(100).toNumber()},getMaxSlippage(t,e){let r=Ie.bigNumber(t).div(100);return Ie.multiply(e,r).toNumber()},getProviderFee(t,e=.0085){return Ie.bigNumber(t).times(e).toString()},isInsufficientNetworkTokenForGas(t,e){let r=e||"0";return Ie.bigNumber(t).eq(0)?!0:Ie.bigNumber(Ie.bigNumber(r)).gt(t)},isInsufficientSourceTokenForSwap(t,e,r){let n=r?.find(i=>i.address===e)?.quantity?.numeric;return Ie.bigNumber(n||"0").lt(t)}};var Tr=At({message:"",variant:"info",open:!1}),u4={state:Tr,subscribeKey(t,e){return Tt(Tr,t,e)},open(t,e){let{debug:r}=Ue.state,{code:n,displayMessage:s,debugMessage:i}=t;s&&r&&(Tr.message=s,Tr.variant=e,Tr.open=!0),i&&console.error(typeof i=="function"?i():i,n?{code:n}:void 0)},warn(t,e,r){Tr.open=!0,Tr.message=t,Tr.variant="warning",e&&console.warn(e,r)},close(){Tr.open=!1,Tr.message="",Tr.variant="info"}},Xd=hr(u4);var kv=15e4,l4=6;var wt={initializing:!1,initialized:!1,loadingPrices:!1,loadingQuote:!1,loadingApprovalTransaction:!1,loadingBuildTransaction:!1,loadingTransaction:!1,switchingTokens:!1,fetchError:!1,approvalTransaction:void 0,swapTransaction:void 0,transactionError:void 0,sourceToken:void 0,sourceTokenAmount:"",sourceTokenPriceInUSD:0,toToken:void 0,toTokenAmount:"",toTokenPriceInUSD:0,networkPrice:"0",networkBalanceInUSD:"0",networkTokenSymbol:"",inputError:void 0,slippage:Hn.CONVERT_SLIPPAGE_TOLERANCE,tokens:void 0,popularTokens:void 0,suggestedTokens:void 0,foundTokens:void 0,myTokensWithBalance:void 0,tokensPriceMap:{},gasFee:"0",gasPriceInUSD:0,priceImpact:void 0,maxSlippage:void 0,providerFee:void 0},D=At(M({},wt)),eu={state:D,subscribe(t){return Xt(D,()=>t(D))},subscribeKey(t,e){return Tt(D,t,e)},getParams(){let t=Q.state.activeChain,e=Q.getAccountData(t)?.caipAddress??Q.state.activeCaipAddress,r=Le.getPlainAddress(e),n=yi(),s=Or.getConnectorId(Q.state.activeChain);if(!r)throw new Error("No address found to swap the tokens from.");let i=!D.toToken?.address||!D.toToken?.decimals,o=!D.sourceToken?.address||!D.sourceToken?.decimals||!Ie.bigNumber(D.sourceTokenAmount).gt(0),a=!D.sourceTokenAmount;return{networkAddress:n,fromAddress:r,fromCaipAddress:e,sourceTokenAddress:D.sourceToken?.address,toTokenAddress:D.toToken?.address,toTokenAmount:D.toTokenAmount,toTokenDecimals:D.toToken?.decimals,sourceTokenAmount:D.sourceTokenAmount,sourceTokenDecimals:D.sourceToken?.decimals,invalidToToken:i,invalidSourceToken:o,invalidSourceTokenAmount:a,availableToSwap:e&&!i&&!o&&!a,isAuthConnector:s===Se.CONNECTOR_ID.AUTH}},async setSourceToken(t){if(!t){D.sourceToken=t,D.sourceTokenAmount="",D.sourceTokenPriceInUSD=0;return}D.sourceToken=t,await ee.setTokenPrice(t.address,"sourceToken")},setSourceTokenAmount(t){D.sourceTokenAmount=t},async setToToken(t){if(!t){D.toToken=t,D.toTokenAmount="",D.toTokenPriceInUSD=0;return}D.toToken=t,await ee.setTokenPrice(t.address,"toToken")},setToTokenAmount(t){D.toTokenAmount=t?Ie.toFixed(t,l4):""},async setTokenPrice(t,e){let r=D.tokensPriceMap[t]||0;r||(D.loadingPrices=!0,r=await ee.getAddressPrice(t)),e==="sourceToken"?D.sourceTokenPriceInUSD=r:e==="toToken"&&(D.toTokenPriceInUSD=r),D.loadingPrices&&(D.loadingPrices=!1),ee.getParams().availableToSwap&&!D.switchingTokens&&ee.swapTokens()},async switchTokens(){if(!(D.initializing||!D.initialized||D.switchingTokens)){D.switchingTokens=!0;try{let t=D.toToken?M({},D.toToken):void 0,e=D.sourceToken?M({},D.sourceToken):void 0,r=t&&D.toTokenAmount===""?"1":D.toTokenAmount;ee.setSourceTokenAmount(r),ee.setToTokenAmount(""),await ee.setSourceToken(t),await ee.setToToken(e),D.switchingTokens=!1,ee.swapTokens()}catch(t){throw D.switchingTokens=!1,t}}},resetState(){D.myTokensWithBalance=wt.myTokensWithBalance,D.tokensPriceMap=wt.tokensPriceMap,D.initialized=wt.initialized,D.initializing=wt.initializing,D.switchingTokens=wt.switchingTokens,D.sourceToken=wt.sourceToken,D.sourceTokenAmount=wt.sourceTokenAmount,D.sourceTokenPriceInUSD=wt.sourceTokenPriceInUSD,D.toToken=wt.toToken,D.toTokenAmount=wt.toTokenAmount,D.toTokenPriceInUSD=wt.toTokenPriceInUSD,D.networkPrice=wt.networkPrice,D.networkTokenSymbol=wt.networkTokenSymbol,D.networkBalanceInUSD=wt.networkBalanceInUSD,D.inputError=wt.inputError},resetValues(){let{networkAddress:t}=ee.getParams(),e=D.tokens?.find(r=>r.address===t);ee.setSourceToken(e),ee.setToToken(void 0)},getApprovalLoadingState(){return D.loadingApprovalTransaction},clearError(){D.transactionError=void 0},async initializeState(){if(!D.initializing){if(D.initializing=!0,!D.initialized)try{await ee.fetchTokens(),D.initialized=!0}catch{D.initialized=!1,Ce.showError("Failed to initialize swap"),me.goBack()}D.initializing=!1}},async fetchTokens(){let{networkAddress:t}=ee.getParams();await ee.getNetworkTokenPrice(),await ee.getMyTokensWithBalance();let e=D.myTokensWithBalance?.find(r=>r.address===t);e&&(D.networkTokenSymbol=e.symbol,ee.setSourceToken(e),ee.setSourceTokenAmount("0"))},async getTokenList(){let t=Q.state.activeCaipNetwork?.caipNetworkId;if(!(D.caipNetworkId===t&&D.tokens))try{D.tokensLoading=!0;let e=await Es.getTokenList(t);D.tokens=e,D.caipNetworkId=t,D.popularTokens=e.sort((o,a)=>o.symbol<a.symbol?-1:o.symbol>a.symbol?1:0);let n=(t&&Hn.SUGGESTED_TOKENS_BY_CHAIN?.[t]||[]).map(o=>e.find(a=>a.symbol===o)).filter(o=>!!o),i=(Hn.SWAP_SUGGESTED_TOKENS||[]).map(o=>e.find(a=>a.symbol===o)).filter(o=>!!o).filter(o=>!n.some(a=>a.address===o.address));D.suggestedTokens=[...n,...i]}catch{D.tokens=[],D.popularTokens=[],D.suggestedTokens=[]}finally{D.tokensLoading=!1}},async getAddressPrice(t){let e=D.tokensPriceMap[t];if(e)return e;let n=(await He.fetchTokenPrice({addresses:[t]}))?.fungibles||[],i=[...D.tokens||[],...D.myTokensWithBalance||[]]?.find(c=>c.address===t)?.symbol,o=n.find(c=>c.symbol.toLowerCase()===i?.toLowerCase())?.price||0,a=parseFloat(o.toString());return D.tokensPriceMap[t]=a,a},async getNetworkTokenPrice(){let{networkAddress:t}=ee.getParams(),r=(await He.fetchTokenPrice({addresses:[t]}).catch(()=>(Ce.showError("Failed to fetch network token price"),{fungibles:[]}))).fungibles?.[0],n=r?.price.toString()||"0";D.tokensPriceMap[t]=parseFloat(n),D.networkTokenSymbol=r?.symbol||"",D.networkPrice=n},async getMyTokensWithBalance(t){let e=await vp.getMyTokensWithBalance(t),r=Es.mapBalancesToSwapTokens(e);r&&(await ee.getInitialGasPrice(),ee.setBalances(r))},setBalances(t){let{networkAddress:e}=ee.getParams(),r=Q.state.activeCaipNetwork;if(!r)return;let n=t.find(s=>s.address===e);t.forEach(s=>{D.tokensPriceMap[s.address]=s.price||0}),D.myTokensWithBalance=t.filter(s=>s.address.startsWith(r.caipNetworkId)),D.networkBalanceInUSD=n?Ie.multiply(n.quantity.numeric,n.price).toString():"0"},async getInitialGasPrice(){let t=await Es.fetchGasPrice();if(!t)return{gasPrice:null,gasPriceInUSD:null};switch(Q.state?.activeCaipNetwork?.chainNamespace){case Se.CHAIN.SOLANA:return D.gasFee=t.standard??"0",D.gasPriceInUSD=Ie.multiply(t.standard,D.networkPrice).div(1e9).toNumber(),{gasPrice:BigInt(D.gasFee),gasPriceInUSD:Number(D.gasPriceInUSD)};case Se.CHAIN.EVM:default:let e=t.standard??"0",r=BigInt(e),n=BigInt(kv),s=cn.getGasPriceInUSD(D.networkPrice,n,r);return D.gasFee=e,D.gasPriceInUSD=s,{gasPrice:r,gasPriceInUSD:s}}},async swapTokens(){let t=Q.getAccountData()?.address,e=D.sourceToken,r=D.toToken,n=Ie.bigNumber(D.sourceTokenAmount).gt(0);if(n||ee.setToTokenAmount(""),!r||!e||D.loadingPrices||!n||!t)return;D.loadingQuote=!0;let s=Ie.bigNumber(D.sourceTokenAmount).times(10**e.decimals).round(0);try{let i=await He.fetchSwapQuote({userAddress:t,from:e.address,to:r.address,gasPrice:D.gasFee,amount:s.toString()});D.loadingQuote=!1;let o=i?.quotes?.[0]?.toAmount;if(!o){Xd.open({displayMessage:"Incorrect amount",debugMessage:"Please enter a valid amount"},"error");return}let a=Ie.bigNumber(o).div(10**r.decimals).toString();ee.setToTokenAmount(a),ee.hasInsufficientToken(D.sourceTokenAmount,e.address)?D.inputError="Insufficient balance":(D.inputError=void 0,ee.setTransactionDetails())}catch(i){let o=await Es.handleSwapError(i);D.loadingQuote=!1,D.inputError=o||"Insufficient balance"}},async getTransaction(){let{fromCaipAddress:t,availableToSwap:e}=ee.getParams(),r=D.sourceToken,n=D.toToken;if(!(!t||!e||!r||!n||D.loadingQuote))try{D.loadingBuildTransaction=!0;let s=await Es.fetchSwapAllowance({userAddress:t,tokenAddress:r.address,sourceTokenAmount:D.sourceTokenAmount,sourceTokenDecimals:r.decimals}),i;return s?i=await ee.createSwapTransaction():i=await ee.createAllowanceTransaction(),D.loadingBuildTransaction=!1,D.fetchError=!1,i}catch{me.goBack(),Ce.showError("Failed to check allowance"),D.loadingBuildTransaction=!1,D.approvalTransaction=void 0,D.swapTransaction=void 0,D.fetchError=!0;return}},async createAllowanceTransaction(){let{fromCaipAddress:t,sourceTokenAddress:e,toTokenAddress:r}=ee.getParams();if(!(!t||!r)){if(!e)throw new Error("createAllowanceTransaction - No source token address found.");try{let n=await He.generateApproveCalldata({from:e,to:r,userAddress:t}),s=Le.getPlainAddress(n.tx.from);if(!s)throw new Error("SwapController:createAllowanceTransaction - address is required");let i={data:n.tx.data,to:s,gasPrice:BigInt(n.tx.eip155.gasPrice),value:BigInt(n.tx.value),toAmount:D.toTokenAmount};return D.swapTransaction=void 0,D.approvalTransaction={data:i.data,to:i.to,gasPrice:i.gasPrice,value:i.value,toAmount:i.toAmount},{data:i.data,to:i.to,gasPrice:i.gasPrice,value:i.value,toAmount:i.toAmount}}catch{me.goBack(),Ce.showError("Failed to create approval transaction"),D.approvalTransaction=void 0,D.swapTransaction=void 0,D.fetchError=!0;return}}},async createSwapTransaction(){let{networkAddress:t,fromCaipAddress:e,sourceTokenAmount:r}=ee.getParams(),n=D.sourceToken,s=D.toToken;if(!e||!r||!n||!s)return;let i=Dt.parseUnits(r,n.decimals)?.toString();try{let o=await He.generateSwapCalldata({userAddress:e,from:n.address,to:s.address,amount:i,disableEstimate:!0}),a=n.address===t,c=BigInt(o.tx.eip155.gas),u=BigInt(o.tx.eip155.gasPrice),l=Le.getPlainAddress(o.tx.to);if(!l)throw new Error("SwapController:createSwapTransaction - address is required");let h={data:o.tx.data,to:l,gas:c,gasPrice:u,value:BigInt(a?i??"0":"0"),toAmount:D.toTokenAmount};return D.gasPriceInUSD=cn.getGasPriceInUSD(D.networkPrice,c,u),D.approvalTransaction=void 0,D.swapTransaction=h,h}catch{me.goBack(),Ce.showError("Failed to create transaction"),D.approvalTransaction=void 0,D.swapTransaction=void 0,D.fetchError=!0;return}},onEmbeddedWalletApprovalSuccess(){Ce.showLoading("Approve limit increase in your wallet"),me.replace("SwapPreview")},async sendTransactionForApproval(t){let{fromAddress:e,isAuthConnector:r}=ee.getParams();D.loadingApprovalTransaction=!0,r?me.pushTransactionStack({onSuccess:ee.onEmbeddedWalletApprovalSuccess}):Ce.showLoading("Approve limit increase in your wallet");try{await Dt.sendTransaction({address:e,to:t.to,data:t.data,value:t.value,chainNamespace:Se.CHAIN.EVM}),await ee.swapTokens(),await ee.getTransaction(),D.approvalTransaction=void 0,D.loadingApprovalTransaction=!1}catch(s){let i=s;D.transactionError=i?.displayMessage,D.loadingApprovalTransaction=!1,Ce.showError(i?.displayMessage||"Transaction error"),Et.sendEvent({type:"track",event:"SWAP_APPROVAL_ERROR",properties:{message:i?.displayMessage||i?.message||"Unknown",network:Q.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:ee.state.sourceToken?.symbol||"",swapToToken:ee.state.toToken?.symbol||"",swapFromAmount:ee.state.sourceTokenAmount||"",swapToAmount:ee.state.toTokenAmount||"",isSmartAccount:un(Se.CHAIN.EVM)===vs.ACCOUNT_TYPES.SMART_ACCOUNT}})}},async sendTransactionForSwap(t){if(!t)return;let{fromAddress:e,toTokenAmount:r,isAuthConnector:n}=ee.getParams();D.loadingTransaction=!0;let s=`Swapping ${D.sourceToken?.symbol} to ${Ie.formatNumberToLocalString(r,3)} ${D.toToken?.symbol}`,i=`Swapped ${D.sourceToken?.symbol} to ${Ie.formatNumberToLocalString(r,3)} ${D.toToken?.symbol}`;n?me.pushTransactionStack({onSuccess(){me.replace("Account"),Ce.showLoading(s),eu.resetState()}}):Ce.showLoading("Confirm transaction in your wallet");try{let o=[D.sourceToken?.address,D.toToken?.address].join(","),a=await Dt.sendTransaction({address:e,to:t.to,data:t.data,value:t.value,chainNamespace:Se.CHAIN.EVM});return D.loadingTransaction=!1,Ce.showSuccess(i),Et.sendEvent({type:"track",event:"SWAP_SUCCESS",properties:{network:Q.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:ee.state.sourceToken?.symbol||"",swapToToken:ee.state.toToken?.symbol||"",swapFromAmount:ee.state.sourceTokenAmount||"",swapToAmount:ee.state.toTokenAmount||"",isSmartAccount:un(Se.CHAIN.EVM)===vs.ACCOUNT_TYPES.SMART_ACCOUNT}}),eu.resetState(),n||me.replace("Account"),eu.getMyTokensWithBalance(o),a}catch(o){let a=o;D.transactionError=a?.displayMessage,D.loadingTransaction=!1,Ce.showError(a?.displayMessage||"Transaction error"),Et.sendEvent({type:"track",event:"SWAP_ERROR",properties:{message:a?.displayMessage||a?.message||"Unknown",network:Q.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:ee.state.sourceToken?.symbol||"",swapToToken:ee.state.toToken?.symbol||"",swapFromAmount:ee.state.sourceTokenAmount||"",swapToAmount:ee.state.toTokenAmount||"",isSmartAccount:un(Se.CHAIN.EVM)===vs.ACCOUNT_TYPES.SMART_ACCOUNT}});return}},hasInsufficientToken(t,e){return cn.isInsufficientSourceTokenForSwap(t,e,D.myTokensWithBalance)},setTransactionDetails(){let{toTokenAddress:t,toTokenDecimals:e}=ee.getParams();!t||!e||(D.gasPriceInUSD=cn.getGasPriceInUSD(D.networkPrice,BigInt(D.gasFee),BigInt(kv)),D.priceImpact=cn.getPriceImpact({sourceTokenAmount:D.sourceTokenAmount,sourceTokenPriceInUSD:D.sourceTokenPriceInUSD,toTokenPriceInUSD:D.toTokenPriceInUSD,toTokenAmount:D.toTokenAmount}),D.maxSlippage=cn.getMaxSlippage(D.slippage,D.toTokenAmount),D.providerFee=cn.getProviderFee(D.sourceTokenAmount))}},ee=hr(eu);var Cr=At({message:"",open:!1,triggerRect:{width:0,height:0,top:0,left:0},variant:"shade"}),h4={state:Cr,subscribe(t){return Xt(Cr,()=>t(Cr))},subscribeKey(t,e){return Tt(Cr,t,e)},showTooltip({message:t,triggerRect:e,variant:r}){Cr.open=!0,Cr.message=t,Cr.triggerRect=e,Cr.variant=r},hide(){Cr.open=!1,Cr.message="",Cr.triggerRect={width:0,height:0,top:0,left:0}}},f4=hr(h4);var Oo=At({isLegalCheckboxChecked:!1}),d4={state:Oo,subscribe(t){return Xt(Oo,()=>t(Oo))},subscribeKey(t,e){return Tt(Oo,t,e)},setIsLegalCheckboxChecked(t){Oo.isLegalCheckboxChecked=t}};var p4={eip155:{native:{assetNamespace:"slip44",assetReference:"60"},defaultTokenNamespace:"erc20"},solana:{native:{assetNamespace:"slip44",assetReference:"501"},defaultTokenNamespace:"token"}},Zd=class extends Error{};function g4(){let{sdkType:t,sdkVersion:e,projectId:r}=Ue.getSnapshot(),n=new URL("https://rpc.walletconnect.org/v1/json-rpc");return n.searchParams.set("projectId",r),n.searchParams.set("st",t),n.searchParams.set("sv",e),n.searchParams.set("source","fund-wallet"),n.toString()}async function Qd(t,e){let r=g4(),{projectId:n}=Ue.getSnapshot(),s={jsonrpc:"2.0",id:1,method:t,params:pe(M({},e||{}),{projectId:n})},o=await(await fetch(r,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}})).json();if(o.error)throw new Zd(o.error.message);return o}async function ep(t){return(await Qd("reown_getExchanges",t)).result}async function tp(t){return(await Qd("reown_getExchangePayUrl",t)).result}async function Fv(t){return(await Qd("reown_getExchangeBuyStatus",t)).result}function tu(t,e){let{chainNamespace:r,chainId:n}=zn.parseCaipNetworkId(t),s=p4[r];if(!s)throw new Error(`Unsupported chain namespace for CAIP-19 formatting: ${r}`);let i=s.native.assetNamespace,o=s.native.assetReference;return e!=="native"&&(i=s.defaultTokenNamespace,o=e),`${`${r}:${n}`}/${i}:${o}`}var m4={network:"eip155:1",asset:"native",metadata:{name:"Ethereum",symbol:"ETH",decimals:18}},y4={network:"eip155:8453",asset:"native",metadata:{name:"Ethereum",symbol:"ETH",decimals:18}},Lv={network:"eip155:8453",asset:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},w4={network:"eip155:84532",asset:"0x036CbD53842c5426634e7929541eC2318f3dCF7e",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},b4={network:"eip155:84532",asset:"native",metadata:{name:"Ethereum",symbol:"ETH",decimals:18}},v4={network:"eip155:1",asset:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},E4={network:"eip155:42161",asset:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},x4={network:"eip155:137",asset:"0x2791bca1f2de4661ed88a30c99a7a9449aa84174",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},S4={network:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",asset:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},I4={network:"eip155:1",asset:"0xdAC17F958D2ee523a2206206994597C13D831ec7",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},_4={network:"eip155:10",asset:"0x94b008aA00579c1307B0EF2c499aD98a8ce58e58",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},A4={network:"eip155:42161",asset:"0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},T4={network:"eip155:137",asset:"0xc2132d05d31c914a87c6611c10748aeb04b58e8f",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},C4={network:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",asset:"Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},D4={network:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",asset:"native",metadata:{name:"Solana",symbol:"SOL",decimals:9}},O4={ethereumETH:m4,baseETH:y4,baseUSDC:Lv,baseSepoliaETH:b4,ethereumUSDC:v4,arbitrumUSDC:E4,polygonUSDC:x4,solanaUSDC:S4,ethereumUSDT:I4,optimismUSDT:_4,arbitrumUSDT:A4,polygonUSDT:T4,solanaUSDT:C4,solanaSOL:D4};function rp(t){return Object.values(O4).filter(e=>e.network===t)}var P4=0,Mv={paymentAsset:null,amount:null,tokenAmount:0,priceLoading:!1,error:null,exchanges:[],isLoading:!1,currentPayment:void 0,isPaymentInProgress:!1,paymentId:"",assets:[]},Z=At(Mv),$n={state:Z,subscribe(t){return Xt(Z,()=>t(Z))},subscribeKey(t,e){return Tt(Z,t,e)},resetState(){Object.assign(Z,M({},Mv))},async getAssetsForNetwork(t){let e=rp(t),r=await $n.getAssetsImageAndPrice(e),n=e.map(s=>{let i=s.asset==="native"?yi():`${s.network}:${s.asset}`,o=r.find(a=>a.fungibles?.[0]?.address?.toLowerCase()===i.toLowerCase());return pe(M({},s),{price:o?.fungibles?.[0]?.price||1,metadata:pe(M({},s.metadata),{iconUrl:o?.fungibles?.[0]?.iconUrl})})});return Z.assets=n,n},async getAssetsImageAndPrice(t){let e=t.map(n=>n.asset==="native"?yi():`${n.network}:${n.asset}`);return await Promise.all(e.map(n=>He.fetchTokenPrice({addresses:[n]})))},getTokenAmount(){if(!Z?.paymentAsset?.price)throw new Error("Cannot get token price");let t=Ie.bigNumber(Z.amount??0).round(8),e=Ie.bigNumber(Z.paymentAsset.price).round(8);return t.div(e).round(8).toNumber()},setAmount(t){Z.amount=t,Z.paymentAsset?.price&&(Z.tokenAmount=$n.getTokenAmount())},setPaymentAsset(t){Z.paymentAsset=t},isPayWithExchangeEnabled(){return Ue.state.remoteFeatures?.payWithExchange},isPayWithExchangeSupported(){return $n.isPayWithExchangeEnabled()&&Q.state.activeCaipNetwork&&Hn.PAY_WITH_EXCHANGE_SUPPORTED_CHAIN_NAMESPACES.includes(Q.state.activeCaipNetwork.chainNamespace)},async fetchExchanges(){try{let t=$n.isPayWithExchangeSupported();if(!Z.paymentAsset||!t){Z.exchanges=[],Z.isLoading=!1;return}Z.isLoading=!0;let e=await ep({page:P4,asset:tu(Z.paymentAsset.network,Z.paymentAsset.asset),amount:Z.amount?.toString()??"0"});Z.exchanges=e.exchanges.slice(0,2)}catch{throw Ce.showError("Unable to get exchanges"),new Error("Unable to get exchanges")}finally{Z.isLoading=!1}},async getPayUrl(t,e){try{let r=Number(e.amount),n=await tp({exchangeId:t,asset:tu(e.network,e.asset),amount:r.toString(),recipient:`${e.network}:${e.recipient}`});return Et.sendEvent({type:"track",event:"PAY_EXCHANGE_SELECTED",properties:{exchange:{id:t},configuration:{network:e.network,asset:e.asset,recipient:e.recipient,amount:r},currentPayment:{type:"exchange",exchangeId:t},source:"fund-from-exchange",headless:!1}}),n}catch(r){throw r instanceof Error&&r.message.includes("is not supported")?new Error("Asset not supported"):new Error(r.message)}},async handlePayWithExchange(t){try{let e=Q.getAccountData()?.address;if(!e)throw new Error("No account connected");if(!Z.paymentAsset)throw new Error("No payment asset selected");let r=Le.returnOpenHref("","popupWindow","scrollbar=yes,width=480,height=720");if(!r)throw new Error("Could not create popup window");Z.isPaymentInProgress=!0,Z.paymentId=crypto.randomUUID(),Z.currentPayment={type:"exchange",exchangeId:t};let{network:n,asset:s}=Z.paymentAsset,i={network:n,asset:s,amount:Z.tokenAmount,recipient:e},o=await $n.getPayUrl(t,i);if(!o){try{r.close()}catch(a){console.error("Unable to close popup window",a)}throw new Error("Unable to initiate payment")}Z.currentPayment.sessionId=o.sessionId,Z.currentPayment.status="IN_PROGRESS",Z.currentPayment.exchangeId=t,r.location.href=o.url}catch{Z.error="Unable to initiate payment",Ce.showError(Z.error)}},async waitUntilComplete({exchangeId:t,sessionId:e,paymentId:r,retries:n=20}){let s=await $n.getBuyStatus(t,e,r);if(s.status==="SUCCESS"||s.status==="FAILED")return s;if(n===0)throw new Error("Unable to get deposit status");return await new Promise(i=>{setTimeout(i,5e3)}),$n.waitUntilComplete({exchangeId:t,sessionId:e,paymentId:r,retries:n-1})},async getBuyStatus(t,e,r){try{if(!Z.currentPayment)throw new Error("No current payment");let n=await Fv({sessionId:e,exchangeId:t});if(Z.currentPayment.status=n.status,n.status==="SUCCESS"||n.status==="FAILED"){let s=Q.getAccountData()?.address;Z.currentPayment.result=n.txHash,Z.isPaymentInProgress=!1,Et.sendEvent({type:"track",event:n.status==="SUCCESS"?"PAY_SUCCESS":"PAY_ERROR",properties:{message:n.status==="FAILED"?Le.parseError(Z.error):void 0,source:"fund-from-exchange",paymentId:r,configuration:{network:Z.paymentAsset?.network||"",asset:Z.paymentAsset?.asset||"",recipient:s||"",amount:Z.amount??0},currentPayment:{type:"exchange",exchangeId:Z.currentPayment?.exchangeId,sessionId:Z.currentPayment?.sessionId,result:n.txHash}}})}return n}catch{return{status:"UNKNOWN",txHash:""}}},reset(){Z.currentPayment=void 0,Z.isPaymentInProgress=!1,Z.paymentId="",Z.paymentAsset=null,Z.amount=0,Z.tokenAmount=0,Z.priceLoading=!1,Z.error=null,Z.exchanges=[],Z.isLoading=!1}};var R4={isUnsupportedChainView(){return me.state.view==="UnsupportedChain"||me.state.view==="SwitchNetwork"&&me.state.history.includes("UnsupportedChain")},async safeClose(){if(this.isUnsupportedChainView()){qt.shake();return}if(await lr.isSIWXCloseDisabled()){qt.shake();return}(me.state.view==="DataCapture"||me.state.view==="DataCaptureOtpConfirm")&&Dt.disconnect(),qt.close()}};export{iu as a,Fs as b,Ev as c,pi as d,ws as e,Yd as f,lr as g,Jd as h,Xd as i,ee as j,f4 as k,d4 as l,Lv as m,w4 as n,$n as o,R4 as p};
